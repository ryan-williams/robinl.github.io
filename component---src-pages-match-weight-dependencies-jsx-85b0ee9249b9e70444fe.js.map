{"version":3,"sources":["webpack://gatsby-starter-hello-world/./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js","webpack://gatsby-starter-hello-world/./src/components/linkage_footer.jsx","webpack://gatsby-starter-hello-world/./src/components/prob_linkage_page.jsx","webpack://gatsby-starter-hello-world/./node_modules/@robinl/dependencies-between-match-weights/817db6818ab226c0@104.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/dependencies-between-match-weights/34fd4ef09fb0509a@2296.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/dependencies-between-match-weights/9547bc35da079fbb@158.js","webpack://gatsby-starter-hello-world/./src/pages/match_weight_dependencies.jsx"],"names":["_taggedTemplateLiteral","strings","raw","slice","Object","freeze","defineProperties","value","mar","flex","order_of_articles","props","path","current_path","this_index","indexOf","previous_article","next_article","undefined","to","css","post","define","output_order","className","title","post_frontmatter","description","_templateObject","_templateObject2","_templateObject3","_templateObject4","_templateObject5","_templateObject6","_templateObject7","_templateObject8","_templateObject9","_templateObject10","_1","md","_base_spec_m_u","width","config","view","height","anchor","offset","header","hconcat","mark","text","fontWeight","encoding","row","type","field","sort","labelAngle","labelAnchor","labelAlign","x","axis","y","tooltip","format","color","resolve","scale","transform","filter","labels","data","values","subtitle","$schema","_base_spec_bayes_factors","clip","selection","selector076","bind","encodings","range","domain","_settings_example","default_splink_settings","JSON","parse","_chart_data_from_splink_settings","get_chart_row","splink_settings","chart_data","comparison_columns","forEach","cc","a","b","map","k","i","m_u_pair","index","push","_get_m_u_chart","base_spec_m_u","chart_data_from_splink_settings","embed","splink_setttings","base_spec","stringify","lam","proportion_of_matches","concat","_7","get_m_u_chart","settings_example","_get_bayes_factor_chart","base_spec_bayes_factors","toPrecision","_9","get_bayes_factor_chart","_get_chart_row","comparison_column","Math","log2","m_probabilities","length","_default_splink_settings","_embed","require","runtime","observer","main","module","variable","_num_levels","inputs","label","step","_3","_thing","m_u_input_control","starting_data","_gen_y_scale","d3","axis_stretch_at_extremes","internal_height","scaleLinear","my_fn","squash","pow","log","root","multiple","offset_scale","in_values_not_normalised","num_points","d","ext","extent","normalise_scale","_m_u_input_control","DOM","margin","splink_data_to_unstacked_data","unstacked_data_to_stacked","num_levels_to_level_keys","get_level_colours_scale","gen_x_scale","gen_y_scale","html","get_tick_vals","redraw","comparison_column_index","arguments","axis_compression_slider","axis_compression_start_value","comparison_col","num_levels","u_probabilities","node","svg","svg_outer","select","append","attr","left","top","unstacked_data","stacked_data","plot_data","m_u","level_keys","level_names","level_colours","internal_width","right","bottom","axis_slider","style","display","final_output","enclosed_data","on","inner","selectAll","join","key","classed","remove","thing","_redraw","get_scale","get_drag","get_label","format_tick","e","slider","axis_stretch","match_status","bandwidth","call","tickVals","axisBottom","tickValues","tickFormat","axisLeft","_starting_data","normalise","col_name","_splink_data_to_unstacked_data","u_probs","match_index","p","m_probs","_get_tick_vals","vals","index_offset","floor","middle_index","start_index","end_index","_get_label","lev_name","this_name","ms","level_prop","replace","charAt","toUpperCase","_gen_x_scale","_get_level_colours_scale","scheme","schemeGnBu","scaleOrdinal","_get_drag","get_lam","get_m_u","Event","drag","dispatchEvent","_get_lam","start_lam_x","new_lam","invert","dx","min","max","_get_m_u","target_level_index","dragging_from_bottom","this_level_name","subject","level_index","dragged_cum_proportions","start_of_this_level_prop","end_of_this_level_prop","midpoint_y","y_start","y_start_with_delta","dy","prop_start","change_in_prop","target_level","new_val_this_lev","new_val_target_lev","isBetween","n","_margin","_get_scale","s1","scaleBand","padding","s2","_input_control","widget_data","levels","m","lev","u","_height","_unstacked_data_to_stacked","level_keys_from_unstacked_data","stacked","stack","keys","order","stackOrderNone","stackOffsetNone","v","_level_keys_from_unstacked_data","includes","_input_control_data_to_splink_settings","input_control_data","_num_levels_to_level_keys","_format_tick","toString","_normalise","arr","sum","reduce","_gen_starting_data","settings","acc","_30","_32","_inputs","_d3","G","_","input","child1","import","_title","_2","_para_1","_para_2","tex","_gen","reset_gender","settings_gender","_reset_gender","button","_bf_chart_gender","input_control_data_to_splink_settings","gen","_para_3","_para_4","_fn1","reset_fn1","settings_forename_1","_reset_fn1","_bf_chart_fn_1","fn1","_para_5","_fn2","reset_fn2","settings_forename_2","_reset_fn2","_bf_chart_fn_2","fn2","_para_6","_settings_gender","_settings_forename_1","_settings_forename_2","child2","frontmatter","post_date","code_url","post_type","post_category","css_override"],"mappings":"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","file":"component---src-pages-match-weight-dependencies-jsx-85b0ee9249b9e70444fe.js","sourcesContent":["export default function _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}","import React from 'react'\nimport { css } from \"@emotion/core\"\nimport { rhythm } from \"../utils/typography\"\nimport { Link } from \"gatsby\"\n\n\nconst foot = css`\nmargin-left: auto;\n  margin-right: auto;\n  width: 80%;\n  max-width: 640px;\n  `\n\nconst cen = css`\n  text-align: center;\n`\n\nconst mar = css`\n  margin-top: 1rem;\n  margin-bottom: 0.5rem;\n`\n\nconst flex = css`\n\n\n    display: flex;\n    justify-content: space-between;\n\n`\n\nconst order_of_articles = [\n  \"/intro_to_probabilistic_linkage/\",\n  \"/maths_of_fellegi_sunter/\",\n  \"/visualising_fellegi_sunter/\",\n  \"/understanding_match_weights/\",\n  \"/match_weight_dependencies/\",\n  \"/m_u_generator/\",\n]\n\nconst LinkageFooter = (props) => {\n\n  let path = props.current_path\n\n  let this_index = order_of_articles.indexOf(path)\n\n  let previous_article = order_of_articles[this_index - 1]\n  let next_article = order_of_articles[this_index + 1]\n\n  if (previous_article === undefined) {\n    previous_article = <div></div>\n  } else {\n    previous_article = <div><Link to={previous_article}> &lt; Previous article</Link></div>\n  }\n\n  if (next_article === undefined) {\n    next_article = <div></div>\n  } else {\n    next_article = <div><Link to={next_article}> Next article &gt;</Link></div>\n  }\n\n  return (\n    <div>\n      <hr css={mar} />\n      <div css={flex}>\n        {previous_article}\n        <div><Link to=\"/probabilistic_linkage\">Probabilistic linkage home</Link></div>\n        {next_article}\n      </div>\n\n    </div >)\n}\n\nexport default LinkageFooter","import React from 'react'\nimport Layout from \"../layouts/layout\"\nimport LinkageFooter from './linkage_footer'\nimport ObeservableNotebookDiv from \"./observable_div\"\nimport PostFrontMatter from \"./post_frontmatter\"\nimport SEO from \"./seo\"\n\n\nfunction ProbLinkagePage(props) {\n\n\n  // let post\n\n\n  let post = <ObeservableNotebookDiv define={props.define} output_order={props.output_order} />\n\n\n  return (\n    <Layout css={props.className}>\n      <SEO title={props.post_frontmatter.title} description={props.post_frontmatter.description} />\n      <PostFrontMatter post_frontmatter={props.post_frontmatter} />\n      {post}\n      <LinkageFooter current_path={props.current_path}\n      />\n    </Layout>\n  )\n\n}\n\nexport default ProbLinkagePage","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject;\n\nfunction _1(md) {\n  return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Match Weights Charts\"])));\n}\n\nfunction _base_spec_m_u(width) {\n  return {\n    config: {\n      view: {\n        width: width / 3,\n        height: 300\n      },\n      title: {\n        anchor: \"middle\",\n        offset: 10\n      },\n      header: {\n        title: null\n      }\n    },\n    hconcat: [{\n      mark: \"bar\",\n      title: {\n        text: \"Non-matches\",\n        fontWeight: \"normal\"\n      },\n      encoding: {\n        row: {\n          type: \"nominal\",\n          field: \"column_name\",\n          sort: {\n            field: \"gamma_index\"\n          },\n          header: {\n            labelAngle: 0,\n            labelAnchor: \"middle\",\n            labelAlign: \"left\"\n          }\n        },\n        x: {\n          type: \"quantitative\",\n          field: \"u_probability\",\n          axis: {\n            title: \"proportion\"\n          }\n        },\n        y: {\n          type: \"nominal\",\n          axis: {\n            title: null\n          },\n          field: \"level_name\"\n        },\n        tooltip: [{\n          type: \"nominal\",\n          field: \"column_name\"\n        }, {\n          type: \"ordinal\",\n          field: \"level_name\"\n        }, {\n          type: \"quantitative\",\n          field: \"u_probability\",\n          format: \".4f\"\n        }, {\n          type: \"quantitative\",\n          field: \"bayes_factor\",\n          format: \".4f\"\n        }, {\n          type: \"nominal\",\n          field: \"level_proportion\",\n          title: \"Percentage of record comparisons in this level\",\n          format: \".2%\"\n        }, {\n          type: \"quantitative\",\n          field: \"log2_bayes_factor\",\n          format: \".4f\"\n        }],\n        color: {\n          value: \"red\"\n        }\n      },\n      resolve: {\n        scale: {\n          y: \"independent\"\n        }\n      },\n      transform: [{\n        filter: \"(datum.bayes_factor != 'unnecessary filter2 due to vega lite issue 4680')\"\n      }],\n      // width: width / 2,\n      height: 50\n    }, {\n      mark: \"bar\",\n      title: {\n        text: \"Matches\",\n        fontWeight: \"normal\"\n      },\n      encoding: {\n        row: {\n          type: \"nominal\",\n          field: \"column_name\",\n          sort: {\n            field: \"gamma_index\"\n          },\n          header: {\n            labels: false\n          }\n        },\n        x: {\n          type: \"quantitative\",\n          field: \"m_probability\",\n          axis: {\n            title: \"proportion\"\n          }\n        },\n        y: {\n          type: \"nominal\",\n          axis: {\n            title: null\n          },\n          field: \"level_name\"\n        },\n        tooltip: [{\n          type: \"nominal\",\n          field: \"column_name\"\n        }, {\n          type: \"ordinal\",\n          field: \"level_name\"\n        }, {\n          type: \"quantitative\",\n          field: \"m_probability\",\n          format: \".4f\"\n        }, {\n          type: \"quantitative\",\n          field: \"bayes_factor\",\n          format: \".4f\"\n        }, {\n          type: \"nominal\",\n          field: \"level_proportion\",\n          title: \"Percentage of record comparisons in this level\",\n          format: \".2%\"\n        }, {\n          type: \"quantitative\",\n          field: \"log2_bayes_factor\",\n          format: \".4f\"\n        }],\n        color: {\n          value: \"green\"\n        }\n      },\n      resolve: {\n        scale: {\n          y: \"independent\"\n        }\n      },\n      transform: [{\n        filter: \"(datum.bayes_factor != 'unnecessary filter due to vega lite issue 4680')\"\n      }],\n      // width: width / 2,\n      height: 50\n    }],\n    data: {\n      values: null\n    },\n    transform: [],\n    title: {\n      text: \"Probability distributions of non-matches and matches \",\n      subtitle: \"Estimated proportion of matches λ = \"\n    },\n    $schema: \"https://vega.github.io/schema/vega-lite/v4.json\"\n  };\n}\n\nfunction _base_spec_bayes_factors(width) {\n  return {\n    config: {\n      view: {\n        width: width / 1.5,\n        height: 300\n      },\n      mark: {\n        tooltip: null\n      },\n      title: {\n        anchor: \"middle\"\n      },\n      header: {\n        title: null\n      }\n    },\n    data: {\n      values: null\n    },\n    mark: {\n      type: \"bar\",\n      clip: true\n    },\n    selection: {\n      selector076: {\n        type: \"interval\",\n        bind: \"scales\",\n        encodings: [\"x\"]\n      }\n    },\n    encoding: {\n      color: {\n        type: \"quantitative\",\n        field: \"log2_bayes_factor\",\n        scale: {\n          range: [\"red\", \"orange\", \"green\"],\n          domain: [-10, 0, 10]\n        }\n      },\n      row: {\n        type: \"nominal\",\n        field: \"column_name\",\n        sort: {\n          field: \"gamma_index\"\n        },\n        header: {\n          labelAngle: 0,\n          labelAnchor: \"middle\",\n          labelAlign: \"left\"\n        }\n      },\n      tooltip: [{\n        type: \"nominal\",\n        field: \"column_name\"\n      }, {\n        type: \"ordinal\",\n        field: \"level_name\"\n      }, {\n        type: \"quantitative\",\n        field: \"m_probability\",\n        format: \".4f\"\n      }, {\n        type: \"quantitative\",\n        field: \"bayes_factor\",\n        format: \".4f\"\n      }, {\n        type: \"nominal\",\n        field: \"level_proportion\",\n        title: \"Percentage of record comparisons in this level\",\n        format: \".2%\"\n      }, {\n        type: \"quantitative\",\n        field: \"log2_bayes_factor\",\n        title: \"log2(Bayes factor, K = m/u)\",\n        format: \".4f\"\n      }],\n      x: {\n        type: \"quantitative\",\n        axis: {\n          title: \"log2(Bayes factor, K = m/u)\",\n          values: [-10, -5, 0, 5, 10]\n        },\n        field: \"log2_bayes_factor\",\n        scale: {\n          domain: [-10, 10]\n        }\n      },\n      y: {\n        type: \"nominal\",\n        field: \"level_name\",\n        axis: {\n          title: null\n        }\n      }\n    },\n    height: 50,\n    resolve: {\n      scale: {\n        y: \"independent\"\n      }\n    },\n    title: {\n      text: \"Influence of comparison vector values on match probability\",\n      subtitle: \"Use mousewheeel to zoom\"\n    },\n    $schema: \"https://vega.github.io/schema/vega-lite/v4.json\"\n  };\n}\n\nfunction _settings_example(default_splink_settings) {\n  return JSON.parse(default_splink_settings);\n}\n\nfunction _chart_data_from_splink_settings(get_chart_row) {\n  return function chart_data_from_splink_settings(splink_settings) {\n    var chart_data = [];\n\n    var zip = function zip(a, b) {\n      return a.map(function (k, i) {\n        return [k, b[i]];\n      });\n    };\n\n    splink_settings.comparison_columns.forEach(function (cc) {\n      var zipped = zip(cc[\"m_probabilities\"], cc[\"u_probabilities\"]);\n      zipped.forEach(function (m_u_pair, index) {\n        var row = get_chart_row(m_u_pair, cc, index);\n        chart_data.push(row);\n      });\n    });\n    return chart_data;\n  };\n}\n\nfunction _get_m_u_chart(base_spec_m_u, chart_data_from_splink_settings, embed) {\n  return function get_m_u_chart(splink_setttings) {\n    var base_spec = JSON.parse(JSON.stringify(base_spec_m_u));\n    var lam = splink_setttings.proportion_of_matches;\n    base_spec.data.values = chart_data_from_splink_settings(splink_setttings);\n    base_spec.title.subtitle = \"Estimated proportion of matches \\u03BB = \".concat(lam);\n    return embed(base_spec);\n  };\n}\n\nfunction _7(get_m_u_chart, settings_example) {\n  return get_m_u_chart(settings_example);\n}\n\nfunction _get_bayes_factor_chart(base_spec_bayes_factors, chart_data_from_splink_settings, embed) {\n  return function get_bayes_factor_chart(splink_setttings) {\n    var base_spec = JSON.parse(JSON.stringify(base_spec_bayes_factors));\n    var lam = splink_setttings.proportion_of_matches;\n    base_spec.data.values = chart_data_from_splink_settings(splink_setttings);\n    base_spec.title.subtitle = \"Estimated proportion of matches \\u03BB = \".concat(lam.toPrecision(4));\n    return embed(base_spec);\n  };\n}\n\nfunction _9(get_bayes_factor_chart, settings_example) {\n  return get_bayes_factor_chart(settings_example);\n}\n\nfunction _get_chart_row() {\n  return function get_chart_row(m_u_pair, comparison_column, index) {\n    var row = {};\n    var cc = comparison_column;\n    row[\"m_probability\"] = m_u_pair[0];\n    row[\"u_probability\"] = m_u_pair[1];\n    row[\"bayes_factor\"] = m_u_pair[0] / m_u_pair[1];\n    row[\"column_name\"] = cc[\"col_name\"];\n    row[\"log2_bayes_factor\"] = Math.log2(row[\"bayes_factor\"]);\n    row[\"gamma_index\"] = index;\n    row[\"gamma_column_name\"] = \"gamma_\" + cc[\"col_name\"];\n    row[\"level_name\"] = \"level_\" + index;\n    row[\"max_gamma_index\"] = cc.m_probabilities.length - 1;\n    row[\"num_levels\"] = cc.m_probabilities.length;\n    return row;\n  };\n}\n\nfunction _default_splink_settings() {\n  return \"{\\n    \\\"proportion_of_matches\\\": 0.001,\\n    \\\"comparison_columns\\\": [\\n      {\\n        \\\"col_name\\\": \\\"fname\\\",\\n        \\\"u_probabilities\\\": [0.8, 0.2],\\n        \\\"m_probabilities\\\": [0.2, 0.8]\\n      },\\n      {\\n        \\\"col_name\\\": \\\"sname\\\",\\n        \\\"u_probabilities\\\": [0.9, 0.1],\\n        \\\"m_probabilities\\\": [0.2, 0.8]\\n      },\\n      {\\n        \\\"col_name\\\": \\\"dob\\\",\\n        \\\"u_probabilities\\\": [0.99, 0.01],\\n        \\\"m_probabilities\\\": [0.2, 0.8]\\n      },\\n      {\\n        \\\"col_name\\\": \\\"town\\\",\\n        \\\"u_probabilities\\\": [0.7, 0.3],\\n        \\\"m_probabilities\\\": [0.3, 0.7]\\n      }\\n    ]\\n  \\n  }\";\n}\n\nfunction _embed(require) {\n  return require(\"vega-embed@6\");\n}\n\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer(\"base_spec_m_u\")).define(\"base_spec_m_u\", [\"width\"], _base_spec_m_u);\n  main.variable(observer(\"base_spec_bayes_factors\")).define(\"base_spec_bayes_factors\", [\"width\"], _base_spec_bayes_factors);\n  main.variable(observer(\"settings_example\")).define(\"settings_example\", [\"default_splink_settings\"], _settings_example);\n  main.variable(observer(\"chart_data_from_splink_settings\")).define(\"chart_data_from_splink_settings\", [\"get_chart_row\"], _chart_data_from_splink_settings);\n  main.variable(observer(\"get_m_u_chart\")).define(\"get_m_u_chart\", [\"base_spec_m_u\", \"chart_data_from_splink_settings\", \"embed\"], _get_m_u_chart);\n  main.variable(observer()).define([\"get_m_u_chart\", \"settings_example\"], _7);\n  main.variable(observer(\"get_bayes_factor_chart\")).define(\"get_bayes_factor_chart\", [\"base_spec_bayes_factors\", \"chart_data_from_splink_settings\", \"embed\"], _get_bayes_factor_chart);\n  main.variable(observer()).define([\"get_bayes_factor_chart\", \"settings_example\"], _9);\n  main.variable(observer(\"get_chart_row\")).define(\"get_chart_row\", _get_chart_row);\n  main.variable(observer(\"default_splink_settings\")).define(\"default_splink_settings\", _default_splink_settings);\n  main.variable(observer(\"embed\")).define(\"embed\", [\"require\"], _embed);\n  return main;\n}","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;\n\nimport define1 from \"./817db6818ab226c0@104.js\";\n\nfunction _1(md) {\n  return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Resizable areas\"])));\n}\n\nfunction _num_levels(inputs) {\n  return inputs.range([2, 6], {\n    label: 'num levels',\n    step: 1,\n    value: 3\n  });\n}\n\nfunction _3(md) {\n  return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"## Drag within the bars to resize\\n\\nNote that if you change the number of levels of the axis squishiness, values will reset\"])));\n}\n\nfunction _thing(m_u_input_control, width, height, starting_data) {\n  return m_u_input_control(width, height, starting_data, 0, true, 0);\n}\n\nfunction _gen_y_scale(d3) {\n  return function (axis_stretch_at_extremes, height, internal_height) {\n    //https://www.wolframalpha.com/input/?i=solve+y%3D+log_b%28%28x%2Bc%29%2F%28c-x%29%29\n    if (axis_stretch_at_extremes == 0) {\n      return d3.scaleLinear().domain([0, 1]).range([internal_height, 0]);\n    }\n\n    var squash = axis_stretch_at_extremes;\n    var my_fn;\n\n    if (squash >= 0) {\n      my_fn = function my_fn(x) {\n        return Math.pow(5, x) / (Math.pow(5, x) + 1);\n      };\n    } else {\n      my_fn = function my_fn(x) {\n        return -1 * Math.log((x + 8.01) / (8.01 - x));\n      };\n\n      var root = 1 / 3;\n      var multiple = 8 / Math.pow(8, root);\n      squash = -Math.pow(-squash, root) * multiple;\n    }\n\n    var offset_scale = d3.scaleLinear().domain([0, 1]).range([-squash, squash]);\n    var num_points = 50;\n    var in_values_not_normalised = d3.range(num_points + 1).map(function (d) {\n      return d / num_points;\n    }).map(offset_scale).map(my_fn);\n    var ext = d3.extent(in_values_not_normalised);\n    var normalise_scale = d3.scaleLinear().domain(ext).range([0, 1]);\n    var domain = in_values_not_normalised.map(normalise_scale);\n    var range = d3.range(num_points + 1).map(function (d) {\n      return internal_height * (num_points - d) / num_points;\n    });\n    return d3.scaleLinear().domain(domain).range(range);\n  };\n}\n\nfunction _m_u_input_control(DOM, d3, margin, splink_data_to_unstacked_data, unstacked_data_to_stacked, num_levels_to_level_keys, get_level_colours_scale, inputs, gen_x_scale, gen_y_scale, html, get_tick_vals, redraw) {\n  return function (width, height, splink_settings) {\n    var comparison_column_index = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n    var axis_compression_slider = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n    var axis_compression_start_value = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n    // Lots of vars created in this funcion that need to be passed to other functinos like redraw\n    // Put them all in 'enclosed data'\n    var comparison_col = splink_settings.comparison_columns[comparison_column_index];\n    var num_levels = comparison_col.u_probabilities.length;\n    var node = DOM.svg(width, height);\n    var svg_outer = d3.select(node); // svg_outer.style(\"border\", \"1px solid black \");\n\n    var svg = svg_outer.append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\").attr(\"class\", \"outer_group\");\n    var unstacked_data = splink_data_to_unstacked_data(splink_settings, comparison_column_index);\n    var stacked_data = unstacked_data_to_stacked(unstacked_data);\n    var plot_data = stacked_data.m_u;\n    var level_keys = num_levels_to_level_keys(num_levels);\n    var level_names = num_levels_to_level_keys(num_levels);\n\n    if ('level_names' in splink_settings) {\n      level_names = splink_settings.level_names;\n    }\n\n    var level_colours = get_level_colours_scale(stacked_data);\n    var internal_width = width - margin.left - margin.right;\n    var internal_height = height - margin.top - margin.bottom;\n    var axis_slider = inputs.range([-8, 8], {\n      step: 0.1,\n      label: 'Axis compression',\n      value: axis_compression_start_value\n    });\n\n    if (!axis_compression_slider) {\n      axis_slider.style.display = 'none';\n    }\n\n    var x = gen_x_scale(axis_slider.value, width, internal_width);\n    var y = gen_y_scale(axis_slider.value, height, internal_height);\n    var final_output = html(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\\n\\n  \", \"\\n  \", \"\\n  \"])), axis_slider, svg_outer.node());\n    var enclosed_data = {\n      x: x,\n      y: y,\n      svg: svg,\n      svg_outer: svg_outer,\n      unstacked_data: unstacked_data,\n      stacked_data: stacked_data,\n      level_keys: level_keys,\n      level_names: level_names,\n      level_colours: level_colours,\n      final_output: final_output,\n      axis_slider: axis_slider,\n      internal_height: internal_height,\n      internal_width: internal_width,\n      width: width,\n      height: height\n    };\n    svg.on(\".drag\", null);\n    var inner = svg.selectAll(\"g\").data(plot_data).join(\"g\").attr(\"fill\", function (d) {\n      return level_colours(d.key);\n    }).attr(\"class\", function (d) {\n      return d.key;\n    }).classed(\"inner_group\", \"true\");\n    inner.selectAll(\"rect\").data(function (d) {\n      return d;\n    }).join(\"rect\").attr(\"stroke\", \"white\").attr(\"stroke-width\", \"2px\").classed(\"m_u_areas\", \"true\");\n    inner.selectAll(\"text\").data(function (d) {\n      return d;\n    }).join(\"text\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.5em\").style(\"font-size\", \"0.8em\").attr(\"pointer-events\", \"none\").style(\"font-family\", \"sans-serif\").classed(\"m_u_labels\", \"true\");\n    var tickVals = get_tick_vals(axis_slider.value);\n    svg.append('g').attr(\"class\", \"x_axis_group\");\n    svg.append('g').attr(\"class\", \"y_axis_group\");\n    inner.selectAll(\"text.chart_title\").remove();\n    inner.append(\"text\").text(\"Distribution of m and u values\").attr(\"y\", -60).attr(\"x\", internal_width / 2).attr(\"class\", \"chart_title\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.5em\").style(\"font-size\", \"1em\").style(\"font-weight\", \"bold\").attr(\"pointer-events\", \"none\").style('fill', 'black').style(\"font-family\", \"sans-serif\");\n    inner.append(\"text\").text(\"✨ Drag within rectangles to change values ✨\").attr(\"y\", -20).attr(\"x\", internal_width / 2).attr(\"class\", \"chart_title\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.5em\").style(\"font-size\", \"0.8em\").attr(\"pointer-events\", \"none\").style('fill', 'red').style(\"font-family\", \"sans-serif\");\n    inner.append(\"text\").text(\"The area represents all record comparisons, split into levels by match status\").attr(\"y\", -40).attr(\"x\", internal_width / 2).attr(\"class\", \"chart_title\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.5em\").style(\"font-size\", \"0.8em\").attr(\"pointer-events\", \"none\").style('fill', 'black').style(\"font-family\", \"sans-serif\");\n    redraw(enclosed_data);\n    d3.select(axis_slider).on('input', function (d) {\n      redraw(enclosed_data);\n    });\n    final_output.value = unstacked_data;\n    return final_output;\n  };\n}\n\nfunction _7(thing) {\n  return thing;\n}\n\nfunction _redraw(gen_x_scale, gen_y_scale, get_scale, get_drag, get_label, get_tick_vals, d3, format_tick) {\n  return function redraw(enclosed_data) {\n    var e = enclosed_data;\n    var unstacked_data = e.unstacked_data;\n    var svg = e.svg;\n    var svg_outer = e.svg_outer;\n    var stacked_data = e.stacked_data;\n    var plot_data = stacked_data.m_u;\n    var level_keys = e.level_keys;\n    var level_names = e.level_names;\n    var slider = e.axis_slider;\n    var axis_stretch = slider.value;\n    var internal_height = e.internal_height;\n    var internal_width = e.internal_width;\n    var width = e.width;\n    var height = e.height;\n    e.x = gen_x_scale(axis_stretch, width, internal_width);\n    e.y = gen_y_scale(axis_stretch, height, internal_height);\n    var inner = svg.selectAll(\".inner_group\").data(plot_data).join(\"g\").attr(\"fill\", function (d) {\n      return e.level_colours(d.key);\n    });\n    inner.selectAll(\"rect.m_u_areas\").data(function (d) {\n      return d;\n    }).join(\"rect\").attr(\"x\", function (d) {\n      return get_scale(d.data.match_status, e.stacked_data.lam, e.x)(d.data.match_status);\n    }).attr(\"y\", function (d) {\n      return e.y(d[1]);\n    }).attr(\"height\", function (d) {\n      return e.y(d[0]) - e.y(d[1]);\n    }).attr(\"width\", function (d) {\n      return get_scale(d.data.match_status, unstacked_data.lam, e.x).bandwidth();\n    }).call(get_drag(enclosed_data, redraw));\n    inner.selectAll(\"text.m_u_labels\").data(function (d) {\n      return d;\n    }).join(\"text\").attr(\"x\", function (d) {\n      return get_scale(d.data.match_status, stacked_data.lam, e.x)(d.data.match_status) + get_scale(d.data.match_status, stacked_data.lam, e.x).bandwidth() / 2;\n    }).attr(\"y\", function (d) {\n      return (e.y(d[1]) + e.y(d[0])) / 2;\n    }).text(function (d) {\n      return get_label(d, level_keys, level_names);\n    }).style('fill', 'black');\n    inner.selectAll(\"text.axis_match_label\").remove();\n    inner.selectAll(\"text.axis_match_label\").data([{\n      text: \"Record comparisons which are non-matches\",\n      x: [0, 1 - unstacked_data.lam]\n    }, {\n      text: \"Record comparisons which are matches\",\n      x: [1 - unstacked_data.lam, 1]\n    }]).join(\"text\").text(function (d) {\n      return d.text;\n    }).attr(\"y\", e.y(0) + 40).attr(\"x\", function (d) {\n      return (e.x(d.x[0]) + e.x(d.x[1])) / 2;\n    }).attr(\"class\", \"axis_match_label\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.5em\").style(\"font-size\", \"0.8em\").attr(\"pointer-events\", \"none\").style('fill', 'black').style(\"font-family\", \"sans-serif\");\n    var tickVals = get_tick_vals(slider.value);\n    svg.selectAll(\".x_axis_group\").attr(\"transform\", \"translate(\" + 0 + \",\" + internal_height + \")\").call(d3.axisBottom(e.x).tickValues(tickVals).tickFormat(format_tick));\n    svg.selectAll(\".y_axis_group\").call(d3.axisLeft(e.y).tickValues(tickVals).tickFormat(format_tick));\n  };\n}\n\nfunction _starting_data(normalise, d3, num_levels) {\n  return {\n    proportion_of_matches: 0.3,\n    comparison_columns: [{\n      col_name: \"my column\",\n      m_probabilities: normalise(d3.range(1, num_levels + 1, 1)),\n      u_probabilities: normalise(d3.range(num_levels, 0, -1))\n    }]\n  };\n}\n\nfunction _splink_data_to_unstacked_data() {\n  return function (splink_settings) {\n    var comparison_column_index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    var data = {\n      lam: splink_settings.proportion_of_matches\n    };\n    data.m_u = [null, null];\n    var u_probs = splink_settings.comparison_columns[comparison_column_index].u_probabilities;\n    data.m_u[0] = {\n      match_status: \"non-match\",\n      match_index: 0\n    };\n    u_probs.forEach(function (p, i) {\n      return data.m_u[0][\"level_\" + i] = p;\n    });\n    var m_probs = splink_settings.comparison_columns[comparison_column_index].m_probabilities;\n    data.m_u[1] = {\n      match_status: \"match\",\n      match_index: 1\n    };\n    m_probs.forEach(function (p, i) {\n      return data.m_u[1][\"level_\" + i] = p;\n    });\n    return data;\n  };\n}\n\nfunction _get_tick_vals() {\n  return function (axis_stretch_at_extremes) {\n    var vals = [1e-10, 1e-9, 1e-8, 1e-7, 1e-6, 1e-5, 1e-4, 1e-3, 1e-2, 1e-1, 0.5, 1 - 1e-1, 1 - 1e-2, 1 - 1e-3, 1 - 1e-4, 1 - 1e-5, 1 - 1e-6, 1 - 1e-7, 1 - 1e-8, 1 - 1e-9, 1 - 1e-10];\n    var index_offset = Math.floor(axis_stretch_at_extremes * 0.65);\n    var middle_index = vals.indexOf(0.5);\n    var start_index = middle_index - index_offset;\n    var end_index = middle_index + index_offset;\n\n    if (axis_stretch_at_extremes > 2.5) {\n      return [0].concat(vals.slice(start_index, end_index + 1)).concat([1]);\n    } else {\n      return null;\n    }\n  };\n}\n\nfunction _get_label(d3) {\n  return function (d, level_keys, level_names) {\n    var lev_name = d.key;\n    var lev_index = level_keys.indexOf(lev_name);\n    var this_name = level_names[lev_index];\n    var ms = d.data.match_status;\n    var level_prop = d3.format(\",.2%\")(d.data[d.key]);\n    this_name = this_name.replace(\"_\", \" \");\n    this_name = this_name.charAt(0).toUpperCase() + this_name.slice(1);\n    return \"\".concat(this_name, \": \").concat(level_prop, \" of \").concat(ms, \"es\");\n  };\n}\n\nfunction _gen_x_scale(d3) {\n  return function (axis_stretch_at_extremes, width, internal_width) {\n    //https://www.wolframalpha.com/input/?i=solve+y%3D+log_b%28%28x%2Bc%29%2F%28c-x%29%29\n    if (axis_stretch_at_extremes == 0) {\n      return d3.scaleLinear().domain([0, 1]).range([0, internal_width]);\n    }\n\n    var squash = axis_stretch_at_extremes;\n    var my_fn;\n\n    if (squash >= 0) {\n      my_fn = function my_fn(x) {\n        return Math.pow(5, x) / (Math.pow(5, x) + 1);\n      };\n    } else {\n      my_fn = function my_fn(x) {\n        return -1 * Math.log((x + 8.01) / (8.01 - x));\n      };\n\n      var root = 1 / 3;\n      var multiple = 8 / Math.pow(8, root);\n      squash = -Math.pow(-squash, root) * multiple;\n    }\n\n    var offset_scale = d3.scaleLinear().domain([0, 1]).range([-squash, squash]);\n    var num_points = 50;\n    var in_values_not_normalised = d3.range(num_points + 1).map(function (d) {\n      return d / num_points;\n    }).map(offset_scale).map(my_fn);\n    var ext = d3.extent(in_values_not_normalised);\n    var normalise_scale = d3.scaleLinear().domain(ext).range([0, 1]);\n    var domain = in_values_not_normalised.map(normalise_scale);\n    var range = d3.range(num_points + 1).map(function (d) {\n      return internal_width * d / num_points;\n    });\n    return d3.scaleLinear().domain(domain).range(range);\n  };\n}\n\nfunction _get_level_colours_scale(d3) {\n  return function (stacked_data) {\n    var scheme = d3.schemeGnBu;\n    scheme[2] = [scheme[3][0], scheme[3][2]];\n    return d3.scaleOrdinal().domain(stacked_data[\"m_u\"].map(function (d) {\n      return d.key;\n    })).range(scheme[stacked_data[\"m_u\"].length]);\n  };\n}\n\nfunction _get_drag(d3, get_lam, get_m_u, unstacked_data_to_stacked, Event) {\n  return function (enclosed_data, redraw) {\n    // By passing data and redraw and then defining a function\n    // we create a closure over data and redraw, making them\n    // available to the drag function\n    return d3.drag().on(\"drag\", function (e) {\n      // Lam\n      enclosed_data.unstacked_data.lam = get_lam(e, enclosed_data); // Now reallocate between bins\n\n      enclosed_data.unstacked_data.m_u = get_m_u(e, enclosed_data);\n      var plot_data = unstacked_data_to_stacked(enclosed_data.unstacked_data);\n      enclosed_data.stacked_data = plot_data;\n      enclosed_data.final_output.value = enclosed_data.unstacked_data;\n      redraw(enclosed_data);\n      enclosed_data.final_output.dispatchEvent(new Event(\"input\"));\n    });\n  };\n}\n\nfunction _get_lam() {\n  return function get_lam(e, enclosed_data) {\n    var x = enclosed_data.x;\n    var start_lam = enclosed_data.unstacked_data.lam;\n    var start_lam_x = x(start_lam);\n    var new_lam = x.invert(start_lam_x - e.dx);\n    new_lam = Math.min(new_lam, 1);\n    new_lam = Math.max(new_lam, 0);\n    return new_lam;\n  };\n}\n\nfunction _get_m_u() {\n  return function get_m_u(e, enclosed_data) {\n    //Note that e.subject, the datum associated with the rectangle, is fixed\n    // so for instance, the proportions contained in this data will not change\n    // during the course of an individual drag event\n    // m_u is being updated though, so it's actually m_u which contains the\n    // most up-to-date data associated with the diagram and hence this should be used\n    // for geometric calculations\n    var level_keys = enclosed_data.level_keys;\n    var stacked_data = enclosed_data.stacked_data;\n    var y = enclosed_data.y;\n    var m_u = enclosed_data.unstacked_data.m_u; //   Get proportions associated with dragged rect\n\n    var this_level_name = e.subject.key;\n    var level_index = level_keys.indexOf(this_level_name);\n    var match_index = e.subject.data.match_index;\n    var dragged_cum_proportions = stacked_data.m_u[level_index][match_index]; //Get target level\n\n    var start_of_this_level_prop = dragged_cum_proportions[0];\n    var end_of_this_level_prop = dragged_cum_proportions[1];\n    var start_level_y = y(start_of_this_level_prop);\n    var end_level_y = y(end_of_this_level_prop); // let midpoint_y = (y(e.subject[0]) + y(e.subject[1])) / 2;\n\n    var midpoint_y = (start_level_y + end_level_y) / 2;\n    var in_top_half;\n\n    if (e.y < midpoint_y) {\n      in_top_half = true;\n    } else {\n      in_top_half = false;\n    }\n\n    var target_level_index;\n    var dragging_from_bottom;\n\n    if (in_top_half) {\n      target_level_index = level_index + 1;\n      dragging_from_bottom = false;\n    } else {\n      target_level_index = level_index + -1;\n      dragging_from_bottom = true;\n    }\n\n    if (level_index == 0) {\n      target_level_index = 1;\n      dragging_from_bottom = false;\n    }\n\n    if (level_index == level_keys.length - 1) {\n      target_level_index = level_keys.length - 2;\n      dragging_from_bottom = true;\n    } // Get y location we're starting the drag from\n\n\n    var cum_proportion_drag_start;\n\n    if (dragging_from_bottom) {\n      cum_proportion_drag_start = start_of_this_level_prop;\n    } else {\n      cum_proportion_drag_start = end_of_this_level_prop;\n    }\n\n    var change_from_start_prop;\n    var y_start = y(cum_proportion_drag_start);\n    var y_start_with_delta = y_start + e.dy;\n    var prop_start = y.invert(y_start);\n    var prop_end = y.invert(y_start_with_delta); //   Update data\n\n    var change_in_prop = prop_end - prop_start;\n\n    if (!dragging_from_bottom) {\n      change_in_prop = -change_in_prop;\n    }\n\n    var target_level = level_keys[target_level_index];\n    var new_val_this_lev = m_u[match_index][this_level_name] - change_in_prop;\n    var new_val_target_lev = m_u[match_index][target_level] + change_in_prop;\n\n    function isBetween(n, a, b) {\n      return (n - a) * (n - b) <= 0;\n    }\n\n    if (isBetween(new_val_this_lev, 0, 1) && isBetween(new_val_target_lev, 0, 1)) {\n      m_u[match_index][this_level_name] = new_val_this_lev;\n      m_u[match_index][target_level] = new_val_target_lev;\n    }\n\n    return m_u;\n  };\n}\n\nfunction _margin() {\n  var m_size = 60;\n  return {\n    top: 80,\n    right: m_size,\n    bottom: m_size,\n    left: m_size\n  };\n}\n\nfunction _get_scale(d3) {\n  return function (match_status, lam, x) {\n    var padding = 0.000;\n    var s1 = d3.scaleBand().domain(['match']).range([x(1 - lam), x(1)]).padding(padding);\n    var s2 = d3.scaleBand().domain(['non-match']).range([x(0), x(1 - lam)]).padding(padding);\n\n    if (match_status == 'match') {\n      return s1;\n    } else {\n      return s2;\n    }\n  };\n}\n\nfunction _input_control(num_levels_to_level_keys) {\n  return function input_control(widget_data) {\n    var num_levels = widget_data.m_u[0].length;\n    var levels = num_levels_to_level_keys(num_levels);\n    var m = levels.map(function (lev) {\n      return widget_data.m_u[1][lev];\n    });\n    var u = levels.map(function (lev) {\n      return widget_data.m_u[0][lev];\n    });\n    return {\n      proportion_of_matches: widget_data.lam,\n      comparison_columns: [{\n        col_name: 'my column',\n        m_probabilities: m,\n        u_probabilities: u,\n        num_levels: levels.length\n      }]\n    };\n  };\n}\n\nfunction _height() {\n  return 500;\n}\n\nfunction _unstacked_data_to_stacked(level_keys_from_unstacked_data, d3) {\n  return function (unstacked_data) {\n    var level_keys = level_keys_from_unstacked_data(unstacked_data);\n    var stack = d3.stack().keys(level_keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);\n    var stacked = stack(unstacked_data[\"m_u\"]);\n    stacked = stacked.map(function (d) {\n      return d.forEach(function (v) {\n        return v.key = d.key;\n      }), d;\n    });\n    return {\n      lam: unstacked_data.lam,\n      m_u: stacked\n    };\n  };\n}\n\nfunction _level_keys_from_unstacked_data() {\n  return function (unstacked_data) {\n    return Object.keys(unstacked_data.m_u[0]).filter(function (d) {\n      return d.includes('level_');\n    });\n  };\n}\n\nfunction _input_control_data_to_splink_settings(level_keys_from_unstacked_data, num_levels_to_level_keys) {\n  return function input_control_data_to_splink_settings(input_control_data) {\n    var num_levels = level_keys_from_unstacked_data(input_control_data).length;\n    var levels = num_levels_to_level_keys(num_levels);\n    var m = levels.map(function (lev) {\n      return input_control_data.m_u[1][lev];\n    });\n    var u = levels.map(function (lev) {\n      return input_control_data.m_u[0][lev];\n    });\n    return {\n      proportion_of_matches: input_control_data.lam,\n      comparison_columns: [{\n        col_name: ' ',\n        m_probabilities: m,\n        u_probabilities: u,\n        num_levels: levels.length\n      }]\n    };\n  };\n}\n\nfunction _num_levels_to_level_keys(d3) {\n  return function (num_levels) {\n    return d3.range(num_levels).map(function (d) {\n      return \"level_\" + d;\n    });\n  };\n}\n\nfunction _format_tick() {\n  return function (d) {\n    return d.toString();\n  };\n}\n\nfunction _normalise() {\n  return function normalise(arr) {\n    var sum = arr.reduce(function (a, b) {\n      return a + b;\n    }, 0);\n    return arr.map(function (d) {\n      return d / sum;\n    });\n  };\n}\n\nfunction _gen_starting_data(num_levels_to_level_keys, d3, normalise) {\n  return function (num_levels) {\n    var level_keys = num_levels_to_level_keys(num_levels);\n    var settings = {\n      proportion_of_matches: 0.3,\n      comparison_columns: [{\n        col_name: \" \",\n        m_probabilities: null,\n        u_probabilities: null\n      }]\n    };\n    var norm = d3.range(1, num_levels + 1).reduce(function (d, acc) {\n      return d + acc;\n    }, 0);\n    var m_probs = d3.range(1, num_levels + 1, 1).map(function (d) {\n      return Math.pow(d, 2);\n    });\n    m_probs = normalise(m_probs);\n    var u_probs = d3.range(num_levels, 0, -1).map(function (d) {\n      return Math.pow(d, 2);\n    });\n    u_probs = normalise(u_probs);\n    settings.comparison_columns[0].m_probabilities = m_probs;\n    settings.comparison_columns[0].u_probabilities = u_probs;\n    return settings;\n  };\n}\n\nfunction _30(md) {\n  return md(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"#### External fns\"])));\n}\n\nfunction _32(md) {\n  return md(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"#### External libs\"])));\n}\n\nfunction _inputs(require) {\n  return require(\"@observablehq/inputs\");\n}\n\nfunction _d3(require) {\n  return require(\"d3@6\");\n}\n\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer(\"viewof num_levels\")).define(\"viewof num_levels\", [\"inputs\"], _num_levels);\n  main.variable(observer(\"num_levels\")).define(\"num_levels\", [\"Generators\", \"viewof num_levels\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer()).define([\"md\"], _3);\n  main.variable(observer(\"viewof thing\")).define(\"viewof thing\", [\"m_u_input_control\", \"width\", \"height\", \"starting_data\"], _thing);\n  main.variable(observer(\"thing\")).define(\"thing\", [\"Generators\", \"viewof thing\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"gen_y_scale\")).define(\"gen_y_scale\", [\"d3\"], _gen_y_scale);\n  main.variable(observer(\"m_u_input_control\")).define(\"m_u_input_control\", [\"DOM\", \"d3\", \"margin\", \"splink_data_to_unstacked_data\", \"unstacked_data_to_stacked\", \"num_levels_to_level_keys\", \"get_level_colours_scale\", \"inputs\", \"gen_x_scale\", \"gen_y_scale\", \"html\", \"get_tick_vals\", \"redraw\"], _m_u_input_control);\n  main.variable(observer()).define([\"thing\"], _7);\n  main.variable(observer(\"redraw\")).define(\"redraw\", [\"gen_x_scale\", \"gen_y_scale\", \"get_scale\", \"get_drag\", \"get_label\", \"get_tick_vals\", \"d3\", \"format_tick\"], _redraw);\n  main.variable(observer(\"starting_data\")).define(\"starting_data\", [\"normalise\", \"d3\", \"num_levels\"], _starting_data);\n  main.variable(observer(\"splink_data_to_unstacked_data\")).define(\"splink_data_to_unstacked_data\", _splink_data_to_unstacked_data);\n  main.variable(observer(\"get_tick_vals\")).define(\"get_tick_vals\", _get_tick_vals);\n  main.variable(observer(\"get_label\")).define(\"get_label\", [\"d3\"], _get_label);\n  main.variable(observer(\"gen_x_scale\")).define(\"gen_x_scale\", [\"d3\"], _gen_x_scale);\n  main.variable(observer(\"get_level_colours_scale\")).define(\"get_level_colours_scale\", [\"d3\"], _get_level_colours_scale);\n  main.variable(observer(\"get_drag\")).define(\"get_drag\", [\"d3\", \"get_lam\", \"get_m_u\", \"unstacked_data_to_stacked\", \"Event\"], _get_drag);\n  main.variable(observer(\"get_lam\")).define(\"get_lam\", _get_lam);\n  main.variable(observer(\"get_m_u\")).define(\"get_m_u\", _get_m_u);\n  main.variable(observer(\"margin\")).define(\"margin\", _margin);\n  main.variable(observer(\"get_scale\")).define(\"get_scale\", [\"d3\"], _get_scale);\n  main.variable(observer(\"input_control\")).define(\"input_control\", [\"num_levels_to_level_keys\"], _input_control);\n  main.variable(observer(\"height\")).define(\"height\", _height);\n  main.variable(observer(\"unstacked_data_to_stacked\")).define(\"unstacked_data_to_stacked\", [\"level_keys_from_unstacked_data\", \"d3\"], _unstacked_data_to_stacked);\n  main.variable(observer(\"level_keys_from_unstacked_data\")).define(\"level_keys_from_unstacked_data\", _level_keys_from_unstacked_data);\n  main.variable(observer(\"input_control_data_to_splink_settings\")).define(\"input_control_data_to_splink_settings\", [\"level_keys_from_unstacked_data\", \"num_levels_to_level_keys\"], _input_control_data_to_splink_settings);\n  main.variable(observer(\"num_levels_to_level_keys\")).define(\"num_levels_to_level_keys\", [\"d3\"], _num_levels_to_level_keys);\n  main.variable(observer(\"format_tick\")).define(\"format_tick\", _format_tick);\n  main.variable(observer(\"normalise\")).define(\"normalise\", _normalise);\n  main.variable(observer(\"gen_starting_data\")).define(\"gen_starting_data\", [\"num_levels_to_level_keys\", \"d3\", \"normalise\"], _gen_starting_data);\n  main.variable(observer()).define([\"md\"], _30);\n  var child1 = runtime.module(define1);\n  main.import(\"get_m_u_chart\", child1);\n  main.import(\"get_bayes_factor_chart\", child1);\n  main.variable(observer()).define([\"md\"], _32);\n  main.variable(observer(\"inputs\")).define(\"inputs\", [\"require\"], _inputs);\n  main.variable(observer(\"d3\")).define(\"d3\", [\"require\"], _d3);\n  return main;\n}","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10;\n\n// https://observablehq.com/@robinl/dependencies-between-match-weights@158\nimport define1 from \"./34fd4ef09fb0509a@2296.js\";\nimport define2 from \"./817db6818ab226c0@104.js\";\n\nfunction _title(md) {\n  return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Dependencies between match weights\"])));\n}\n\nfunction _2(md) {\n  return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"*A final version of this notebook can be viewed on my blog [here](https://www.robinlinacre.com/match_weight_dependencies/).*\"])));\n}\n\nfunction _para_1(md) {\n  return md(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"The values of a column's match weights are interdependent:  Only certain combinations of values are possible.  \\n\\nSome types of data also result in maximum and minimum match weights.\\n\\nUnderstanding why these constraints occur can help you build better models, because it can help you find ways to extract more information from your comparison columns.\\n\\nThis article tries to build an intuition for why these constraints occur and why they matter.\\n\"])));\n}\n\nfunction _para_2(md, tex) {\n  return md(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"## Example of a maximum match weight:  Gender\\nConsider a column for gender, and let's assume there's an equal split of males and females in our data.\\n\\nA match on gender does not provide strong evidence in favour of a match because it's common to observe a match on gender amongst non-matching records.\\n\\nThis suggests there is an upper bound on the Bayes Factor for gender.  It turns out that, for this data, the maximum Bayes Factor is 2.0.\\n\\n Let's explore what this looks like visually, which will reveal the constraint.  Note that:\\n\\n- Amongst non-matching records, the gender field is just as likely to match as to mismatch, i.e.  \", \" and \", \".\\n\\n-  \\u2728You can drag within the rectangles of the following diagram to see the effect of different m and u values on match weights\\u2728\\n\"])), tex(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"u_\\text{gender, level 0} = 0.5\"], [\"u_\\\\text{gender, level 0} = 0.5\"]))), tex(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"u_\\text{gender, level 1} = 0.5\"], [\"u_\\\\text{gender, level 1} = 0.5\"]))));\n}\n\nfunction _gen(reset_gender, m_u_input_control, width, settings_gender) {\n  reset_gender;\n  return m_u_input_control(width, 400, settings_gender, 0, 1);\n}\n\nfunction _reset_gender(inputs) {\n  return inputs.button(\"Reset gender values\");\n}\n\nfunction _bf_chart_gender(get_bayes_factor_chart, input_control_data_to_splink_settings, gen) {\n  return get_bayes_factor_chart(input_control_data_to_splink_settings(gen));\n}\n\nfunction _para_3(md) {\n  return md(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"### Observations\\n\\nTwo important findings emerge from this example:\\n\\n- There is a maximum bound of 2 on the match weight associated with a match on gender.  This is intuitive:  a match weight of two means that, if we observe a match on gender, it's now twice as likely that the records are a match - reflecting the equal split of genders.\\n\\n- There is no minimum bound of the match weight associated with a mismatch on gender.  This is also intuitive.  If gender is recorded with very high accuracy, then a mismatch on gender represents very strong evidence against a match.\\n\"])));\n}\n\nfunction _para_4(md) {\n  return md(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"## Example of a minimum match weights:  Forename\\n\\nConsider a forename column.  Let's assume that nicknames, diminutives are common in this dataset.  For example, it may be common for someone called 'Jonathan' to appear variously as 'Jonathan', 'John' or 'Jonny'.  As such, it will be common that, amongst matches, the forename does not exactly match.\\n\\nConsider the following chart, which models this column with two comparison levels:\\n- Level 1: Forename matches exactly\\n- Level 0: Forname mismatches \\n\\nIn this scenario, the observation of a mismatch on forename does not provide strong evidence against a match, because it is so common to observe a mismatch amongst matching records.  \\n\"])));\n}\n\nfunction _fn1(reset_fn1, m_u_input_control, width, settings_forename_1) {\n  reset_fn1;\n  return m_u_input_control(width, 400, settings_forename_1, 0, 3);\n}\n\nfunction _reset_fn1(inputs) {\n  return inputs.button(\"Reset forename values\");\n}\n\nfunction _bf_chart_fn_1(get_bayes_factor_chart, input_control_data_to_splink_settings, fn1) {\n  return get_bayes_factor_chart(input_control_data_to_splink_settings(fn1));\n}\n\nfunction _para_5(md) {\n  return md(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"Using a more sophisticted modelling approach, we can do better.\\n\\nLet's assume that we can capture the vast majority of nicknames and diminutives using a fuzzy matching function.  This allows us to draw a distinction between two scenarios:\\n- Values do not match, but are similar\\n- Values do not match, and are completely different.\\n\\nWe now set up our levels as follows:\\n- Level 2: Exact match on forename\\n- Level 1: Fuzzy match on forename\\n- Level 0: Forename mismatches\\n\\n\\n\"])));\n}\n\nfunction _fn2(reset_fn2, m_u_input_control, width, settings_forename_2) {\n  reset_fn2;\n  return m_u_input_control(width, 400, settings_forename_2, 0, 3);\n}\n\nfunction _reset_fn2(inputs) {\n  return inputs.button(\"Reset forename values\");\n}\n\nfunction _bf_chart_fn_2(get_bayes_factor_chart, input_control_data_to_splink_settings, fn2) {\n  return get_bayes_factor_chart(input_control_data_to_splink_settings(fn2));\n}\n\nfunction _para_6(md) {\n  return md(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"## Observations\\n\\n- When we modelled two levels, two names that fuzzy matched (John vs Jonny) would have been assigned the same negative match weight as two names which were completely different (John vs Robin).  We therefore lost information\\n- When we model three levels, a much stronger negative weight on a mismatch is possible.  This is because the lowest level (level_0) now contains only names which are completely different, rather than being a mix of fuzzy matching names, and names which are competely different.\\n\\nModelling three levels thereby allows us to extract substantially more information from the data.\\n\"])));\n}\n\nfunction _settings_gender() {\n  return {\n    proportion_of_matches: 0.3,\n    comparison_columns: [{\n      col_name: \"gender\",\n      m_probabilities: [0.1, 0.9],\n      u_probabilities: [0.5, 0.5]\n    }],\n    level_names: [\"Gender mismatches\", \"Gender matches\"]\n  };\n}\n\nfunction _settings_forename_1() {\n  return {\n    proportion_of_matches: 0.3,\n    comparison_columns: [{\n      col_name: \"gender\",\n      m_probabilities: [0.3, 0.7],\n      u_probabilities: [0.9, 0.1]\n    }],\n    level_names: [\"Forname mismatches\", \"Forename matches exactly\"]\n  };\n}\n\nfunction _settings_forename_2() {\n  return {\n    proportion_of_matches: 0.3,\n    comparison_columns: [{\n      col_name: \"gender\",\n      m_probabilities: [0.05, 0.25, 0.7],\n      u_probabilities: [0.75, 0.15, 0.1]\n    }],\n    level_names: [\"Forname mismatches\", \"Forename fuzzy matches\", \"Forename matches\"]\n  };\n}\n\nfunction _inputs(require) {\n  return require(\"@observablehq/inputs\");\n}\n\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer(\"title\")).define(\"title\", [\"md\"], _title);\n  main.variable(observer()).define([\"md\"], _2);\n  main.variable(observer(\"para_1\")).define(\"para_1\", [\"md\"], _para_1);\n  main.variable(observer(\"para_2\")).define(\"para_2\", [\"md\", \"tex\"], _para_2);\n  main.variable(observer(\"viewof gen\")).define(\"viewof gen\", [\"reset_gender\", \"m_u_input_control\", \"width\", \"settings_gender\"], _gen);\n  main.variable(observer(\"gen\")).define(\"gen\", [\"Generators\", \"viewof gen\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"viewof reset_gender\")).define(\"viewof reset_gender\", [\"inputs\"], _reset_gender);\n  main.variable(observer(\"reset_gender\")).define(\"reset_gender\", [\"Generators\", \"viewof reset_gender\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"bf_chart_gender\")).define(\"bf_chart_gender\", [\"get_bayes_factor_chart\", \"input_control_data_to_splink_settings\", \"gen\"], _bf_chart_gender);\n  main.variable(observer(\"para_3\")).define(\"para_3\", [\"md\"], _para_3);\n  main.variable(observer(\"para_4\")).define(\"para_4\", [\"md\"], _para_4);\n  main.variable(observer(\"viewof fn1\")).define(\"viewof fn1\", [\"reset_fn1\", \"m_u_input_control\", \"width\", \"settings_forename_1\"], _fn1);\n  main.variable(observer(\"fn1\")).define(\"fn1\", [\"Generators\", \"viewof fn1\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"viewof reset_fn1\")).define(\"viewof reset_fn1\", [\"inputs\"], _reset_fn1);\n  main.variable(observer(\"reset_fn1\")).define(\"reset_fn1\", [\"Generators\", \"viewof reset_fn1\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"bf_chart_fn_1\")).define(\"bf_chart_fn_1\", [\"get_bayes_factor_chart\", \"input_control_data_to_splink_settings\", \"fn1\"], _bf_chart_fn_1);\n  main.variable(observer(\"para_5\")).define(\"para_5\", [\"md\"], _para_5);\n  main.variable(observer(\"viewof fn2\")).define(\"viewof fn2\", [\"reset_fn2\", \"m_u_input_control\", \"width\", \"settings_forename_2\"], _fn2);\n  main.variable(observer(\"fn2\")).define(\"fn2\", [\"Generators\", \"viewof fn2\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"viewof reset_fn2\")).define(\"viewof reset_fn2\", [\"inputs\"], _reset_fn2);\n  main.variable(observer(\"reset_fn2\")).define(\"reset_fn2\", [\"Generators\", \"viewof reset_fn2\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"bf_chart_fn_2\")).define(\"bf_chart_fn_2\", [\"get_bayes_factor_chart\", \"input_control_data_to_splink_settings\", \"fn2\"], _bf_chart_fn_2);\n  main.variable(observer(\"para_6\")).define(\"para_6\", [\"md\"], _para_6);\n  main.variable(observer(\"settings_gender\")).define(\"settings_gender\", _settings_gender);\n  main.variable(observer(\"settings_forename_1\")).define(\"settings_forename_1\", _settings_forename_1);\n  main.variable(observer(\"settings_forename_2\")).define(\"settings_forename_2\", _settings_forename_2);\n  main.variable(observer(\"inputs\")).define(\"inputs\", [\"require\"], _inputs);\n  var child1 = runtime.module(define1);\n  main.import(\"m_u_input_control\", child1);\n  main.import(\"input_control_data_to_splink_settings\", child1);\n  var child2 = runtime.module(define2);\n  main.import(\"get_m_u_chart\", child2);\n  main.import(\"get_bayes_factor_chart\", child2);\n  return main;\n}","import React from 'react'\nimport define from \"@robinl/dependencies-between-match-weights\"\nimport ProbLinkagePage from \"../components/prob_linkage_page\"\nimport { css } from \"@emotion/core\"\n\nexport const frontmatter = {\n    title: \"Dependencies between match weights\",\n    post_date: \"2021-06-10\",\n    code_url: \"https://observablehq.com/@robinl/dependencies-between-match-weights\",\n    post_type: \"obs\",\n    post_category: \"probabilistic_linkage\",\n    description: \"An set of interactive, explorable explanations of the Fellegi Sunter model of probabilistic record linkage.  The dependencies between match weights\"\n}\n\nlet output_order = [\n    \"title\",\n    \"para_1\",\n    \"para_2\",\n    \"viewof gen\",\n    \"viewof reset_gender\",\n    \"bf_chart_gender\",\n    \"para_3\",\n    \"para_4\",\n    \"viewof fn1\",\n    \"viewof reset_fn1\",\n    \"bf_chart_fn_1\",\n    \"para_5\",\n    \"viewof fn2\",\n    \"viewof reset_fn2\",\n    \"bf_chart_fn_2\",\n    \"para_6\",\n\n\n\n\n\n]\n\nconst css_override = css`\nmargin-left: auto;\nmargin-right: auto;\nwidth: 90%;\nmax-width: 800px;\ntable {font-size: 0.8rem;\n line-height: 1rem;}\nrem;\n`\n\nexport default (props) => {\n\n    return (<ProbLinkagePage\n        define={define}\n        output_order={output_order}\n        post_frontmatter={frontmatter}\n        css={css_override}\n        current_path={props.path}\n    />)\n\n\n}"],"sourceRoot":""}