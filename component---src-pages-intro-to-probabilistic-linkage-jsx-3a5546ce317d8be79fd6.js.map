{"version":3,"sources":["webpack://gatsby-starter-hello-world/./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js","webpack://gatsby-starter-hello-world/./src/components/linkage_footer.jsx","webpack://gatsby-starter-hello-world/./src/components/prob_linkage_page.jsx","webpack://gatsby-starter-hello-world/./node_modules/@robinl/d51533bbe054b3d8/79750b3b8e929d9d@209.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/d51533bbe054b3d8/d25176b0fe784ad0@488.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/d51533bbe054b3d8/843cb6e82d7c3d9b@474.js","webpack://gatsby-starter-hello-world/./node_modules/@robinl/d51533bbe054b3d8/d51533bbe054b3d8@510.js","webpack://gatsby-starter-hello-world/./src/pages/intro_to_probabilistic_linkage.jsx"],"names":["_taggedTemplateLiteral","strings","raw","slice","Object","freeze","defineProperties","value","mar","flex","order_of_articles","props","path","current_path","this_index","indexOf","previous_article","next_article","undefined","to","css","post","define","output_order","className","title","post_frontmatter","description","_templateObject","_templateObject2","_templateObject3","_templateObject4","_templateObject5","_templateObject6","_templateObject7","_templateObject8","_templateObject9","_templateObject10","_templateObject11","_templateObject12","_templateObject13","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperty","_1","md","_2","_aq","_x","_x2","_x3","_x4","_aq2","this","_callee","require","aq_version","aq_packages","toView","aq","_context","prev","next","concat","sent","Promise","all","map","pkg","addPackage","addTableMethod","override","abrupt","stop","_aq_version","_aq_packages","_6","_op","op","_8","_9","_10","_11","_12","_dt","table","_14","_15","dt","derive","month","d","row_number","diff","Seattle","Chicago","select","orderby","view","height","_16","_17","rollup","corr_sf","corr","corr_chi","_18","_19","fold","as","groupby","min","sun","max","avg","average","med","median","skew","_ref","s","mean","stdev","objects","_20","_toView","html","DEFAULT_NULL","tableStyle","cellStyle","opt","limit","color","columnNames","name","_loop","td","index","row","maxCellWidth","null","style","th","size","toHTML","runtime","observer","main","module","variable","_records_l","uid","fname","sname","dob","town","_records_r","_df_r","records_r","from","_splink_settings","proportion_of_matches","comparison_columns","num_levels","col_name","u_probabilities","m_probabilities","case_expression","fname_l","fname_r","sname_l","sname_r","dob_l","dob_r","town_l","town_r","_df_comparison","get_df_comparison","records_l","_7","df_comparison","_df_gammas","get_df_gammas","splink_settings","df_gammas","get_df_e","term_freqs","_get_df_e","get_match_probability","df_e","df","relocate","after","_get_match_probability","prob_to_log2_bf","log2_bf_to_prob","settings","prior_log2_bg","log2_bayes","reduce","a","cc","gamma_col_name","gamma","m","u","l_val","toLowerCase","r_val","tfs","u_l","u_r","u_new","Math","log2","_get_match_probability_components","num_columns","comparison_vector","gamma_symbols","m_values","u_values","m_symbols","u_symbols","bayes_factors","log2_bayes_factors","col_names","match_probability","lam","col_name_escaped","replace","bf","b","_get_m_u_formula_numbers","get_match_probability_components","toPrecision","lam_m","lam_u","m_tex","join","u_tex","p","m_part","u_part","_get_m_u_formula_symbols","tex","get_m_u_formula_symbols","_get_comparison_vector_symbols_and_numbers","joined","joined2","get_comparison_vector_symbols_and_numbers","get_m_u_formula_numbers","_21","_get_df_comparison","records_as_dict_l","records_as_dict_r","df_l","df_r","suffix","colname_no_suffix","cols_ordered","_get_df_gammas","col_order","_bayes_factor_to_prob","_log2_bf_to_prob","bayes_factor_to_prob","pow","_prob_to_bayes_factor","_prob_to_log2_bf","prob_to_bayes_factor","_first_name_lookup","d3","csv","autoType","then","csv_file","lookup","firstname","freq","_surname_lookup","surname","_term_freqs","first_name_lookup","surname_lookup","_32","_33","child1","import","_3","_row","first_name_l","first_name_r","surname_l","surname_r","date_of_birth_l","_overrides","get_waterfall_chart","overrides","_get_waterfall_chart","get_waterfall_chart_data","embed","get_chart_spec","chart_overrides","simplified","data","_get_comparison_column_lookup","_get_waterfall_chart_data","get_waterfall_data_lambda_row","get_waterfall_data_other_rows","get_waterfall_data_final_row","lambda_row","waterfall_data_other_rows","rows_except_final","final_row","cumulative_log2_bayes_factor","_get_waterfall_row_gamma","get_comparison_column_lookup","gamma_key","u_probability","m_probability","gamma_value","this_cc","value_l","value_r","bayes_factor","column_name","gamma_column_name","gamma_index","level_name","log2_bayes_factor","_get_waterfall_data_lambda_row","prob_to_log2_bayes_factor","_get_waterfall_data_other_rows","get_waterfall_row_gamma","includes","_get_waterfall_data_final_row","_get_chart_spec","base_spec","base_spec_2","JSON","parse","stringify","values","spec","type","field","condition","test","expr","format","_base_spec","config","continuousHeight","continuousWidth","text","subtitle","transform","window","frame","calculate","layer","mark","encoding","y","width","opacity","tooltip","x","axis","labelExpr","labelAlign","labelPadding","grid","tickBand","sort","orient","y2","fontWeight","labelAngle","baseline","dy","strokeWidth","x2Offset","xOffset","x2","scale","zero","resolve","step","$schema","_embed","_log2","_prob_to_log2_bayes_factor","_log2_bayes_factor_to_prob","log2_b","first_name","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","minLen","_arrayLikeToArray","n","prototype","toString","call","constructor","_unsupportedIterableToArray","F","done","e","_e","f","TypeError","err","normalCompletion","didErr","_e2","return","arr","len","arr2","_title","_para_1","_para_2","_para_3","_para_4","_para_5","_table","_estimated_probability","match_prob","_para_6","_show_complex","inputs","toggle","label","_waterfall_chart","show_complex","_para_7","_structure","_para_8","_match_prob","_tableData","Generators","parseTableData","observe","notify","keyinput","event","addEventListener","removeEventListener","_parseTableData","querySelectorAll","_step","row_data","_iterator","cells","innerText","trim","accumulator","properties","rowObject","_df_e","rename_dict_keys","tableData","_rename_dict_keys","mname","pc","_fname_case_stmt","dm_intersect","distance","_mname_case_stmt","mname_l","mname_r","_sname_case_stmt","_abs_date_diff_in_years","date_l","date_r","d_l","Date","d_r","abs","_dob_case_stmt","levenshtein","abs_date_diff_in_years","_pc_case_stmt","pc_l","pc_r","fname_case_stmt","mname_case_stmt","sname_case_stmt","dob_case_stmt","pc_case_stmt","_dm","_distance","_dm_intersect","dm","val_l","val_r","arr_l","doubleMetaphone","arr_r","_levenshtein","j","matrix","charAt","_d3","_inputs","G","_","input","child2","frontmatter","post_date","code_url","post_type","post_category","css_override"],"mappings":"4IAAe,SAASA,EAAuBC,EAASC,GAKtD,OAJKA,IACHA,EAAMD,EAAQE,MAAM,IAGfC,OAAOC,OAAOD,OAAOE,iBAAiBL,EAAS,CACpDC,IAAK,CACHK,MAAOH,OAAOC,OAAOH,O,qJCD3B,IAWMM,EAAG,+DAKHC,EAAI,qEAQJC,EAAoB,CACxB,mCACA,4BACA,+BACA,gCACA,8BACA,mBAoCF,EAjCsB,SAACC,GAErB,IAAIC,EAAOD,EAAME,aAEbC,EAAaJ,EAAkBK,QAAQH,GAEvCI,EAAmBN,EAAkBI,EAAa,GAClDG,EAAeP,EAAkBI,EAAa,GAclD,OAXEE,OADuBE,IAArBF,GACiB,qBAEA,oBAAK,QAAC,KAAD,CAAMG,GAAIH,GAAV,wBAIxBC,OADmBC,IAAjBD,GACa,qBAEA,oBAAK,QAAC,KAAD,CAAME,GAAIF,GAAV,qBAIpB,oBACE,cAAIG,IAAKZ,KACT,eAAKY,IAAKX,GACPO,GACD,oBAAK,QAAC,KAAD,CAAMG,GAAG,0BAAT,+BACJF,K,8BCrCT,MArBA,SAAyBN,GAMvB,IAAIU,GAAO,QAAC,IAAD,CAAwBC,OAAQX,EAAMW,OAAQC,aAAcZ,EAAMY,eAG7E,OACE,QAAC,IAAD,CAAQH,IAAKT,EAAMa,YACjB,QAAC,IAAD,CAAKC,MAAOd,EAAMe,iBAAiBD,MAAOE,YAAahB,EAAMe,iBAAiBC,eAC9E,QAAC,IAAD,CAAiBD,iBAAkBf,EAAMe,mBACxCL,GACD,QAAC,EAAD,CAAeR,aAAcF,EAAME,kB,8HClBrCe,EAAiBC,EAAkBC,EAAkBC,EAAkBC,EAAkBC,EAAkBC,EAAkBC,EAAkBC,EAAkBC,EAAmBC,EAAmBC,EAAmBC,ECF1N,EAAiB,EAAkB,EAAkB,EAAkB,ECCvE,EAAiB,EAAkB,EAAkB,ECDrD,EAAiB,EAAkB,EAAkB,EAAkB,EAAkB,EAAkB,EAAkB,EAAkB,EAAkB,EAAmB,EAAmB,EAAmB,E,iDHM9N,SAASC,EAAQC,EAAQC,GAAkB,IAAIC,EAAOxC,OAAOwC,KAAKF,GAAS,GAAItC,OAAOyC,sBAAuB,CAAE,IAAIC,EAAU1C,OAAOyC,sBAAsBH,GAAaC,IAAkBG,EAAUA,EAAQC,QAAO,SAAUC,GAAO,OAAO5C,OAAO6C,yBAAyBP,EAAQM,GAAKE,eAAkBN,EAAKO,KAAKC,MAAMR,EAAME,GAAY,OAAOF,EAElV,SAASS,EAAcC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAAyB,MAAhBF,UAAUD,GAAaC,UAAUD,GAAK,GAAQA,EAAI,EAAKd,EAAQrC,OAAOsD,IAAS,GAAMC,SAAQ,SAAUC,IAAO,OAAgBN,EAAQM,EAAKF,EAAOE,OAAsBxD,OAAOyD,0BAA6BzD,OAAOE,iBAAiBgD,EAAQlD,OAAOyD,0BAA0BH,IAAmBjB,EAAQrC,OAAOsD,IAASC,SAAQ,SAAUC,GAAOxD,OAAO0D,eAAeR,EAAQM,EAAKxD,OAAO6C,yBAAyBS,EAAQE,OAAe,OAAON,EAG7gB,SAASS,EAAGC,GACV,OAAOA,EAAGpC,IAAoBA,GAAkB,OAAuB,CAAC,4nBAG1E,SAASqC,EAAGD,GACV,OAAOA,EAAGnC,IAAqBA,GAAmB,OAAuB,CAAC,uEAG5E,SAASqC,EAAIC,EAAIC,EAAKC,EAAKC,GACzB,OAAOC,EAAKnB,MAAMoB,KAAMhB,WAG1B,SAASe,IAmCP,OAlCAA,GAAO,OAAgC,UAAyB,SAASE,EAAQC,EAASC,EAAYC,EAAaC,GACjH,IAAIC,EACJ,OAAO,UAAyB,SAAkBC,GAChD,OACE,OAAQA,EAASC,KAAOD,EAASE,MAC/B,KAAK,EAEH,OADAF,EAASE,KAAO,EACTP,EAAQ,WAAWQ,OAAOP,IAEnC,KAAK,EAGH,OAFAG,EAAKC,EAASI,KACdJ,EAASE,KAAO,EACTG,QAAQC,IAAIT,EAAYU,KAAI,SAAUC,GAC3C,OAAOb,EAAQa,OAGnB,KAAK,EASH,OARAR,EAASI,KAAKxB,SAAQ,SAAU4B,GAC9B,OAAOT,EAAGU,WAAWD,MAIvBT,EAAGW,eAAe,OAAQZ,EAAQ,CAChCa,UAAU,IAELX,EAASY,OAAO,SAAUb,GAEnC,KAAK,EACL,IAAK,MACH,OAAOC,EAASa,UAGrBnB,QAEOrB,MAAMoB,KAAMhB,WAG1B,SAASqC,IACP,MAAO,QAGT,SAASC,IACP,MAAO,GAGT,SAASC,EAAG/B,GACV,OAAOA,EAAGlC,IAAqBA,GAAmB,OAAuB,CAAC,uDAG5E,SAASkE,EAAIlB,GACX,OAAOA,EAAGmB,GAGZ,SAASC,EAAGlC,GACV,OAAOA,EAAGjC,IAAqBA,GAAmB,OAAuB,CAAC,gJAG5E,SAASoE,GAAGnC,GACV,OAAOA,EAAGhC,IAAqBA,GAAmB,OAAuB,CAAC,+LAG5E,SAASoE,GAAIpC,GACX,OAAOA,EAAG/B,IAAqBA,GAAmB,OAAuB,CAAC,wHAG5E,SAASoE,GAAIrC,GACX,OAAOA,EAAG9B,IAAqBA,GAAmB,OAAuB,CAAC,oWAG5E,SAASoE,GAAItC,GACX,OAAOA,EAAG7B,IAAqBA,GAAmB,OAAuB,CAAC,0GAG5E,SAASoE,GAAIzB,GACX,OAAOA,EAAG0B,MAAM,CACd,QAAW,CAAC,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,IACjE,QAAW,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACnE,gBAAiB,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,OAI7E,SAASC,GAAIzC,GACX,OAAOA,EAAG5B,IAAqBA,GAAmB,OAAuB,CAAC,sDAG5E,SAASsE,GAAIC,EAAIV,GACf,OAAOU,EAAGC,OAAO,CACfC,MAAO,SAAeC,GACpB,OAAOb,EAAGc,cAEZC,KAAM,SAAcF,GAClB,OAAOA,EAAEG,QAAUH,EAAEI,WAEtBC,OAAO,QAAS,QAAQC,QAAQ,SAASC,KAAK,CAC/CC,OAAQ,MAIZ,SAASC,GAAIvD,GACX,OAAOA,EAAG3B,IAAsBA,GAAoB,OAAuB,CAAC,gEAG9E,SAASmF,GAAIb,EAAIV,GACf,OAAOU,EAAGc,OAAO,CACfC,QAASzB,EAAG0B,KAAK,UAAW,iBAC5BC,SAAU3B,EAAG0B,KAAK,UAAW,aAC5BN,OAGL,SAASQ,GAAI7D,GACX,OAAOA,EAAG1B,IAAsBA,GAAoB,OAAuB,CAAC,sDAG9E,SAASwF,GAAInB,EAAI7B,EAAImB,GACnB,OAAOU,EAAGoB,KAAKjD,EAAGO,MAAO,CACvB2C,GAAI,CAAC,OAAQ,SACZC,QAAQ,QAAQR,OAAO,CACxBS,IAAK,SAAapB,GAChB,OAAOb,EAAGiC,IAAIpB,EAAEqB,MAGlBC,IAAK,SAAatB,GAChB,OAAOb,EAAGmC,IAAItB,EAAEqB,MAElBE,IAAK,SAAavB,GAChB,OAAOb,EAAGqC,QAAQxB,EAAEqB,MAEtBI,IAAK,SAAazB,GAChB,OAAOb,EAAGuC,OAAO1B,EAAEqB,MAGrBM,KAAM,SAAcC,GAClB,IAAIC,EAAID,EAAKP,IACb,OAAQlC,EAAG2C,KAAKD,GAAK1C,EAAGuC,OAAOG,IAAM1C,EAAG4C,MAAMF,IAAM,KAErDG,UAGL,SAASC,GAAI/E,GACX,OAAOA,EAAGzB,IAAsBA,GAAoB,OAAuB,CAAC,2BAG9E,SAASyG,GAAQC,GACf,IAEIC,EAAe,SAAsB3I,GACvC,MAAO,8BAAgC2E,OAAO3E,EAAO,YAGnD4I,EAAa,wDACbC,EAAY,0HAEhB,OAAO,SAAUzC,GACf,IAAI0C,EAAM7F,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,GAAmBA,UAAU,GAAK,GAE3D,iBAAR6F,IAAkBA,EAAM,CACjCC,MAAOD,IAGT,IAAIE,EAAQlG,EAAc,GAAIgG,EAAIE,OAElC,GAAyB,mBAAdF,EAAIE,MAEb5C,EAAG6C,cAAc7F,SAAQ,SAAU8F,GACjC,OAAOF,EAAME,GAAQJ,EAAIE,aAEtB,CACL,IAAIG,EAAQ,SAAe9F,GACzB,IAAIrD,EAAQgJ,EAAM3F,GAClB2F,EAAM3F,GAAwB,mBAAVrD,EAAuBA,EAAQ,WACjD,OAAOA,IAKX,IAAK,IAAIqD,KAAO2F,EACdG,EAAM9F,GAKV,IAAI4C,EAAQ,GAAGtB,OAAOiE,GAElBQ,EAAK,SAAYF,EAAMG,EAAOC,GAChC,MAAO,GAAG3E,OAAOkE,EAAW,gBAAgBlE,QAAQmE,EAAIS,cAAgB,IAAK,QAAUP,EAAME,GAAQ,sBAAsBvE,OAAOqE,EAAME,GAAMG,EAAOC,GAAM,KAAO,KAGpKR,EAAMhG,EAAcA,EAAc,CAChCiG,MA7CgB,IA8ChBS,KAAMb,GACLG,GAAM,GAAI,CACXW,MAAO,CACLxD,MAAOA,EACPmD,GAAIA,EACJM,GAAIN,KAIR,IAAIO,EAAO,eAAehF,QAAQmE,EAAI/B,QAAU,IAAK,MACjD0C,EAAQ,GAAG9E,OAAOgF,EAAM,yCACxB7C,EAAO4B,EAAKzG,IAAsBA,GAAoB,OAAuB,CAAC,eAAiB,KAAO,YAAawH,EAAOrD,EAAGwD,OAAOd,IAExI,OADAhC,EAAK9G,MAAQoG,EACNU,GAII,SAAS,GAAO+C,EAASC,GACtC,IAAIC,EAAOF,EAAQG,SAsBnB,OArBAD,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAOyC,GACzCuG,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO2C,GACzCqG,EAAKE,SAASH,EAAS,OAAO/I,OAAO,KAAM,CAAC,UAAW,aAAc,cAAe,UAAW4C,GAC/FoG,EAAKE,SAASH,EAAS,eAAe/I,OAAO,aAAcuE,GAC3DyE,EAAKE,SAASH,EAAS,gBAAgB/I,OAAO,cAAewE,GAC7DwE,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAOyE,GACzCuE,EAAKE,SAASH,EAAS,OAAO/I,OAAO,KAAM,CAAC,MAAO0E,GACnDsE,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO4E,GACzCoE,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO6E,IACzCmE,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO8E,IACzCkE,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO+E,IACzCiE,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAOgF,IACzCgE,EAAKE,SAASH,EAAS,OAAO/I,OAAO,KAAM,CAAC,MAAOiF,IACnD+D,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAOmF,IACzC6D,EAAKE,SAASH,KAAY/I,OAAO,CAAC,KAAM,MAAOoF,IAC/C4D,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAOiG,IACzC+C,EAAKE,SAASH,KAAY/I,OAAO,CAAC,KAAM,MAAOkG,IAC/C8C,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAOuG,IACzCyC,EAAKE,SAASH,KAAY/I,OAAO,CAAC,KAAM,KAAM,MAAOwG,IACrDwC,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAOyH,IACzCuB,EAAKE,SAASH,EAAS,WAAW/I,OAAO,SAAU,CAAC,QAAS0H,IACtDsB,ECzPT,SAAS,GAAGtG,GACV,OAAOA,EAAG,IAAoB,GAAkB,OAAuB,CAAC,6BAG1E,SAASyG,KACP,MAAO,CAAC,CACNC,IAAK,MACLC,MAAO,OACPC,MAAO,QACPC,IAAK,aACLC,KAAM,WACL,CACDJ,IAAK,MACLC,MAAO,MACPC,MAAO,QACPC,IAAK,aACLC,KAAM,WACL,CACDJ,IAAK,MACLC,MAAO,QACPC,MAAO,QACPC,IAAK,aACLC,KAAM,WAIV,SAASC,KACP,MAAO,CAAC,CACNL,IAAK,MACLC,MAAO,WACPC,MAAO,QACPC,IAAK,aACLC,KAAM,WACL,CACDJ,IAAK,MACLC,MAAO,QACPC,MAAO,QACPC,IAAK,aACLC,KAAM,YAIV,SAASE,GAAMlG,EAAImG,GACjB,OAAOnG,EAAGoG,KAAKD,GAGjB,SAASE,KACP,MAAO,CACLC,sBAAuB,IACvBC,mBAAoB,CAAC,CACnBC,WAAY,EACZC,SAAU,QACVC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,SAAyB7B,GACxC,OAAIA,EAAI8B,SAAW9B,EAAI+B,QACd,EAEA,IAGV,CACDN,WAAY,EACZC,SAAU,QACVC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,SAAyB7B,GACxC,OAAIA,EAAIgC,SAAWhC,EAAIiC,QACd,EAEA,IAGV,CACDP,SAAU,MACVC,gBAAiB,CAAC,IAAM,KACxBC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,SAAyB7B,GACxC,OAAIA,EAAIkC,OAASlC,EAAImC,MACZ,EAEA,IAGV,CACDT,SAAU,OACVC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,SAAyB7B,GACxC,OAAIA,EAAIoC,QAAUpC,EAAIqC,OACb,EAEA,MAOjB,SAASC,GAAeC,EAAmBC,EAAWpB,GACpD,OAAOmB,EAAkBC,EAAWpB,GAGtC,SAASqB,GAAGC,GACV,OAAOA,EAAclF,OAGvB,SAASmF,GAAWC,EAAeF,EAAeG,GAChD,OAAOD,EAAcF,EAAeG,GAGtC,SAAS,GAAGC,GACV,OAAOA,EAAUtF,OAGnB,SAAS,GAAIuF,EAAUD,EAAWD,EAAiBG,GACjD,OAAOD,EAASD,EAAWD,EAAiBG,GAAYxF,OAG1D,SAASyF,GAAUC,EAAuBjI,GACxC,OAAO,SAAkB6H,EAAWD,GAClC,IAAIG,EAAarJ,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,GAAmBA,UAAU,GAAK,GACjFwJ,EAAOL,EAAU7D,UAAUxD,KAAI,SAAUuE,GAE3C,OADAA,EAAuB,kBAAIkD,EAAsBlD,EAAK6C,EAAiBG,GAChEhD,KAELoD,EAAKnI,EAAGoG,KAAK8B,GAIjB,OAHAC,EAAKA,EAAGC,SAAS,CAAC,qBAAsB,CACtCC,MAAO,WAMb,SAASC,GAAuBC,EAAiBC,GAC/C,OAAO,SAAUzD,EAAK0D,GACpB,IAAIV,EAAarJ,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,GAAmBA,UAAU,GAAK,GACjF6H,EAAqBkC,EAASlC,mBAC9BmC,EAAgBH,EAAgBE,EAASnC,uBACzCqC,EAAapC,EAAmBqC,QAAO,SAAUC,EAAGC,GACtD,IAAIC,EAAiB,MAAQD,EAAGrC,SAC5BuC,EAAQjE,EAAIgE,GAEhB,IAAc,GAAVC,EACF,OAAOH,EAGT,IAAII,EAAIH,EAAoB,gBAAEE,GAC1BE,EAAIJ,EAAoB,gBAAEE,GAE1BG,EAAQpE,EAAI+D,EAAGrC,SAAW,MAAM2C,cAChCC,EAAQtE,EAAI+D,EAAGrC,SAAW,MAAM2C,cAEpC,GAAID,GAASE,GACPP,EAAGrC,YAAYsB,EAAY,CAC7B,IAAIuB,EAAMvB,EAAWe,EAAGrC,UACpB8C,EAAMD,EAAIH,IAAU,EACpBK,EAAMF,EAAID,IAAU,EACpBI,EAAQC,KAAKpG,IAAIiG,EAAKC,GAEtBC,EAAQ,IACVP,EAAIO,GAKV,OAAOZ,EAAIa,KAAKC,KAAKV,EAAIC,KACxBR,GACH,OAAOF,EAAgBG,IAI3B,SAASiB,GAAkCrB,EAAiBC,GAC1D,OAAO,SAAUzD,EAAK0D,EAAUoB,GACXzN,MAAfyN,IACFA,EAAcpB,EAASlC,mBAAmB5H,QAG5C,IAAI4H,EAAqBkC,EAASlC,mBAAmBlL,MAAM,EAAGwO,GAC1DnB,EAAgBH,EAAgBE,EAASnC,uBACzCtE,EAAI,CACN8H,kBAAmB,GACnBC,cAAe,GACfC,SAAU,GACVC,SAAU,GACVC,UAAW,GACXC,UAAW,GACXC,cAAe,GACfC,mBAAoB,GACpBC,UAAW,GACXC,kBAAmB,KACnBC,IAAK/B,EAASnC,uBAEhBC,EAAmB1H,SAAQ,SAAUiK,GACnC,IAAIrC,EAAW,MAAQqC,EAAGrC,SACtBuC,EAAQjE,EAAI0B,GACZwC,EAAIH,EAAoB,gBAAEE,GAC1BE,EAAIJ,EAAoB,gBAAEE,GAC1ByB,EAAmB3B,EAAGrC,SAASiE,QAAQ,IAAK,OAChD1I,EAAqB,kBAAE3D,KAAK2K,GAC5BhH,EAAiB,cAAE3D,KAAK,kBAAkB+B,OAAOqK,EAAkB,MACnEzI,EAAa,UAAE3D,KAAKoI,GACpBzE,EAAY,SAAE3D,KAAK4K,GACnBjH,EAAa,UAAE3D,KAAK,aAAa+B,OAAOqK,EAAkB,MAAMrK,OAAO4I,EAAO,MAC9EhH,EAAY,SAAE3D,KAAK6K,GACnBlH,EAAa,UAAE3D,KAAK,aAAa+B,OAAOqK,EAAkB,MAAMrK,OAAO4I,EAAO,MAC9EhH,EAAiB,cAAE3D,KAAK4K,EAAIC,GAC5BlH,EAAsB,mBAAE3D,KAAKqL,KAAKC,KAAKV,EAAIC,OAE7C,IAAIP,EAAa3G,EAAsB,mBAAE4G,QAAO,SAAUC,EAAG8B,GAC3D,OAAO9B,EAAI8B,IACVjC,GACH1G,EAAqB,kBAAIwG,EAAgBG,GACzC,IAAI6B,EAAM/B,EAASnC,sBAOnB,OANAtE,EAAyB,sBAAIwI,EAAMxI,EAAY,SAAE4G,QAAO,SAAUC,EAAG+B,GACnE,OAAO/B,EAAI+B,IACV,GACH5I,EAA6B,2BAAK,EAAIwI,GAAOxI,EAAY,SAAE4G,QAAO,SAAUC,EAAG+B,GAC7E,OAAO/B,EAAI+B,IACV,GACI5I,GAIX,SAAS6I,GAAyBC,GAChC,OAAO,SAAU/F,EAAK0D,EAAUoB,GAC9B,IAAI7H,EAAI8I,EAAiC/F,EAAK0D,EAAUoB,GACpDZ,EAAIjH,EAAY,SAAExB,KAAI,SAAUwB,GAClC,OAAOA,EAAE+I,YAAY,MAEnB7B,EAAIlH,EAAY,SAAExB,KAAI,SAAUwB,GAClC,OAAOA,EAAE+I,YAAY,MAEnBP,EAAMxI,EAAO,IAAE+I,YAAY,GAC3BC,EAAQ,CAACR,GAAKpK,OAAO6I,GACrBgC,EAAQ,CAAC,QAAQ7K,OAAOoK,EAAK,MAAMpK,OAAO8I,GAC1CgC,EAAQF,EAAMG,KAAK,aACnBC,EAAQH,EAAME,KAAK,aACnBE,EAAIrJ,EAAqB,kBAAE+I,YAAY,GACvCO,EAAStJ,EAAyB,sBAAE+I,YAAY,GAChDQ,EAASvJ,EAA6B,0BAAE+I,YAAY,GACxD,MAAO,UAAU3K,OAAO8K,EAAO,OAAO9K,OAAO8K,EAAO,SAAS9K,OAAOgL,EAAO,iCAAiChL,OAAOkL,EAAQ,MAAMlL,OAAOkL,EAAQ,OAAOlL,OAAOmL,EAAQ,yBAAyBnL,OAAOiL,IAI1M,SAASG,GAAyBV,GAChC,OAAO,SAAU/F,EAAK0D,GACpB,IAAIzG,EAAI8I,EAAiC/F,EAAK0D,GAC1CQ,EAAIjH,EAAa,UACjBkH,EAAIlH,EAAa,UAEjBgJ,GADMhJ,EAAO,IACL,CAAC,YAAY5B,OAAO6I,IAC5BgC,EAAQ,CAAC,kBAAkB7K,OAAO8I,GAClCgC,EAAQF,EAAMG,KAAK,KACnBC,EAAQH,EAAME,KAAK,KACvB,MAAO,UAAU/K,OAAO8K,EAAO,MAAM9K,OAAO8K,EAAO,QAAQ9K,OAAOgL,EAAO,MAI7E,SAAS,GAAIK,EAAKC,EAAyB7D,EAAWD,GACpD,OAAO6D,EAAI,IAAqB,GAAmB,OAAuB,CAAC,GAAI,QAASC,EAAwB7D,EAAU7D,UAAU,GAAI4D,IAG1I,SAAS+D,GAA2Cb,GAClD,OAAO,SAAU/F,EAAK0D,EAAUoB,GAC9B,IAAI7H,EAAI8I,EAAiC/F,EAAK0D,EAAUoB,GACpD+B,EAAS5J,EAAiB,cAAEmJ,KAAK,MACjCU,EAAU7J,EAAqB,kBAAEmJ,KAAK,MAC1C,MAAO,oBAAoB/K,OAAOwL,EAAQ,QAAQxL,OAAOyL,EAAS,MAItE,SAAS,GAAIJ,EAAKK,EAA2CjE,EAAWD,GACtE,OAAO6D,EAAI,IAAqB,GAAmB,OAAuB,CAAC,GAAI,QAASK,EAA0CjE,EAAU7D,UAAU,GAAI4D,IAG5J,SAAS,GAAI6D,GACX,OAAOA,EAAI,IAAqB,GAAmB,OAAuB,CAAC,yDAA0D,CAAC,qEAGxI,SAAS,GAAIA,EAAKM,EAAyBlE,EAAWD,GACpD,OAAO6D,EAAI,IAAqB,GAAmB,OAAuB,CAAC,GAAI,MAAOM,EAAwBlE,EAAU7D,UAAU,GAAI4D,IAGxI,SAASoE,GAAIlB,EAAkCjD,EAAWD,GACxD,OAAOkD,EAAiCjD,EAAU7D,UAAU,GAAI4D,GAGlE,SAASqE,GAAmBjM,GAC1B,OAAO,SAAUkM,EAAmBC,GAClC,IAAIC,EAAOpM,EAAGoG,KAAK8F,GACfG,EAAOrM,EAAGoG,KAAK+F,GACf1E,EAAgB2E,EAAKjB,KAAKkB,GAAM,SAAUxD,EAAG+B,GAC/C,OAAO,IACN,KAAM,CACP0B,OAAQ,CAAC,KAAM,QAGbC,EAAoBH,EAAK1H,cACzB8H,EAAe,GAMnB,OALAD,EAAkB1N,SAAQ,SAAUmD,GAClCwK,EAAanO,KAAK2D,EAAI,MACtBwK,EAAanO,KAAK2D,EAAI,SAExByF,EAAgBA,EAAcpF,OAAOmK,IAKzC,SAASC,GAAezM,GACtB,OAAO,SAAuByH,EAAeG,GAC3C,IAAIrB,EAAqBqB,EAAoC,mBASzDC,EAAYJ,EAAczD,UAC9BuC,EAAmB1H,SAAQ,SAAUiK,GACnCjB,EAAUhJ,SAAQ,SAAUkG,GAC1BA,EAAI,MAAQ+D,EAAGrC,UAAYqC,EAAGlC,gBAAgB7B,SAGlD8C,EAAY7H,EAAGoG,KAAKyB,GAEpB,IAAI6E,EAAY,CAAC,QAAS,SAO1B,OANAnG,EAAmB1H,SAAQ,SAAUiK,GACnC4D,EAAUrO,KAAKyK,EAAGrC,SAAW,MAC7BiG,EAAUrO,KAAKyK,EAAGrC,SAAW,MAC7BiG,EAAUrO,KAAK,MAAQyK,EAAGrC,aAE5BoB,EAAYA,EAAUxF,OAAOqK,IAKjC,SAASC,KACP,OAAO,SAA8B/B,GACnC,OAAOA,GAAKA,EAAI,IAIpB,SAASgC,GAAiBC,GACxB,OAAO,SAAyBjC,GAC9B,OAAOiC,EAAqBnD,KAAKoD,IAAI,EAAGlC,KAI5C,SAASmC,KACP,OAAO,SAA8B1B,GACnC,OAAOA,GAAK,EAAIA,IAIpB,SAAS2B,GAAiBC,GACxB,OAAO,SAAyB5B,GAC9B,OAAO3B,KAAKC,KAAKsD,EAAqB5B,KAI1C,SAAS6B,GAAmBC,GAC1B,OAAOA,EAAGC,IAAI,gJAAiJD,EAAGE,UAAUC,MAAK,SAAUC,GACzL,IAAIC,EAAS,GAIb,OAHAD,EAAS1O,SAAQ,SAAUkG,GACzByI,EAAOzI,EAAI0I,WAAa1I,EAAI2I,QAEvBF,KAIX,SAASG,GAAgBR,GACvB,OAAOA,EAAGC,IAAI,wIAAyID,EAAGE,UAAUC,MAAK,SAAUC,GACjL,IAAIC,EAAS,GAIb,OAHAD,EAAS1O,SAAQ,SAAUkG,GACzByI,EAAOzI,EAAI6I,SAAW7I,EAAI2I,QAErBF,KAIX,SAASK,GAAYC,EAAmBC,GACtC,MAAO,CACLlI,MAAOiI,EACPhI,MAAOiI,GAIX,SAASC,GAAIjG,GACX,OAAOA,EAAWlC,MAAc,OAGlC,SAASoI,GAAIlG,GACX,OAAOA,EAAWjC,MAAe,QAGpB,SAAS,GAAOR,EAASC,GACtC,IAAIC,EAAOF,EAAQG,SACnBD,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO,IACzCgJ,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAamJ,IACzDH,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAayJ,IACzDT,EAAKE,SAASH,EAAS,SAAS/I,OAAO,OAAQ,CAAC,KAAM,aAAc0J,IACpEV,EAAKE,SAASH,EAAS,oBAAoB/I,OAAO,kBAAmB6J,IACrEb,EAAKE,SAASH,EAAS,kBAAkB/I,OAAO,gBAAiB,CAAC,oBAAqB,YAAa,aAAc6K,IAClH7B,EAAKE,SAASH,KAAY/I,OAAO,CAAC,iBAAkBgL,IACpDhC,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAa,CAAC,gBAAiB,gBAAiB,mBAAoBkL,IAChHlC,EAAKE,SAASH,KAAY/I,OAAO,CAAC,aAAc,IAChDgJ,EAAKE,SAASH,KAAY/I,OAAO,CAAC,WAAY,YAAa,kBAAmB,cAAe,IAC7FgJ,EAAKE,SAASH,EAAS,aAAa/I,OAAO,WAAY,CAAC,wBAAyB,MAAOwL,IACxFxC,EAAKE,SAASH,EAAS,0BAA0B/I,OAAO,wBAAyB,CAAC,kBAAmB,mBAAoB8L,IACzH9C,EAAKE,SAASH,EAAS,qCAAqC/I,OAAO,mCAAoC,CAAC,kBAAmB,mBAAoBoN,IAC/IpE,EAAKE,SAASH,EAAS,4BAA4B/I,OAAO,0BAA2B,CAAC,oCAAqCqO,IAC3HrF,EAAKE,SAASH,EAAS,4BAA4B/I,OAAO,0BAA2B,CAAC,oCAAqCgP,IAC3HhG,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO,0BAA2B,YAAa,mBAAoB,IACrGgJ,EAAKE,SAASH,EAAS,8CAA8C/I,OAAO,4CAA6C,CAAC,oCAAqCmP,IAC/JnG,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO,4CAA6C,YAAa,mBAAoB,IACvHgJ,EAAKE,SAASH,KAAY/I,OAAO,CAAC,OAAQ,IAC1CgJ,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO,0BAA2B,YAAa,mBAAoB,IACrGgJ,EAAKE,SAASH,KAAY/I,OAAO,CAAC,mCAAoC,YAAa,mBAAoBwP,IACvGxG,EAAKE,SAASH,EAAS,sBAAsB/I,OAAO,oBAAqB,CAAC,MAAOyP,IACjFzG,EAAKE,SAASH,EAAS,kBAAkB/I,OAAO,gBAAiB,CAAC,MAAOiQ,IACzEjH,EAAKE,SAASH,EAAS,yBAAyB/I,OAAO,uBAAwBmQ,IAC/EnH,EAAKE,SAASH,EAAS,oBAAoB/I,OAAO,kBAAmB,CAAC,wBAAyBoQ,IAC/FpH,EAAKE,SAASH,EAAS,yBAAyB/I,OAAO,uBAAwBuQ,IAC/EvH,EAAKE,SAASH,EAAS,oBAAoB/I,OAAO,kBAAmB,CAAC,wBAAyBwQ,IAC/F,IAAIkB,EAAS5I,EAAQG,OAAO,IAQ5B,OAPAD,EAAK2I,OAAO,KAAMD,GAClB1I,EAAK2I,OAAO,KAAMD,GAClB1I,EAAKE,SAASH,EAAS,sBAAsB/I,OAAO,oBAAqB,CAAC,MAAO0Q,IACjF1H,EAAKE,SAASH,EAAS,mBAAmB/I,OAAO,iBAAkB,CAAC,MAAOmR,IAC3EnI,EAAKE,SAASH,EAAS,eAAe/I,OAAO,aAAc,CAAC,oBAAqB,kBAAmBqR,IACpGrI,EAAKE,SAASH,KAAY/I,OAAO,CAAC,cAAewR,IACjDxI,EAAKE,SAASH,KAAY/I,OAAO,CAAC,cAAeyR,IAC1CzI,ECpbT,SAAS,GAAQ5H,EAAQC,GAAkB,IAAIC,EAAOxC,OAAOwC,KAAKF,GAAS,GAAItC,OAAOyC,sBAAuB,CAAE,IAAIC,EAAU1C,OAAOyC,sBAAsBH,GAAaC,IAAkBG,EAAUA,EAAQC,QAAO,SAAUC,GAAO,OAAO5C,OAAO6C,yBAAyBP,EAAQM,GAAKE,eAAkBN,EAAKO,KAAKC,MAAMR,EAAME,GAAY,OAAOF,EAElV,SAAS,GAAcU,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAAyB,MAAhBF,UAAUD,GAAaC,UAAUD,GAAK,GAAQA,EAAI,EAAK,GAAQnD,OAAOsD,IAAS,GAAMC,SAAQ,SAAUC,IAAO,OAAgBN,EAAQM,EAAKF,EAAOE,OAAsBxD,OAAOyD,0BAA6BzD,OAAOE,iBAAiBgD,EAAQlD,OAAOyD,0BAA0BH,IAAmB,GAAQtD,OAAOsD,IAASC,SAAQ,SAAUC,GAAOxD,OAAO0D,eAAeR,EAAQM,EAAKxD,OAAO6C,yBAAyBS,EAAQE,OAAe,OAAON,EAE7gB,SAAS,GAAGU,GACV,OAAOA,EAAG,IAAoB,GAAkB,OAAuB,CAAC,wBAG1E,SAAS,GAAGA,GACV,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,mJAAoJ,CAAC,0JAGjO,SAASkP,GAAGlP,GACV,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,iBAG5E,SAAS,KACP,MAAO,CACLoH,sBAAuB,IACvBC,mBAAoB,CAAC,CACnBC,WAAY,EACZC,SAAU,aACVC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,CAAC,GAAK,KACtB,CACDH,WAAY,EACZC,SAAU,UACVC,gBAAiB,CAAC,GAAK,IACvBC,gBAAiB,CAAC,GAAK,KACtB,CACDF,SAAU,gBACVC,gBAAiB,CAAC,IAAM,KACxBC,gBAAiB,CAAC,GAAK,OAK7B,SAAS0H,KACP,IAAIzK,EAEJ,OAAOA,EAAO,CACZ0K,aAAc,OACdC,aAAc,OACd,gBAA2B,EAC3BC,UAAW,QACXC,UAAW,QACX,aAAwB,EACxBC,gBAAiB,eAChB,OAAgB9K,EAAM,kBAAmB,eAAe,OAAgBA,EAAM,mBAA8B,IAAI,OAAgBA,EAAM,QAAS,MAAOA,EAG3J,SAAS+K,KACP,MAAO,CACLnM,OAAQ,KAIZ,SAAS,GAAGoM,EAAqB7J,EAAK6C,EAAiBiH,GACrD,OAAOD,EAAoB7J,EAAK6C,EAAiBiH,GAAW,GAG9D,SAAS,GAAGD,EAAqB7J,EAAK6C,EAAiBiH,GACrD,OAAOD,EAAoB7J,EAAK6C,EAAiBiH,GAAW,GAG9D,SAAS,GAAG3P,GACV,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,cAG5E,SAAS4P,GAAqBC,EAA0BC,EAAOC,GAC7D,OAAO,SAAUlK,EAAK6C,EAAiBsH,EAAiBC,GACtD,IAAIpH,EAAarJ,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,GAAmBA,UAAU,GAAK,GACjF0Q,EAAOL,EAAyBhK,EAAK6C,EAAiBG,GAC1D,OAAOiH,EAAMC,EAAeG,EAAMF,EAAiBC,KAIvD,SAASE,KACP,OAAO,SAAsCzH,GAC3C,IAAI4F,EAAS,GAKb,OAJA5F,EAAgBrB,mBAAmB1H,SAAQ,SAAUmD,GACnD,IAAIyE,EAAWzE,EAAY,SAC3BwL,EAAO/G,GAAYzE,KAEdwL,GAIX,SAAS8B,GAA0BC,EAA+BC,EAA+BC,GAC/F,OAAO,SAAkC1K,EAAK6C,GAC5C,IAAIG,EAAarJ,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,GAAmBA,UAAU,GAAK,GACjFgR,EAAaH,EAA8B3H,GAC3C+H,EAA4BH,EAA8BzK,EAAK6C,EAAiBG,GAChF6H,EAAoB,CAACF,GAAYtP,OAAOuP,GACxCE,EAAYJ,EAA6B7H,GACzCkI,EAA+BF,EAAkBhH,QAAO,SAAUC,EAAG+B,GACvE,OAAO/B,EAAI+B,EAAqB,oBAC/B,GAGH,OAFAiF,EAAwB,aAAInG,KAAKoD,IAAI,EAAGgD,GACxCD,EAA6B,kBAAIC,EAC1BF,EAAkBxP,OAAO,CAACyP,KAIrC,SAASE,GAAyBC,EAA8BrG,GAC9D,OAAO,SAAiCsG,EAAWlL,EAAK6C,EAAiBG,GACvE,IAOImI,EAAeC,EAPfrR,EAAMmR,EACNG,EAAcrL,EAAIjG,GAClB2H,EAAW3H,EAAI4L,QAAQ,MAAO,IAE9B2F,EADYL,EAA6BpI,GACrBnB,GACpB6J,EAAUvL,EAAI0B,EAAW,MACzB8J,EAAUxL,EAAI0B,EAAW,OAGT,GAAhB2J,GACFF,EAAgB,GAChBC,EAAgB,KAEhBD,EAAgBG,EAAyB,gBAAED,GAC3CD,EAAgBE,EAAyB,gBAAED,GAEvCE,GAAWC,GACT9J,KAAYsB,IAEdmI,EADUnI,EAAWtB,GACD6J,IAAYJ,IAKtC,IAAIM,EAAeL,EAAgBD,EACnC,MAAO,CACLM,aAAcA,EACdC,YAAahK,EACbiK,kBAAmB,MAAQjK,EAC3BkK,YAAaP,EACbQ,WAAY,SAAWR,EACvBS,kBAAmBlH,EAAK6G,GACxBL,cAAeA,EACf3J,WAAY,KACZ0J,cAAeA,EACfI,QAASA,EACTC,QAASA,IAKf,SAASO,GAA+B7D,EAAsB8D,GAC5D,OAAO,SAAUnJ,GAcf,MAbU,CACR4I,aAAcvD,EAAqBrF,EAAgBtB,uBACnDmK,YAAa,QACbC,kBAAmB,GACnBC,YAAa,GACbC,WAAY,KACZC,kBAAmBE,EAA0BnJ,EAAgBtB,uBAC7D6J,cAAe,KACf3J,WAAY,KACZ0J,cAAe,KACfI,QAAS,GACTC,QAAS,KAMf,SAASS,GAA+BC,GACtC,OAAO,SAAUlM,EAAK6C,EAAiBG,GACrC,IAAIjK,EAAOxC,OAAOwC,KAAKiH,GAIvB,OAHAjH,EAAOA,EAAKG,QAAO,SAAUa,GAC3B,OAAOA,EAAIoS,SAAS,WAEV1Q,KAAI,SAAUyP,GACxB,OAAOgB,EAAwBhB,EAAWlL,EAAK6C,EAAiBG,OAKtE,SAASoJ,KACP,OAAO,SAAUvJ,GAcf,MAbU,CACR4I,aAAc,KACdC,YAAa,cACbC,kBAAmB,GACnBC,YAAa,GACbC,WAAY,KACZC,kBAAmB,KACnBV,cAAe,KACf3J,WAAY,KACZ0J,cAAe,KACfI,QAAS,GACTC,QAAS,KAMf,SAASa,GAAgBC,GACvB,OAAO,SAAUjC,EAAMP,GACrB,IAAIM,EAAazQ,UAAUC,OAAS,QAAsBvC,IAAjBsC,UAAU,IAAmBA,UAAU,GAC5E4S,EAAcC,KAAKC,MAAMD,KAAKE,UAAUJ,IAE5CC,EAAYlC,KAAKsC,OAAStC,EAE1B,IAAIuC,EAAO,GAAc,GAAc,GAAIL,GAAczC,GAEzD,GAAIM,EAAY,CAEdwC,EAAY,MAAE,GAAa,SAAK,EAAQ,MAAI,EAG5CA,EAAY,MAAE,GAAU,MAAE,GAAa,SAAQ,KAAI,CACjDC,KAAM,UACNC,MAAO,iBAETF,EAAY,MAAE,GAAU,MAAE,GAAa,SAAW,QAAI,CACpDG,UAAW,CACTrW,MAAO,EACPsW,KAAM,uEAIV,IAAIC,EAAO,kDACXL,EAAY,MAAE,GAAU,MAAE,GAAa,SAAK,EAAQ,KAAa,UAAIK,EACrEL,EAAY,MAAE,GAAU,MAAE,GAAa,SAAK,EAAQ,KAAS,MAAI,cAEjEA,EAAY,MAAE,GAAU,MAAE,GAAa,SAAW,QAAI,CAAC,CACrDC,KAAM,eACNC,MAAO,OACPI,OAAQ,MACRtV,MAAO,iCAIX,OAAOgV,GAIX,SAASO,KACP,MAAO,CACLC,OAAQ,CACN5P,KAAM,CACJ6P,iBAAkB,IAClBC,gBAAiB,MAGrB1V,MAAO,CACL2V,KAAM,+BACNC,SAAU,mEAEZC,UAAW,CAAC,CACVvU,OAAQ,gCACP,CACDwU,OAAQ,CAAC,CACPtR,GAAI,MACJ0Q,MAAO,oBACP3O,GAAI,OACH,CACD/B,GAAI,OACJ0Q,MAAO,cACP3O,GAAI,SAENwP,MAAO,CAAC,KAAM,IACb,CACDC,UAAW,wFACXzP,GAAI,OACH,CACDyP,UAAW,uDACXzP,GAAI,QACH,CACDyP,UAAW,wHACXzP,GAAI,gBACH,CACDyP,UAAW,0DACXzP,GAAI,aACH,CACDyP,UAAW,0DACXzP,GAAI,gBACH,CACDyP,UAAW,kEACXzP,GAAI,WACH,CACDyP,UAAW,kEACXzP,GAAI,cACH,CACDyP,UAAW,uCACXzP,GAAI,UACH,CACDyP,UAAW,qEACXzP,GAAI,0BACH,CACDyP,UAAW,0CACXzP,GAAI,MACH,CACDyP,UAAW,oDACXzP,GAAI,YACH,CACDyP,UAAW,mCACXzP,GAAI,QACH,CACDyP,UAAW,cACXzP,GAAI,QACH,CACDyP,UAAW,6CACXzP,GAAI,kBAEN0P,MAAO,CAAC,CACNA,MAAO,CAAC,CACNC,KAAM,OACNC,SAAU,CACRC,EAAG,CACDlB,MAAO,OACPD,KAAM,gBAERxM,KAAM,CACJ3J,MAAO,IAETgJ,MAAO,CACLhJ,MAAO,WAGV,CACDoX,KAAM,CACJjB,KAAM,MACNoB,MAAO,IAETF,SAAU,CACRrO,MAAO,CACLqN,UAAW,CACTrW,MAAO,MACPsW,KAAM,iCAERtW,MAAO,SAETwX,QAAS,CACPnB,UAAW,CACTrW,MAAO,EACPsW,KAAM,sEAERtW,MAAO,IAETyX,QAAS,CAAC,CACRtB,KAAM,UACNC,MAAO,cACPlV,MAAO,qBACN,CACDiV,KAAM,UACNC,MAAO,UACPlV,MAAO,aACN,CACDiV,KAAM,UACNC,MAAO,UACPlV,MAAO,aACN,CACDiV,KAAM,UACNC,MAAO,cACPlV,MAAO,eACN,CACDiV,KAAM,eACNC,MAAO,eACPI,OAAQ,MACRtV,MAAO,gBACN,CACDiV,KAAM,eACNC,MAAO,oBACPI,OAAQ,MACRtV,MAAO,sBACN,CACDiV,KAAM,eACNC,MAAO,OACPI,OAAQ,MACRtV,MAAO,iCAETwW,EAAG,CACDvB,KAAM,UACNwB,KAAM,CACJC,UAAW,4EACXC,WAAY,SACZC,aAAc,GACd5W,MAAO,SACP6W,MAAM,EACNC,SAAU,UAEZ5B,MAAO,cACP6B,KAAM,MAERX,EAAG,CACDnB,KAAM,eACNwB,KAAM,CACJI,MAAM,EACNG,OAAQ,OACRhX,MAAO,sBAETkV,MAAO,gBAET+B,GAAI,CACF/B,MAAO,SAGV,CACDgB,KAAM,CACJjB,KAAM,OACNiC,WAAY,QAEdf,SAAU,CACRrO,MAAO,CACLhJ,MAAO,SAET6W,KAAM,CACJR,UAAW,CACTF,KAAM,UACNC,MAAO,oBACPI,OAAQ,MACRF,KAAM,oCAERtW,MAAO,IAET0X,EAAG,CACDvB,KAAM,UACNwB,KAAM,CACJU,WAAY,EACZnX,MAAO,UAETkV,MAAO,cACP6B,KAAM,MAERX,EAAG,CACDnB,KAAM,eACNwB,KAAM,CACJO,OAAQ,QAEV9B,MAAO,YAGV,CACDgB,KAAM,CACJjB,KAAM,OACNmC,SAAU,SACVC,IAAK,EACLH,WAAY,QAEdf,SAAU,CACRrO,MAAO,CACLhJ,MAAO,SAET6W,KAAM,CACJR,UAAW,CACTF,KAAM,UACNC,MAAO,YACPE,KAAM,oCAERtW,MAAO,IAET0X,EAAG,CACDvB,KAAM,UACNwB,KAAM,CACJU,WAAY,EACZnX,MAAO,UAETkV,MAAO,cACP6B,KAAM,MAERX,EAAG,CACDnB,KAAM,eACNC,MAAO,aAGV,CACDgB,KAAM,CACJjB,KAAM,OACNmC,SAAU,MACVC,GAAI,EACJH,WAAY,QAEdf,SAAU,CACRrO,MAAO,CACLhJ,MAAO,SAET6W,KAAM,CACJR,UAAW,CACTF,KAAM,UACNC,MAAO,eACPE,KAAM,oCAERtW,MAAO,IAET0X,EAAG,CACDvB,KAAM,UACNwB,KAAM,CACJU,WAAY,EACZnX,MAAO,UAETkV,MAAO,cACP6B,KAAM,MAERX,EAAG,CACDnB,KAAM,eACNC,MAAO,kBAIZ,CACDgB,KAAM,CACJjB,KAAM,OACNnN,MAAO,QACPwP,YAAa,EACbC,SAAU,GACVC,SAAU,IAEZrB,SAAU,CACRK,EAAG,CACDvB,KAAM,UACNwB,KAAM,CACJU,WAAY,EACZnX,MAAO,UAETkV,MAAO,cACP6B,KAAM,MAERU,GAAI,CACFvC,MAAO,QAETkB,EAAG,CACDnB,KAAM,eACNwB,KAAM,CACJC,UAAW,kDACXM,OAAQ,QACRhX,MAAO,eAETkV,MAAO,MACPwC,MAAO,CACLC,MAAM,OAKd9R,OAAQ,IACR+R,QAAS,CACPnB,KAAM,CACJL,EAAG,gBAGPC,MAAO,CACLwB,KAAM,IAERC,QAAS,sDACTrF,KAAM,CACJsC,OAAQ,OAKd,SAASgD,GAAO9U,GACd,OAAOA,EAAQ,gBAGjB,SAAS,KACP,OAAO,SAA8BgL,GACnC,OAAOA,GAAKA,EAAI,IAIpB,SAAS+J,KACP,OAAOjL,KAAKC,KAGd,SAAS,KACP,OAAO,SAA8B0B,GACnC,OAAOA,GAAK,EAAIA,IAIpB,SAASuJ,GAA2BjL,EAAMsD,GACxC,OAAO,SAAmC5B,GACxC,OAAO1B,EAAKsD,EAAqB5B,KAIrC,SAASwJ,GAA2BhI,GAClC,OAAO,SAAmCiI,GACxC,OAAOjI,EAAqBnD,KAAKoD,IAAI,EAAGgI,KAI5C,SAAS,GAAmB3H,GAC1B,OAAOA,EAAGC,IAAI,gJAAiJD,EAAGE,UAAUC,MAAK,SAAUC,GACzL,IAAIC,EAAS,GAIb,OAHAD,EAAS1O,SAAQ,SAAUkG,GACzByI,EAAOzI,EAAI0I,WAAa1I,EAAI2I,QAEvBF,KAIX,SAAS,GAAYM,GACnB,MAAO,CACLiH,WAAYjH,GAID,SAAS,GAAOxI,EAASC,GACtC,IAAIC,EAAOF,EAAQG,SA2BnB,OA1BAD,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO,IACzCgJ,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO,IACzCgJ,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO4R,IACzC5I,EAAKE,SAASH,EAAS,oBAAoB/I,OAAO,kBAAmB,IACrEgJ,EAAKE,SAASH,EAAS,QAAQ/I,OAAO,MAAO6R,IAC7C7I,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAamS,IACzDnJ,EAAKE,SAASH,KAAY/I,OAAO,CAAC,sBAAuB,MAAO,kBAAmB,aAAc,IACjGgJ,EAAKE,SAASH,KAAY/I,OAAO,CAAC,sBAAuB,MAAO,kBAAmB,aAAc,IACjGgJ,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO,IACzCgJ,EAAKE,SAASH,EAAS,wBAAwB/I,OAAO,sBAAuB,CAAC,2BAA4B,QAAS,kBAAmBsS,IACtItJ,EAAKE,SAASH,EAAS,iCAAiC/I,OAAO,+BAAgC6S,IAC/F7J,EAAKE,SAASH,EAAS,6BAA6B/I,OAAO,2BAA4B,CAAC,gCAAiC,gCAAiC,gCAAiC8S,IAC3L9J,EAAKE,SAASH,EAAS,4BAA4B/I,OAAO,0BAA2B,CAAC,+BAAgC,QAASuT,IAC/HvK,EAAKE,SAASH,EAAS,kCAAkC/I,OAAO,gCAAiC,CAAC,uBAAwB,6BAA8BsU,IACxJtL,EAAKE,SAASH,EAAS,kCAAkC/I,OAAO,gCAAiC,CAAC,2BAA4BwU,IAC9HxL,EAAKE,SAASH,EAAS,iCAAiC/I,OAAO,+BAAgC2U,IAC/F3L,EAAKE,SAASH,EAAS,mBAAmB/I,OAAO,iBAAkB,CAAC,aAAc4U,IAClF5L,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAa0V,IACzD1M,EAAKE,SAASH,EAAS,UAAU/I,OAAO,QAAS,CAAC,WAAYkY,IAC9DlP,EAAKE,SAASH,EAAS,yBAAyB/I,OAAO,uBAAwB,IAC/EgJ,EAAKE,SAASH,EAAS,SAAS/I,OAAO,OAAQmY,IAC/CnP,EAAKE,SAASH,EAAS,yBAAyB/I,OAAO,uBAAwB,IAC/EgJ,EAAKE,SAASH,EAAS,8BAA8B/I,OAAO,4BAA6B,CAAC,OAAQ,wBAAyBoY,IAC3HpP,EAAKE,SAASH,EAAS,8BAA8B/I,OAAO,4BAA6B,CAAC,wBAAyBqY,IACnHrP,EAAKE,SAASH,EAAS,sBAAsB/I,OAAO,oBAAqB,CAAC,MAAO,IACjFgJ,EAAKE,SAASH,EAAS,eAAe/I,OAAO,aAAc,CAAC,qBAAsB,IAC3EgJ,ECrnBT,SAASwP,GAA2BC,EAAGC,GAAkB,IAAIC,EAAuB,oBAAXC,QAA0BH,EAAEG,OAAOC,WAAaJ,EAAE,cAAe,IAAKE,EAAI,CAAE,GAAIG,MAAMC,QAAQN,KAAOE,EAE9K,SAAqCF,EAAGO,GAAU,IAAKP,EAAG,OAAQ,GAAiB,iBAANA,EAAgB,OAAOQ,GAAkBR,EAAGO,GAAS,IAAIE,EAAIpa,OAAOqa,UAAUC,SAASC,KAAKZ,GAAG5Z,MAAM,GAAI,GAAc,WAANqa,GAAkBT,EAAEa,cAAaJ,EAAIT,EAAEa,YAAYnR,MAAM,GAAU,QAAN+Q,GAAqB,QAANA,EAAa,OAAOJ,MAAMlP,KAAK6O,GAAI,GAAU,cAANS,GAAqB,2CAA2C3D,KAAK2D,GAAI,OAAOD,GAAkBR,EAAGO,GAFnOO,CAA4Bd,KAAOC,GAAkBD,GAAyB,iBAAbA,EAAEtW,OAAqB,CAAMwW,IAAIF,EAAIE,GAAI,IAAI1W,EAAI,EAAOuX,EAAI,aAAiB,MAAO,CAAEnS,EAAGmS,EAAGN,EAAG,WAAe,OAAIjX,GAAKwW,EAAEtW,OAAe,CAAEsX,MAAM,GAAe,CAAEA,MAAM,EAAOxa,MAAOwZ,EAAExW,OAAWyX,EAAG,SAAWC,GAAM,MAAMA,GAAOC,EAAGJ,GAAO,MAAM,IAAIK,UAAU,yIAA4I,IAA6CC,EAAzCC,GAAmB,EAAMC,GAAS,EAAY,MAAO,CAAE3S,EAAG,WAAesR,EAAKA,EAAGU,KAAKZ,IAAOS,EAAG,WAAe,IAAIlB,EAAOW,EAAGhV,OAAsC,OAA9BoW,EAAmB/B,EAAKyB,KAAazB,GAAS0B,EAAG,SAAWO,GAAOD,GAAS,EAAMF,EAAMG,GAAQL,EAAG,WAAe,IAAWG,GAAiC,MAAbpB,EAAGuB,QAAgBvB,EAAGuB,SAAY,QAAU,GAAIF,EAAQ,MAAMF,KAIz9B,SAASb,GAAkBkB,EAAKC,IAAkB,MAAPA,GAAeA,EAAMD,EAAIhY,UAAQiY,EAAMD,EAAIhY,QAAQ,IAAK,IAAIF,EAAI,EAAGoY,EAAO,IAAIvB,MAAMsB,GAAMnY,EAAImY,EAAKnY,IAAOoY,EAAKpY,GAAKkY,EAAIlY,GAAM,OAAOoY,EAKhL,SAASC,GAAO5X,GACd,OAAOA,EAAG,IAAoB,GAAkB,OAAuB,CAAC,oEAG1E,SAAS,GAAGA,GACV,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,wIAG5E,SAAS6X,GAAQ7X,GACf,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,maAG5E,SAAS8X,GAAQ9X,GACf,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,umBAG5E,SAAS+X,GAAQ/X,GACf,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,oRAG5E,SAASgY,GAAQhY,GACf,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,0VAG5E,SAASiY,GAAQjY,GACf,OAAOA,EAAG,IAAqB,GAAmB,OAAuB,CAAC,2IAG5E,SAASkY,GAAOjT,GACd,OAAOA,EAAK,IAAqB,GAAmB,OAAuB,CAAC,4YAG9E,SAASkT,GAAuBlT,EAAMmT,GACpC,OAAOnT,EAAK,IAAqB,GAAmB,OAAuB,CAAC,0HAA+H,YAAamT,GAG1N,SAASC,GAAQrY,GACf,OAAOA,EAAG,IAAsB,GAAoB,OAAuB,CAAC,uVAG9E,SAASsY,GAAcC,GACrB,OAAOA,EAAOC,OAAO,CACnBC,MAAO,oCAIX,SAASC,GAAiBhJ,EAAqB/G,EAAWD,EAAiBiH,EAAWgJ,EAAc9P,GAClG,OAAO6G,EAAoB/G,EAAU7D,UAAU,GAAI4D,EAAiBiH,GAAYgJ,EAAc9P,GAGhG,SAAS+P,GAAQ5Y,GACf,OAAOA,EAAG,IAAsB,GAAoB,OAAuB,CAAC,ilBAG9E,SAAS6Y,GAAW7Y,GAClB,OAAOA,EAAG,IAAsB,GAAoB,OAAuB,CAAC,6CAG9E,SAAS8Y,GAAQ9Y,GACf,OAAOA,EAAG,IAAsB,GAAoB,OAAuB,CAAC,8qBAG9E,SAAS+Y,GAAYhQ,EAAuBJ,EAAWD,EAAiBG,GAEtE,OAAe,IADJE,EAAsBJ,EAAU7D,UAAU,GAAI4D,EAAiBG,IACtDgD,YAAY,GAGlC,SAASmN,GAAWC,EAAYC,EAAgB1W,GAC9C,OAAOyW,EAAWE,SAAQ,SAAUC,GAClC,IAAIC,EAAW,SAAkBC,GAC/B,OAAOF,EAAOF,EAAe1W,KAK/B,OAFAA,EAAM+W,iBAAiB,QAASF,GAAU,GAC1CD,EAAOF,EAAe1W,IACf,WACL,OAAO+Q,OAAOiG,oBAAoB,QAASH,OAKjD,SAASI,KACP,OAAO,SAAwBjX,GAC7B,IAAI0N,EAAO,GA2CX,OA1CA1N,EAAMkX,iBAAiB,MAAM/Z,SAAQ,SAAUkG,EAAKtG,GAClD,IAIIoa,EAHAC,EAAW,GAEXC,EAAY/D,GAHJjQ,EAAIiU,OAMhB,IACE,IAAKD,EAAUlV,MAAOgV,EAAQE,EAAUrD,KAAKO,MAAO,CAClD,IACIxa,EADOod,EAAMpd,MACAwd,UAIJ,KAFbxd,GADAA,EAAQA,EAAMyd,QACA9P,iBAGZ3N,EAAQ,MAGVqd,EAASza,KAAK5C,IAEhB,MAAO6a,GACPyC,EAAU7C,EAAEI,GACZ,QACAyC,EAAU3C,IAGZhH,EAAK/Q,KAAKya,MAEQ1J,EAAKxG,QAAO,SAAUuQ,EAAapU,EAAKtG,GAC1D,GAAS,GAALA,EACF0a,EAAYC,WAAarU,MACpB,CACL,IAAIsU,EAAY,GAChBA,EAAe,IAAI5a,EACnB0a,EAAYC,WAAWva,SAAQ,SAAUC,EAAKL,GAC5C4a,EAAUva,GAAOiG,EAAItG,MAEvB0a,EAAY9a,KAAKgb,GAGnB,OAAOF,IACN,KAKP,SAASG,GAAMxR,EAAUD,EAAWD,GAClC,OAAOE,EAASD,EAAWD,GAG7B,SAAS,GAAWD,EAAeF,EAAeG,GAChD,OAAOD,EAAcF,EAAeG,GAGtC,SAAS,GAAeN,EAAmBC,EAAWpB,GACpD,OAAOmB,EAAkBC,EAAWpB,GAGtC,SAAS,GAAWoT,EAAkBC,GACpC,MAAO,CAACD,EAAiBC,EAAU,KAGrC,SAAS,GAAWD,EAAkBC,GACpC,MAAO,CAACD,EAAiBC,EAAU,KAGrC,SAASC,KACP,OAAO,SAA0BzX,GAC/B,MAAO,CACL4D,IAAK5D,EAAO,IACZ6D,MAAO7D,EAAE,cACT0X,MAAO1X,EAAE,eACT8D,MAAO9D,EAAW,QAClB+D,IAAK/D,EAAO,IACZ2X,GAAI3X,EAAY,WAKtB,SAAS4X,GAAiBC,EAAcC,GACtC,OAAO,SAAU/U,GACf,OAAoB,OAAhBA,EAAI8B,SAAoC,OAAhB9B,EAAI+B,SACtB,EAGN/B,EAAI8B,SAAW9B,EAAI+B,QACd,EAGL+S,EAAa9U,EAAI8B,QAAS9B,EAAI+B,SACzB,EAGLgT,EAAS/U,EAAI8B,QAAS9B,EAAI+B,SAAW,IAChC,EAEA,GAKb,SAASiT,GAAiBF,EAAcC,GACtC,OAAO,SAAU/U,GACf,OAAoB,OAAhBA,EAAIiV,SAAoC,OAAhBjV,EAAIkV,SACtB,EAGNlV,EAAIiV,SAAWjV,EAAIkV,QACd,EAGLJ,EAAa9U,EAAIiV,QAASjV,EAAIkV,SACzB,EAGLH,EAAS/U,EAAIiV,QAASjV,EAAIkV,SAAW,IAChC,EAEA,GAKb,SAASC,GAAiBL,EAAcC,GACtC,OAAO,SAAU/U,GACf,OAAoB,OAAhBA,EAAIgC,SAAoC,OAAhBhC,EAAIiC,SACtB,EAGNjC,EAAIgC,SAAWhC,EAAIiC,QACd,EAGL6S,EAAa9U,EAAIgC,QAAShC,EAAIiC,SACzB,EAGL8S,EAAS/U,EAAIgC,QAAShC,EAAIiC,SAAW,IAChC,EAEA,GAKb,SAASmT,KACP,OAAO,SAAUC,EAAQC,GACvB,IAAIC,EAAM,IAAIC,KAAKH,GACfI,EAAM,IAAID,KAAKF,GAEnB,OAAO3Q,KAAK+Q,IAAIH,EAAME,GADR,SAKlB,SAASE,GAAeC,EAAaC,GACnC,OAAO,SAAU7V,GACf,OAAkB,OAAdA,EAAIkC,OAAgC,OAAdlC,EAAImC,OACpB,EAGNnC,EAAIkC,OAASlC,EAAImC,OAAgC,SAAvBnC,EAAIkC,MAAM5L,OAAO,GACtC,EAGL0J,EAAIkC,OAASlC,EAAImC,MACZ,EAGLyT,EAAY5V,EAAIkC,MAAOlC,EAAImC,QAAU,EAChC,EAGL0T,EAAuB7V,EAAIkC,MAAOlC,EAAImC,OAAS,EAC1C,EAGL0T,EAAuB7V,EAAIkC,MAAOlC,EAAImC,OAAS,GAC1C,EAEA,GAKb,SAAS2T,KACP,OAAO,SAAU9V,GACf,OAAiB,OAAbA,EAAI+V,MAA8B,OAAb/V,EAAIgW,MACnB,EAGNhW,EAAI+V,MAAQ/V,EAAIgW,KACX,EAGLhW,EAAI+V,KAAKzf,MAAM,EAAG,IAAM0J,EAAIgW,KAAK1f,MAAM,EAAG,GACrC,EAEA,GAKb,SAAS,GAAiB2f,EAAiBC,EAAiBC,EAAiBC,EAAeC,GAC1F,MAAO,CACL9U,sBAAuB,EAAI,IAC3BC,mBAAoB,CAAC,CACnBC,WAAY,EACZC,SAAU,QACVC,gBAAiB,CAAC,kBAAoB,oBAAsB,oBAAsB,qBAClFC,gBAAiB,CAAC,oBAAsB,mBAAqB,qBAAuB,mBACpFC,gBAAiBoU,GAChB,CACDxU,WAAY,EACZC,SAAU,QACVC,gBAAiB,CAAC,kBAAoB,oBAAsB,oBAAsB,qBAClFC,gBAAiB,CAAC,oBAAsB,mBAAqB,qBAAuB,mBACpFC,gBAAiBqU,GAChB,CACDzU,WAAY,EACZC,SAAU,QACVC,gBAAiB,CAAC,kBAAoB,qBAAuB,qBAAuB,sBACpFC,gBAAiB,CAAC,mBAAqB,mBAAqB,qBAAuB,mBACnFC,gBAAiBsU,GAChB,CACDzU,SAAU,MACVC,gBAAiB,CAAC,kBAAoB,mBAAqB,kBAAoB,qBAAuB,qBAAsB,sBAC5HC,gBAAiB,CAAC,sBAAwB,qBAAuB,oBAAsB,oBAAsB,qBAAuB,mBACpIC,gBAAiBuU,GAChB,CACD1U,SAAU,KACVC,gBAAiB,CAAC,kBAAoB,mBAAqB,mBAAqB,sBAAuB,qBAAuB,sBAC9HC,gBAAiB,CAAC,mBAAqB,mBAAqB,kBAAoB,mBAAqB,mBAAqB,oBAC1HC,gBAAiBwU,KAKvB,SAAS,KACP,MAAO,CACLze,MAAO,CACL2V,KAAM,uEACNC,SAAU,IAEZ/P,OAAQ,KAIZ,SAAS6Y,GAAIzb,GACX,OAAOA,EAAQ,6CAGjB,SAAS0b,GAAU1b,GACjB,OAAOA,EAAQ,+BAGjB,SAAS2b,GAAcC,GACrB,OAAO,SAAsBC,EAAOC,GAClC,IAAIC,EAAQH,EAAGI,gBAAgBH,GAC3BI,EAAQL,EAAGI,gBAAgBF,GAC/B,OAAOC,EAAM1d,QAAO,SAAUxC,GAC5B,OAAOogB,EAAM3K,SAASzV,MACrBkD,OAAS,GAIhB,SAAS,GAAmBwO,GAC1B,OAAOA,EAAGC,IAAI,sJAAuJD,EAAGE,UAAUC,MAAK,SAAUC,GAC/L,IAAIC,EAAS,GAIb,OAHAD,EAAS1O,SAAQ,SAAUkG,GACzByI,EAAOzI,EAAI0I,WAAa1I,EAAI2I,QAEvBF,KAIX,SAAS,GAAgBL,GACvB,OAAOA,EAAGC,IAAI,oJAAqJD,EAAGE,UAAUC,MAAK,SAAUC,GAC7L,IAAIC,EAAS,GAIb,OAHAD,EAAS1O,SAAQ,SAAUkG,GACzByI,EAAOzI,EAAI6I,SAAW7I,EAAI2I,QAErBF,KAIX,SAAS,GAAYM,EAAmBC,GACtC,MAAO,CACLlI,MAAOiI,EACP4L,MAAO5L,EACPhI,MAAOiI,GAIX,SAAS+N,KACP,OAAO,SAAUjT,EAAG+B,GAClB,GAAgB,GAAZ/B,EAAElK,OAAa,OAAOiM,EAAEjM,OAC5B,GAAgB,GAAZiM,EAAEjM,OAAa,OAAOkK,EAAElK,OAC5B,IAEIF,EAOAsd,EATAC,EAAS,GAIb,IAAKvd,EAAI,EAAGA,GAAKmM,EAAEjM,OAAQF,IACzBud,EAAOvd,GAAK,CAACA,GAMf,IAAKsd,EAAI,EAAGA,GAAKlT,EAAElK,OAAQod,IACzBC,EAAO,GAAGD,GAAKA,EAIjB,IAAKtd,EAAI,EAAGA,GAAKmM,EAAEjM,OAAQF,IACzB,IAAKsd,EAAI,EAAGA,GAAKlT,EAAElK,OAAQod,IACrBnR,EAAEqR,OAAOxd,EAAI,IAAMoK,EAAEoT,OAAOF,EAAI,GAClCC,EAAOvd,GAAGsd,GAAKC,EAAOvd,EAAI,GAAGsd,EAAI,GAEjCC,EAAOvd,GAAGsd,GAAKrS,KAAKtG,IAAI4Y,EAAOvd,EAAI,GAAGsd,EAAI,GAAK,EAC/CrS,KAAKtG,IAAI4Y,EAAOvd,GAAGsd,EAAI,GAAK,EAC5BC,EAAOvd,EAAI,GAAGsd,GAAK,IAKzB,OAAOC,EAAOpR,EAAEjM,QAAQkK,EAAElK,SAI9B,SAASud,GAAItc,GACX,OAAOA,EAAQ,QAGjB,SAASuc,GAAQvc,GACf,OAAOA,EAAQ,wBAGF,SAAS,GAAO0F,EAASC,GACtC,IAAIC,EAAOF,EAAQG,SACnBD,EAAKE,SAASH,EAAS,UAAU/I,OAAO,QAAS,CAAC,MAAOsa,IACzDtR,EAAKE,SAASH,KAAY/I,OAAO,CAAC,MAAO,IACzCgJ,EAAKE,SAASH,EAAS,WAAW/I,OAAO,SAAU,CAAC,MAAOua,IAC3DvR,EAAKE,SAASH,EAAS,WAAW/I,OAAO,SAAU,CAAC,MAAOwa,IAC3DxR,EAAKE,SAASH,EAAS,WAAW/I,OAAO,SAAU,CAAC,MAAOya,IAC3DzR,EAAKE,SAASH,EAAS,WAAW/I,OAAO,SAAU,CAAC,MAAO0a,IAC3D1R,EAAKE,SAASH,EAAS,WAAW/I,OAAO,SAAU,CAAC,MAAO2a,IAC3D3R,EAAKE,SAASH,EAAS,UAAU/I,OAAO,QAAS,CAAC,QAAS4a,IAC3D5R,EAAKE,SAASH,EAAS,0BAA0B/I,OAAO,wBAAyB,CAAC,OAAQ,cAAe6a,IACzG7R,EAAKE,SAASH,EAAS,WAAW/I,OAAO,SAAU,CAAC,MAAO+a,IAC3D/R,EAAKE,SAASH,EAAS,wBAAwB/I,OAAO,sBAAuB,CAAC,UAAWgb,IACzFhS,EAAKE,SAASH,EAAS,iBAAiB/I,OAAO,eAAgB,CAAC,aAAc,wBAAwB,SAAU4f,EAAGC,GACjH,OAAOD,EAAEE,MAAMD,MAEjB7W,EAAKE,SAASH,EAAS,oBAAoB/I,OAAO,kBAAmB,CAAC,sBAAuB,YAAa,kBAAmB,YAAa,eAAgB,cAAeob,IACzKpS,EAAKE,SAASH,EAAS,WAAW/I,OAAO,SAAU,CAAC,MAAOsb,IAC3DtS,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAa,CAAC,MAAOub,IACjEvS,EAAKE,SAASH,EAAS,WAAW/I,OAAO,SAAU,CAAC,MAAOwb,IAC3DxS,EAAKE,SAASH,EAAS,eAAe/I,OAAO,aAAc,CAAC,wBAAyB,YAAa,kBAAmB,cAAeyb,IACpIzS,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAa,CAAC,aAAc,iBAAkB,SAAU0b,IACpG1S,EAAKE,SAASH,EAAS,mBAAmB/I,OAAO,iBAAkBmc,IACnE,IAAIzK,EAAS5I,EAAQG,OAAO,IAC5BD,EAAK2I,OAAO,gBAAiBD,GAC7B1I,EAAK2I,OAAO,WAAYD,GACxB1I,EAAK2I,OAAO,oBAAqBD,GACjC1I,EAAK2I,OAAO,wBAAyBD,GACrC1I,EAAKE,SAASH,EAAS,SAAS/I,OAAO,OAAQ,CAAC,WAAY,YAAa,mBAAoB8c,IAC7F9T,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAa,CAAC,gBAAiB,gBAAiB,mBAAoB,IAChHgJ,EAAKE,SAASH,EAAS,kBAAkB/I,OAAO,gBAAiB,CAAC,oBAAqB,YAAa,aAAc,IAClHgJ,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAa,CAAC,mBAAoB,aAAc,IAC5FgJ,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAa,CAAC,mBAAoB,aAAc,IAC5FgJ,EAAKE,SAASH,EAAS,qBAAqB/I,OAAO,mBAAoBid,IACvEjU,EAAKE,SAASH,EAAS,oBAAoB/I,OAAO,kBAAmB,CAAC,eAAgB,YAAaod,IACnGpU,EAAKE,SAASH,EAAS,oBAAoB/I,OAAO,kBAAmB,CAAC,eAAgB,YAAaud,IACnGvU,EAAKE,SAASH,EAAS,oBAAoB/I,OAAO,kBAAmB,CAAC,eAAgB,YAAa0d,IACnG1U,EAAKE,SAASH,EAAS,2BAA2B/I,OAAO,yBAA0B2d,IACnF3U,EAAKE,SAASH,EAAS,kBAAkB/I,OAAO,gBAAiB,CAAC,cAAe,0BAA2Bke,IAC5GlV,EAAKE,SAASH,EAAS,iBAAiB/I,OAAO,eAAgBqe,IAC/DrV,EAAKE,SAASH,EAAS,oBAAoB/I,OAAO,kBAAmB,CAAC,kBAAmB,kBAAmB,kBAAmB,gBAAiB,gBAAiB,IACjKgJ,EAAKE,SAASH,EAAS,cAAc/I,OAAO,YAAa,IACzD,IAAI+f,EAASjX,EAAQG,OAAO,IAW5B,OAVAD,EAAK2I,OAAO,sBAAuBoO,GACnC/W,EAAKE,SAASH,EAAS,OAAO/I,OAAO,KAAM,CAAC,WAAY6e,IACxD7V,EAAKE,SAASH,EAAS,aAAa/I,OAAO,WAAY,CAAC,WAAY8e,IACpE9V,EAAKE,SAASH,EAAS,iBAAiB/I,OAAO,eAAgB,CAAC,MAAO+e,IACvE/V,EAAKE,SAASH,EAAS,sBAAsB/I,OAAO,oBAAqB,CAAC,MAAO,IACjFgJ,EAAKE,SAASH,EAAS,mBAAmB/I,OAAO,iBAAkB,CAAC,MAAO,IAC3EgJ,EAAKE,SAASH,EAAS,eAAe/I,OAAO,aAAc,CAAC,oBAAqB,kBAAmB,IACpGgJ,EAAKE,SAASH,EAAS,gBAAgB/I,OAAO,cAAesf,IAC7DtW,EAAKE,SAASH,EAAS,OAAO/I,OAAO,KAAM,CAAC,WAAY0f,IACxD1W,EAAKE,SAASH,EAAS,WAAW/I,OAAO,SAAU,CAAC,WAAY2f,IACzD3W,E,yBCjeF,IAAMgX,GAAc,CACvB7f,MAAO,8DACP8f,UAAW,aACXC,SAAU,oDACVC,UAAW,MACXC,cAAe,wBACf/f,YAAa,yIAGbJ,GAAe,CACf,QACA,SACA,SACA,SACA,SACA,SACA,QACA,wBACA,SACA,sBACA,kBACA,SACA,YACA,UAIEogB,GAAY,sKAiBlB,YAAgBhhB,GAEZ,OAAQ,SAAC,KAAD,CACJW,OAAQA,GACRC,aAAcA,GACdG,iBAAkB4f,GAClBlgB,IAAKugB,GACL9gB,aAAcF,EAAMC","file":"component---src-pages-intro-to-probabilistic-linkage-jsx-3a5546ce317d8be79fd6.js","sourcesContent":["export default function _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}","import React from 'react'\nimport { css } from \"@emotion/core\"\nimport { rhythm } from \"../utils/typography\"\nimport { Link } from \"gatsby\"\n\n\nconst foot = css`\nmargin-left: auto;\n  margin-right: auto;\n  width: 80%;\n  max-width: 640px;\n  `\n\nconst cen = css`\n  text-align: center;\n`\n\nconst mar = css`\n  margin-top: 1rem;\n  margin-bottom: 0.5rem;\n`\n\nconst flex = css`\n\n\n    display: flex;\n    justify-content: space-between;\n\n`\n\nconst order_of_articles = [\n  \"/intro_to_probabilistic_linkage/\",\n  \"/maths_of_fellegi_sunter/\",\n  \"/visualising_fellegi_sunter/\",\n  \"/understanding_match_weights/\",\n  \"/match_weight_dependencies/\",\n  \"/m_u_generator/\",\n]\n\nconst LinkageFooter = (props) => {\n\n  let path = props.current_path\n\n  let this_index = order_of_articles.indexOf(path)\n\n  let previous_article = order_of_articles[this_index - 1]\n  let next_article = order_of_articles[this_index + 1]\n\n  if (previous_article === undefined) {\n    previous_article = <div></div>\n  } else {\n    previous_article = <div><Link to={previous_article}> &lt; Previous article</Link></div>\n  }\n\n  if (next_article === undefined) {\n    next_article = <div></div>\n  } else {\n    next_article = <div><Link to={next_article}> Next article &gt;</Link></div>\n  }\n\n  return (\n    <div>\n      <hr css={mar} />\n      <div css={flex}>\n        {previous_article}\n        <div><Link to=\"/probabilistic_linkage\">Probabilistic linkage home</Link></div>\n        {next_article}\n      </div>\n\n    </div >)\n}\n\nexport default LinkageFooter","import React from 'react'\nimport Layout from \"../layouts/layout\"\nimport LinkageFooter from './linkage_footer'\nimport ObeservableNotebookDiv from \"./observable_div\"\nimport PostFrontMatter from \"./post_frontmatter\"\nimport SEO from \"./seo\"\n\n\nfunction ProbLinkagePage(props) {\n\n\n  // let post\n\n\n  let post = <ObeservableNotebookDiv define={props.define} output_order={props.output_order} />\n\n\n  return (\n    <Layout css={props.className}>\n      <SEO title={props.post_frontmatter.title} description={props.post_frontmatter.description} />\n      <PostFrontMatter post_frontmatter={props.post_frontmatter} />\n      {post}\n      <LinkageFooter current_path={props.current_path}\n      />\n    </Layout>\n  )\n\n}\n\nexport default ProbLinkagePage","import _defineProperty from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10, _templateObject11, _templateObject12, _templateObject13;\n\nimport _regeneratorRuntime from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// https://observablehq.com/@uwdata/arquero@209\nfunction _1(md) {\n  return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Arquero\\n\\nArquero is a library for query processing and transformation of array-backed data tables. Following the [relational algebra](https://en.wikipedia.org/wiki/Relational_algebra) and inspired by the design of [dplyr](https://dplyr.tidyverse.org/), Arquero provides a fluent API for manipulating column-oriented data frames. Arquero supports a range of data transformation tasks, including filter, sample, aggregation, window, join, and reshaping operations. Arquero is Spanish for \\\"archer\\\": if datasets are [arrows](https://observablehq.com/@theneuralbit/introduction-to-apache-arrow), Arquero helps their aim stay true.\"])));\n}\n\nfunction _2(md) {\n  return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"Import Arquero and extend it to print HTML tables in Observable:\"])));\n}\n\nfunction _aq(_x, _x2, _x3, _x4) {\n  return _aq2.apply(this, arguments);\n}\n\nfunction _aq2() {\n  _aq2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(require, aq_version, aq_packages, toView) {\n    var aq;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return require(\"arquero@\".concat(aq_version));\n\n          case 2:\n            aq = _context.sent;\n            _context.next = 5;\n            return Promise.all(aq_packages.map(function (pkg) {\n              return require(pkg);\n            }));\n\n          case 5:\n            _context.sent.forEach(function (pkg) {\n              return aq.addPackage(pkg);\n            });\n\n            // Add HTML table view method to tables\n            aq.addTableMethod('view', toView, {\n              override: true\n            });\n            return _context.abrupt(\"return\", aq);\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _aq2.apply(this, arguments);\n}\n\nfunction _aq_version() {\n  return '4.2.0';\n}\n\nfunction _aq_packages() {\n  return [];\n}\n\nfunction _6(md) {\n  return md(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"Export a global reference to Arquero operations:\"])));\n}\n\nfunction _op(aq) {\n  return aq.op;\n}\n\nfunction _8(md) {\n  return md(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"To use the same setup in your own notebooks, add a cell with the following code:\\n~~~ js\\nimport { aq, op } from '@uwdata/arquero'\\n~~~\\n\"])));\n}\n\nfunction _9(md) {\n  return md(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"To get started, see the [Introducing Arquero](https://observablehq.com/@uwdata/introducing-arquero) and [Arquero Cookbook](https://observablehq.com/@uwdata/arquero-cookbook) notebooks.\"])));\n}\n\nfunction _10(md) {\n  return md(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"To use Arquero outside of Observable, see [https://github.com/uwdata/arquero](https://github.com/uwdata/arquero).\"])));\n}\n\nfunction _11(md) {\n  return md(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"<hr>\\n## Examples\\n\\nThe core abstractions in Arquero are *data tables*, which model each column as an array of values, and *verbs* that transform data and return new tables. Verbs are table methods, allowing method chaining for multi-step transformations. Though each table is unique, many verbs reuse the underlying columns to limit duplication.\\n\"])));\n}\n\nfunction _12(md) {\n  return md(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"Average hours of sunshine per month, from [https://usclimatedata.com/](https://usclimatedata.com/):\"])));\n}\n\nfunction _dt(aq) {\n  return aq.table({\n    'Seattle': [69, 108, 178, 207, 253, 268, 312, 281, 221, 142, 72, 52],\n    'Chicago': [135, 136, 187, 215, 281, 311, 318, 283, 226, 193, 113, 106],\n    'San Francisco': [165, 182, 251, 281, 314, 330, 300, 272, 267, 243, 189, 156]\n  });\n}\n\nfunction _14(md) {\n  return md(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"Sorted differences between Seattle and Chicago:\"])));\n}\n\nfunction _15(dt, op) {\n  return dt.derive({\n    month: function month(d) {\n      return op.row_number();\n    },\n    diff: function diff(d) {\n      return d.Seattle - d.Chicago;\n    }\n  }).select('month', 'diff').orderby('month').view({\n    height: 400\n  });\n}\n\nfunction _16(md) {\n  return md(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"Is Seattle more correlated with San Francisco or Chicago?\"])));\n}\n\nfunction _17(dt, op) {\n  return dt.rollup({\n    corr_sf: op.corr('Seattle', 'San Francisco'),\n    corr_chi: op.corr('Seattle', 'Chicago')\n  }).view();\n}\n\nfunction _18(md) {\n  return md(_templateObject11 || (_templateObject11 = _taggedTemplateLiteral([\"Summary statistics per city, as output objects:\"])));\n}\n\nfunction _19(dt, aq, op) {\n  return dt.fold(aq.all(), {\n    as: ['city', 'sun']\n  }).groupby('city').rollup({\n    min: function min(d) {\n      return op.min(d.sun);\n    },\n    // functional form of op.min('sun')\n    max: function max(d) {\n      return op.max(d.sun);\n    },\n    avg: function avg(d) {\n      return op.average(d.sun);\n    },\n    med: function med(d) {\n      return op.median(d.sun);\n    },\n    // functional forms permit flexible table expressions\n    skew: function skew(_ref) {\n      var s = _ref.sun;\n      return (op.mean(s) - op.median(s)) / op.stdev(s) || 0;\n    }\n  }).objects();\n}\n\nfunction _20(md) {\n  return md(_templateObject12 || (_templateObject12 = _taggedTemplateLiteral([\"<hr>\\n## Utilities\\n\"])));\n}\n\nfunction _toView(html) {\n  var DEFAULT_LIMIT = 100;\n\n  var DEFAULT_NULL = function DEFAULT_NULL(value) {\n    return \"<span style=\\\"color: #999;\\\">\".concat(value, \"</span>\");\n  };\n\n  var tableStyle = 'margin: 0; border-collapse: collapse; width: initial;';\n  var cellStyle = 'padding: 1px 5px; white-space: nowrap; overflow-x: hidden; text-overflow: ellipsis; font-variant-numeric: tabular-nums;'; // extend table prototype to provide an HTML table view\n\n  return function (dt) {\n    var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    // permit shorthand for limit\n    if (typeof opt === 'number') opt = {\n      limit: opt\n    }; // marshal cell color options\n\n    var color = _objectSpread({}, opt.color);\n\n    if (typeof opt.color === 'function') {\n      // if function, apply to all columns\n      dt.columnNames().forEach(function (name) {\n        return color[name] = opt.color;\n      });\n    } else {\n      var _loop = function _loop(key) {\n        var value = color[key];\n        color[key] = typeof value === 'function' ? value : function () {\n          return value;\n        };\n      };\n\n      // otherwise, gather per-column color options\n      for (var key in color) {\n        _loop(key);\n      }\n    } // marshal CSS styles as toHTML() options\n\n\n    var table = \"\".concat(tableStyle);\n\n    var td = function td(name, index, row) {\n      return \"\".concat(cellStyle, \" max-width: \").concat(+opt.maxCellWidth || 300, \"px;\") + (color[name] ? \" background-color: \".concat(color[name](index, row), \";\") : '');\n    };\n\n    opt = _objectSpread(_objectSpread({\n      limit: DEFAULT_LIMIT,\n      null: DEFAULT_NULL\n    }, opt), {}, {\n      style: {\n        table: table,\n        td: td,\n        th: td\n      }\n    }); // return container div, bind table value to support viewof operator\n\n    var size = \"max-height: \".concat(+opt.height || 270, \"px\");\n    var style = \"\".concat(size, \"; overflow-x: auto; overflow-y: auto;\");\n    var view = html(_templateObject13 || (_templateObject13 = _taggedTemplateLiteral([\"<div style=\\\"\", \"\\\">\", \"</div>\"])), style, dt.toHTML(opt));\n    view.value = dt;\n    return view;\n  };\n}\n\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer()).define([\"md\"], _2);\n  main.variable(observer(\"aq\")).define(\"aq\", [\"require\", \"aq_version\", \"aq_packages\", \"toView\"], _aq);\n  main.variable(observer(\"aq_version\")).define(\"aq_version\", _aq_version);\n  main.variable(observer(\"aq_packages\")).define(\"aq_packages\", _aq_packages);\n  main.variable(observer()).define([\"md\"], _6);\n  main.variable(observer(\"op\")).define(\"op\", [\"aq\"], _op);\n  main.variable(observer()).define([\"md\"], _8);\n  main.variable(observer()).define([\"md\"], _9);\n  main.variable(observer()).define([\"md\"], _10);\n  main.variable(observer()).define([\"md\"], _11);\n  main.variable(observer()).define([\"md\"], _12);\n  main.variable(observer(\"dt\")).define(\"dt\", [\"aq\"], _dt);\n  main.variable(observer()).define([\"md\"], _14);\n  main.variable(observer()).define([\"dt\", \"op\"], _15);\n  main.variable(observer()).define([\"md\"], _16);\n  main.variable(observer()).define([\"dt\", \"op\"], _17);\n  main.variable(observer()).define([\"md\"], _18);\n  main.variable(observer()).define([\"dt\", \"aq\", \"op\"], _19);\n  main.variable(observer()).define([\"md\"], _20);\n  main.variable(observer(\"toView\")).define(\"toView\", [\"html\"], _toView);\n  return main;\n}","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;\n\nimport define1 from \"./79750b3b8e929d9d@209.js\";\n\nfunction _1(md) {\n  return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Fellegi Sunter utils\"])));\n}\n\nfunction _records_l() {\n  return [{\n    uid: \"1_l\",\n    fname: \"John\",\n    sname: \"Smith\",\n    dob: \"1989-03-02\",\n    town: \"Bristol\"\n  }, {\n    uid: \"2_l\",\n    fname: \"Tom\",\n    sname: \"Hanks\",\n    dob: \"1956-07-09\",\n    town: \"Concord\"\n  }, {\n    uid: \"3_l\",\n    fname: \"David\",\n    sname: \"Smith\",\n    dob: \"1981-08-21\",\n    town: \"London\"\n  }];\n}\n\nfunction _records_r() {\n  return [{\n    uid: \"1_r\",\n    fname: \"Jonathan\",\n    sname: \"Smith\",\n    dob: \"1989-03-02\",\n    town: \"Bristol\"\n  }, {\n    uid: \"2_r\",\n    fname: \"David\",\n    sname: \"Smith\",\n    dob: \"1981-08-21\",\n    town: \"Peckham\"\n  }];\n}\n\nfunction _df_r(aq, records_r) {\n  return aq.from(records_r);\n}\n\nfunction _splink_settings() {\n  return {\n    proportion_of_matches: 1 / 100,\n    comparison_columns: [{\n      num_levels: 3,\n      col_name: \"fname\",\n      u_probabilities: [0.8, 0.2],\n      m_probabilities: [0.2, 0.8],\n      case_expression: function case_expression(row) {\n        if (row.fname_l == row.fname_r) {\n          return 1;\n        } else {\n          return 0;\n        }\n      }\n    }, {\n      num_levels: 3,\n      col_name: \"sname\",\n      u_probabilities: [0.9, 0.1],\n      m_probabilities: [0.2, 0.8],\n      case_expression: function case_expression(row) {\n        if (row.sname_l == row.sname_r) {\n          return 1;\n        } else {\n          return 0;\n        }\n      }\n    }, {\n      col_name: \"dob\",\n      u_probabilities: [0.99, 0.01],\n      m_probabilities: [0.2, 0.8],\n      case_expression: function case_expression(row) {\n        if (row.dob_l == row.dob_r) {\n          return 1;\n        } else {\n          return 0;\n        }\n      }\n    }, {\n      col_name: \"town\",\n      u_probabilities: [0.7, 0.3],\n      m_probabilities: [0.3, 0.7],\n      case_expression: function case_expression(row) {\n        if (row.town_l == row.town_r) {\n          return 1;\n        } else {\n          return 0;\n        }\n      }\n    }]\n  };\n}\n\nfunction _df_comparison(get_df_comparison, records_l, records_r) {\n  return get_df_comparison(records_l, records_r);\n}\n\nfunction _7(df_comparison) {\n  return df_comparison.view();\n}\n\nfunction _df_gammas(get_df_gammas, df_comparison, splink_settings) {\n  return get_df_gammas(df_comparison, splink_settings);\n}\n\nfunction _9(df_gammas) {\n  return df_gammas.view();\n}\n\nfunction _10(get_df_e, df_gammas, splink_settings, term_freqs) {\n  return get_df_e(df_gammas, splink_settings, term_freqs).view();\n}\n\nfunction _get_df_e(get_match_probability, aq) {\n  return function get_df_e(df_gammas, splink_settings) {\n    var term_freqs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var df_e = df_gammas.objects().map(function (row) {\n      row[\"match_probability\"] = get_match_probability(row, splink_settings, term_freqs);\n      return row;\n    });\n    var df = aq.from(df_e);\n    df = df.relocate([\"match_probability\"], {\n      after: \"uid_r\"\n    });\n    return df;\n  };\n}\n\nfunction _get_match_probability(prob_to_log2_bf, log2_bf_to_prob) {\n  return function (row, settings) {\n    var term_freqs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var comparison_columns = settings.comparison_columns;\n    var prior_log2_bg = prob_to_log2_bf(settings.proportion_of_matches);\n    var log2_bayes = comparison_columns.reduce(function (a, cc) {\n      var gamma_col_name = \"𝛾_\" + cc.col_name;\n      var gamma = row[gamma_col_name]; // gamma = -1 means one side of the comparison is null\n\n      if (gamma == -1) {\n        return a;\n      }\n\n      var m = cc[\"m_probabilities\"][gamma];\n      var u = cc[\"u_probabilities\"][gamma]; // If TF lookup provided, attempt to use to overwrite u\n\n      var l_val = row[cc.col_name + \"_l\"].toLowerCase();\n      var r_val = row[cc.col_name + \"_r\"].toLowerCase();\n\n      if (l_val == r_val) {\n        if (cc.col_name in term_freqs) {\n          var tfs = term_freqs[cc.col_name];\n          var u_l = tfs[l_val] || 0;\n          var u_r = tfs[r_val] || 0;\n          var u_new = Math.max(u_l, u_r);\n\n          if (u_new > 0) {\n            u = u_new;\n          }\n        }\n      }\n\n      return a + Math.log2(m / u);\n    }, prior_log2_bg);\n    return log2_bf_to_prob(log2_bayes);\n  };\n}\n\nfunction _get_match_probability_components(prob_to_log2_bf, log2_bf_to_prob) {\n  return function (row, settings, num_columns) {\n    if (num_columns == undefined) {\n      num_columns = settings.comparison_columns.length;\n    }\n\n    var comparison_columns = settings.comparison_columns.slice(0, num_columns);\n    var prior_log2_bg = prob_to_log2_bf(settings.proportion_of_matches);\n    var d = {\n      comparison_vector: [],\n      gamma_symbols: [],\n      m_values: [],\n      u_values: [],\n      m_symbols: [],\n      u_symbols: [],\n      bayes_factors: [],\n      log2_bayes_factors: [],\n      col_names: [],\n      match_probability: null,\n      lam: settings.proportion_of_matches\n    };\n    comparison_columns.forEach(function (cc) {\n      var col_name = \"𝛾_\" + cc.col_name;\n      var gamma = row[col_name];\n      var m = cc[\"m_probabilities\"][gamma];\n      var u = cc[\"u_probabilities\"][gamma];\n      var col_name_escaped = cc.col_name.replace(\"_\", \"\\\\_\");\n      d[\"comparison_vector\"].push(gamma);\n      d[\"gamma_symbols\"].push(\"\\\\gamma_\\\\text{\".concat(col_name_escaped, \"}\"));\n      d[\"col_names\"].push(col_name);\n      d[\"m_values\"].push(m);\n      d[\"m_symbols\"].push(\"m_{\\\\text{\".concat(col_name_escaped, \"},\").concat(gamma, \"}\"));\n      d[\"u_values\"].push(u);\n      d[\"u_symbols\"].push(\"u_{\\\\text{\".concat(col_name_escaped, \"},\").concat(gamma, \"}\"));\n      d[\"bayes_factors\"].push(m / u);\n      d[\"log2_bayes_factors\"].push(Math.log2(m / u));\n    });\n    var log2_bayes = d[\"log2_bayes_factors\"].reduce(function (a, bf) {\n      return a + bf;\n    }, prior_log2_bg);\n    d[\"match_probability\"] = log2_bf_to_prob(log2_bayes);\n    var lam = settings.proportion_of_matches;\n    d[\"size_of_match_portion\"] = lam * d[\"m_values\"].reduce(function (a, b) {\n      return a * b;\n    }, 1);\n    d[\"size_of_non_match_portion\"] = (1 - lam) * d[\"u_values\"].reduce(function (a, b) {\n      return a * b;\n    }, 1);\n    return d;\n  };\n}\n\nfunction _get_m_u_formula_numbers(get_match_probability_components) {\n  return function (row, settings, num_columns) {\n    var d = get_match_probability_components(row, settings, num_columns);\n    var m = d[\"m_values\"].map(function (d) {\n      return d.toPrecision(3);\n    });\n    var u = d[\"u_values\"].map(function (d) {\n      return d.toPrecision(3);\n    });\n    var lam = d[\"lam\"].toPrecision(3);\n    var lam_m = [lam].concat(m);\n    var lam_u = [\"(1 - \".concat(lam, \")\")].concat(u);\n    var m_tex = lam_m.join(\" \\\\times \");\n    var u_tex = lam_u.join(\" \\\\times \");\n    var p = d[\"match_probability\"].toPrecision(3);\n    var m_part = d[\"size_of_match_portion\"].toPrecision(3);\n    var u_part = d[\"size_of_non_match_portion\"].toPrecision(3);\n    return \"\\\\frac{\".concat(m_tex, \"}{(\").concat(m_tex, \") + (\").concat(u_tex, \")}  \\\\newline[10pt] = \\\\frac{\").concat(m_part, \"}{\").concat(m_part, \" + \").concat(u_part, \"}  \\\\newline[10pt] = \").concat(p);\n  };\n}\n\nfunction _get_m_u_formula_symbols(get_match_probability_components) {\n  return function (row, settings) {\n    var d = get_match_probability_components(row, settings);\n    var m = d[\"m_symbols\"];\n    var u = d[\"u_symbols\"];\n    var lam = d[\"lam\"];\n    var lam_m = [\"\\\\lambda\"].concat(m);\n    var lam_u = [\"(1 - \\\\lambda)\"].concat(u);\n    var m_tex = lam_m.join(\" \");\n    var u_tex = lam_u.join(\" \");\n    return \"\\\\frac{\".concat(m_tex, \"}{\").concat(m_tex, \") + \").concat(u_tex, \"}\");\n  };\n}\n\nfunction _16(tex, get_m_u_formula_symbols, df_gammas, splink_settings) {\n  return tex(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\", \"\\n\"])), get_m_u_formula_symbols(df_gammas.objects()[0], splink_settings));\n}\n\nfunction _get_comparison_vector_symbols_and_numbers(get_match_probability_components) {\n  return function (row, settings, num_columns) {\n    var d = get_match_probability_components(row, settings, num_columns);\n    var joined = d[\"gamma_symbols\"].join(\", \");\n    var joined2 = d[\"comparison_vector\"].join(\", \");\n    return \"\\\\bm{\\\\gamma} = [\".concat(joined, \"]= [\").concat(joined2, \"]\");\n  };\n}\n\nfunction _18(tex, get_comparison_vector_symbols_and_numbers, df_gammas, splink_settings) {\n  return tex(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\", \"\\n\"])), get_comparison_vector_symbols_and_numbers(df_gammas.objects()[0], splink_settings));\n}\n\nfunction _19(tex) {\n  return tex(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\bm{gamma} = [gamma_\\text{fname}, gamma_\\text{sname}]\"], [\"\\\\bm{\\\\gamma} = [\\\\gamma_\\\\text{fname}, \\\\gamma_\\\\text{sname}]\"])));\n}\n\nfunction _20(tex, get_m_u_formula_numbers, df_gammas, splink_settings) {\n  return tex(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\", \"\"])), get_m_u_formula_numbers(df_gammas.objects()[0], splink_settings));\n}\n\nfunction _21(get_match_probability_components, df_gammas, splink_settings) {\n  return get_match_probability_components(df_gammas.objects()[0], splink_settings);\n}\n\nfunction _get_df_comparison(aq) {\n  return function (records_as_dict_l, records_as_dict_r) {\n    var df_l = aq.from(records_as_dict_l);\n    var df_r = aq.from(records_as_dict_r);\n    var df_comparison = df_l.join(df_r, function (a, b) {\n      return true;\n    }, null, {\n      suffix: [\"_l\", \"_r\"]\n    }); // Group columns\n\n    var colname_no_suffix = df_l.columnNames();\n    var cols_ordered = [];\n    colname_no_suffix.forEach(function (d) {\n      cols_ordered.push(d + \"_l\");\n      cols_ordered.push(d + \"_r\");\n    });\n    df_comparison = df_comparison.select(cols_ordered);\n    return df_comparison;\n  };\n}\n\nfunction _get_df_gammas(aq) {\n  return function get_df_gammas(df_comparison, splink_settings) {\n    var comparison_columns = splink_settings[\"comparison_columns\"]; // let df_gammas = df_comparison;\n    // let derivation = {};\n    // comparison_columns.forEach(function (cc) {\n    //   derivation[\"𝛾_\" + cc.col_name] = cc.case_expression;\n    // });\n    // df_gammas = df_gammas.derive(derivation);\n    // Since we want function calls like double metaphone in our comparison columns, we need to\n    // roundtrip from aq -> object -> aq\n\n    var df_gammas = df_comparison.objects();\n    comparison_columns.forEach(function (cc) {\n      df_gammas.forEach(function (row) {\n        row[\"𝛾_\" + cc.col_name] = cc.case_expression(row);\n      });\n    });\n    df_gammas = aq.from(df_gammas); // Put columns in order\n\n    var col_order = [\"uid_l\", \"uid_r\"];\n    comparison_columns.forEach(function (cc) {\n      col_order.push(cc.col_name + \"_l\");\n      col_order.push(cc.col_name + \"_r\");\n      col_order.push(\"𝛾_\" + cc.col_name);\n    });\n    df_gammas = df_gammas.select(col_order);\n    return df_gammas;\n  };\n}\n\nfunction _bayes_factor_to_prob() {\n  return function bayes_factor_to_prob(b) {\n    return b / (b + 1);\n  };\n}\n\nfunction _log2_bf_to_prob(bayes_factor_to_prob) {\n  return function log2_bf_to_prob(b) {\n    return bayes_factor_to_prob(Math.pow(2, b));\n  };\n}\n\nfunction _prob_to_bayes_factor() {\n  return function prob_to_bayes_factor(p) {\n    return p / (1 - p);\n  };\n}\n\nfunction _prob_to_log2_bf(prob_to_bayes_factor) {\n  return function prob_to_log2_bf(p) {\n    return Math.log2(prob_to_bayes_factor(p));\n  };\n}\n\nfunction _first_name_lookup(d3) {\n  return d3.csv(\"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv\", d3.autoType).then(function (csv_file) {\n    var lookup = {};\n    csv_file.forEach(function (row) {\n      lookup[row.firstname] = row.freq;\n    });\n    return lookup;\n  });\n}\n\nfunction _surname_lookup(d3) {\n  return d3.csv(\"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/last_name.csv\", d3.autoType).then(function (csv_file) {\n    var lookup = {};\n    csv_file.forEach(function (row) {\n      lookup[row.surname] = row.freq;\n    });\n    return lookup;\n  });\n}\n\nfunction _term_freqs(first_name_lookup, surname_lookup) {\n  return {\n    fname: first_name_lookup,\n    sname: surname_lookup\n  };\n}\n\nfunction _32(term_freqs) {\n  return term_freqs.fname[\"joshua\"];\n}\n\nfunction _33(term_freqs) {\n  return term_freqs.sname[\"linacre\"];\n}\n\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer(\"records_l\")).define(\"records_l\", _records_l);\n  main.variable(observer(\"records_r\")).define(\"records_r\", _records_r);\n  main.variable(observer(\"df_r\")).define(\"df_r\", [\"aq\", \"records_r\"], _df_r);\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", _splink_settings);\n  main.variable(observer(\"df_comparison\")).define(\"df_comparison\", [\"get_df_comparison\", \"records_l\", \"records_r\"], _df_comparison);\n  main.variable(observer()).define([\"df_comparison\"], _7);\n  main.variable(observer(\"df_gammas\")).define(\"df_gammas\", [\"get_df_gammas\", \"df_comparison\", \"splink_settings\"], _df_gammas);\n  main.variable(observer()).define([\"df_gammas\"], _9);\n  main.variable(observer()).define([\"get_df_e\", \"df_gammas\", \"splink_settings\", \"term_freqs\"], _10);\n  main.variable(observer(\"get_df_e\")).define(\"get_df_e\", [\"get_match_probability\", \"aq\"], _get_df_e);\n  main.variable(observer(\"get_match_probability\")).define(\"get_match_probability\", [\"prob_to_log2_bf\", \"log2_bf_to_prob\"], _get_match_probability);\n  main.variable(observer(\"get_match_probability_components\")).define(\"get_match_probability_components\", [\"prob_to_log2_bf\", \"log2_bf_to_prob\"], _get_match_probability_components);\n  main.variable(observer(\"get_m_u_formula_numbers\")).define(\"get_m_u_formula_numbers\", [\"get_match_probability_components\"], _get_m_u_formula_numbers);\n  main.variable(observer(\"get_m_u_formula_symbols\")).define(\"get_m_u_formula_symbols\", [\"get_match_probability_components\"], _get_m_u_formula_symbols);\n  main.variable(observer()).define([\"tex\", \"get_m_u_formula_symbols\", \"df_gammas\", \"splink_settings\"], _16);\n  main.variable(observer(\"get_comparison_vector_symbols_and_numbers\")).define(\"get_comparison_vector_symbols_and_numbers\", [\"get_match_probability_components\"], _get_comparison_vector_symbols_and_numbers);\n  main.variable(observer()).define([\"tex\", \"get_comparison_vector_symbols_and_numbers\", \"df_gammas\", \"splink_settings\"], _18);\n  main.variable(observer()).define([\"tex\"], _19);\n  main.variable(observer()).define([\"tex\", \"get_m_u_formula_numbers\", \"df_gammas\", \"splink_settings\"], _20);\n  main.variable(observer()).define([\"get_match_probability_components\", \"df_gammas\", \"splink_settings\"], _21);\n  main.variable(observer(\"get_df_comparison\")).define(\"get_df_comparison\", [\"aq\"], _get_df_comparison);\n  main.variable(observer(\"get_df_gammas\")).define(\"get_df_gammas\", [\"aq\"], _get_df_gammas);\n  main.variable(observer(\"bayes_factor_to_prob\")).define(\"bayes_factor_to_prob\", _bayes_factor_to_prob);\n  main.variable(observer(\"log2_bf_to_prob\")).define(\"log2_bf_to_prob\", [\"bayes_factor_to_prob\"], _log2_bf_to_prob);\n  main.variable(observer(\"prob_to_bayes_factor\")).define(\"prob_to_bayes_factor\", _prob_to_bayes_factor);\n  main.variable(observer(\"prob_to_log2_bf\")).define(\"prob_to_log2_bf\", [\"prob_to_bayes_factor\"], _prob_to_log2_bf);\n  var child1 = runtime.module(define1);\n  main.import(\"aq\", child1);\n  main.import(\"op\", child1);\n  main.variable(observer(\"first_name_lookup\")).define(\"first_name_lookup\", [\"d3\"], _first_name_lookup);\n  main.variable(observer(\"surname_lookup\")).define(\"surname_lookup\", [\"d3\"], _surname_lookup);\n  main.variable(observer(\"term_freqs\")).define(\"term_freqs\", [\"first_name_lookup\", \"surname_lookup\"], _term_freqs);\n  main.variable(observer()).define([\"term_freqs\"], _32);\n  main.variable(observer()).define([\"term_freqs\"], _33);\n  return main;\n}","import _defineProperty from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _1(md) {\n  return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# Waterfall chart\"])));\n}\n\nfunction _2(md) {\n  return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"### Objective\\n\\nTake \\n- a Splink settings object \\n- A row of data from `df_e`\\nAnd turn it into the data needed for the waterfall chart.\\n\\n\"], [\"### Objective\\n\\nTake \\n- a Splink settings object \\n- A row of data from \\\\`df_e\\\\`\\nAnd turn it into the data needed for the waterfall chart.\\n\\n\"])));\n}\n\nfunction _3(md) {\n  return md(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"## Example\"])));\n}\n\nfunction _splink_settings() {\n  return {\n    proportion_of_matches: 1 / 100,\n    comparison_columns: [{\n      num_levels: 3,\n      col_name: \"first_name\",\n      u_probabilities: [0.8, 0.2],\n      m_probabilities: [0.2, 0.8]\n    }, {\n      num_levels: 3,\n      col_name: \"surname\",\n      u_probabilities: [0.8, 0.2],\n      m_probabilities: [0.2, 0.8]\n    }, {\n      col_name: \"date_of_birth\",\n      u_probabilities: [0.99, 0.01],\n      m_probabilities: [0.2, 0.8]\n    }]\n  };\n}\n\nfunction _row() {\n  var _ref;\n\n  return _ref = {\n    first_name_l: \"John\",\n    first_name_r: \"John\",\n    \"\\uD835\\uDEFE_first_name\": 1,\n    surname_l: \"Smith\",\n    surname_r: \"Smith\",\n    \"\\uD835\\uDEFE_surname\": 1,\n    date_of_birth_l: \"1992-04-01\"\n  }, _defineProperty(_ref, \"date_of_birth_l\", \"1992-04-02\"), _defineProperty(_ref, \"\\uD835\\uDEFE_date_of_birth\", 0), _defineProperty(_ref, \"other\", \"hi\"), _ref;\n}\n\nfunction _overrides() {\n  return {\n    height: 200\n  };\n}\n\nfunction _7(get_waterfall_chart, row, splink_settings, overrides) {\n  return get_waterfall_chart(row, splink_settings, overrides, true);\n}\n\nfunction _8(get_waterfall_chart, row, splink_settings, overrides) {\n  return get_waterfall_chart(row, splink_settings, overrides, false);\n}\n\nfunction _9(md) {\n  return md(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"## Code\"])));\n}\n\nfunction _get_waterfall_chart(get_waterfall_chart_data, embed, get_chart_spec) {\n  return function (row, splink_settings, chart_overrides, simplified) {\n    var term_freqs = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n    var data = get_waterfall_chart_data(row, splink_settings, term_freqs);\n    return embed(get_chart_spec(data, chart_overrides, simplified));\n  };\n}\n\nfunction _get_comparison_column_lookup() {\n  return function get_comparison_column_lookup(splink_settings) {\n    var lookup = {};\n    splink_settings.comparison_columns.forEach(function (d) {\n      var col_name = d[\"col_name\"];\n      lookup[col_name] = d;\n    });\n    return lookup;\n  };\n}\n\nfunction _get_waterfall_chart_data(get_waterfall_data_lambda_row, get_waterfall_data_other_rows, get_waterfall_data_final_row) {\n  return function get_waterfall_chart_data(row, splink_settings) {\n    var term_freqs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var lambda_row = get_waterfall_data_lambda_row(splink_settings);\n    var waterfall_data_other_rows = get_waterfall_data_other_rows(row, splink_settings, term_freqs);\n    var rows_except_final = [lambda_row].concat(waterfall_data_other_rows);\n    var final_row = get_waterfall_data_final_row(splink_settings);\n    var cumulative_log2_bayes_factor = rows_except_final.reduce(function (a, b) {\n      return a + b[\"log2_bayes_factor\"];\n    }, 0);\n    final_row[\"bayes_factor\"] = Math.pow(2, cumulative_log2_bayes_factor);\n    final_row[\"log2_bayes_factor\"] = cumulative_log2_bayes_factor;\n    return rows_except_final.concat([final_row]);\n  };\n}\n\nfunction _get_waterfall_row_gamma(get_comparison_column_lookup, log2) {\n  return function get_waterfall_row_gamma(gamma_key, row, splink_settings, term_freqs) {\n    var key = gamma_key;\n    var gamma_value = row[key];\n    var col_name = key.replace(\"𝛾_\", \"\");\n    var cc_lookup = get_comparison_column_lookup(splink_settings);\n    var this_cc = cc_lookup[col_name];\n    var value_l = row[col_name + \"_l\"];\n    var value_r = row[col_name + \"_r\"];\n    var u_probability, m_probability;\n\n    if (gamma_value == -1) {\n      u_probability = 0.5;\n      m_probability = 0.5;\n    } else {\n      u_probability = this_cc[\"u_probabilities\"][gamma_value];\n      m_probability = this_cc[\"m_probabilities\"][gamma_value];\n\n      if (value_l == value_r) {\n        if (col_name in term_freqs) {\n          var tfs = term_freqs[col_name];\n          u_probability = tfs[value_l] || u_probability;\n        }\n      }\n    }\n\n    var bayes_factor = m_probability / u_probability;\n    return {\n      bayes_factor: bayes_factor,\n      column_name: col_name,\n      gamma_column_name: \"𝛾_\" + col_name,\n      gamma_index: gamma_value,\n      level_name: \"level_\" + gamma_value,\n      log2_bayes_factor: log2(bayes_factor),\n      m_probability: m_probability,\n      num_levels: null,\n      u_probability: u_probability,\n      value_l: value_l,\n      value_r: value_r\n    };\n  };\n}\n\nfunction _get_waterfall_data_lambda_row(prob_to_bayes_factor, prob_to_log2_bayes_factor) {\n  return function (splink_settings) {\n    var row = {\n      bayes_factor: prob_to_bayes_factor(splink_settings.proportion_of_matches),\n      column_name: \"Prior\",\n      gamma_column_name: \"\",\n      gamma_index: \"\",\n      level_name: null,\n      log2_bayes_factor: prob_to_log2_bayes_factor(splink_settings.proportion_of_matches),\n      m_probability: null,\n      num_levels: null,\n      u_probability: null,\n      value_l: \"\",\n      value_r: \"\"\n    };\n    return row;\n  };\n}\n\nfunction _get_waterfall_data_other_rows(get_waterfall_row_gamma) {\n  return function (row, splink_settings, term_freqs) {\n    var keys = Object.keys(row);\n    keys = keys.filter(function (key) {\n      return key.includes(\"𝛾_\");\n    });\n    return keys.map(function (gamma_key) {\n      return get_waterfall_row_gamma(gamma_key, row, splink_settings, term_freqs);\n    });\n  };\n}\n\nfunction _get_waterfall_data_final_row() {\n  return function (splink_settings) {\n    var row = {\n      bayes_factor: null,\n      column_name: \"Final score\",\n      gamma_column_name: \"\",\n      gamma_index: \"\",\n      level_name: null,\n      log2_bayes_factor: null,\n      m_probability: null,\n      num_levels: null,\n      u_probability: null,\n      value_l: \"\",\n      value_r: \"\"\n    };\n    return row;\n  };\n}\n\nfunction _get_chart_spec(base_spec) {\n  return function (data, overrides) {\n    var simplified = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    var base_spec_2 = JSON.parse(JSON.stringify(base_spec)); // let base_spec_2 = Object.assign({}, base_spec);\n\n    base_spec_2.data.values = data;\n\n    var spec = _objectSpread(_objectSpread({}, base_spec_2), overrides);\n\n    if (simplified) {\n      // Remove right hand axis\n      spec[\"layer\"][1][\"encoding\"][\"y\"][\"axis\"] = false; // Remove bayes factor text overlays\n      // spec[\"layer\"][0][\"layer\"].splice(2, 1);\n\n      spec[\"layer\"][0][\"layer\"][2][\"encoding\"][\"text\"] = {\n        type: \"nominal\",\n        field: \"up_down_emoji\"\n      };\n      spec[\"layer\"][0][\"layer\"][2][\"encoding\"][\"opacity\"] = {\n        condition: {\n          value: 0,\n          test: \"datum.column_name == 'Final score' || datum.column_name == 'Prior'\"\n        }\n      }; // Make left hand side axis probability\n\n      var expr = \"format(1 / (1 + pow(2, -1*datum.value)), '.2r')\";\n      spec[\"layer\"][0][\"layer\"][1][\"encoding\"][\"y\"][\"axis\"][\"labelExpr\"] = expr;\n      spec[\"layer\"][0][\"layer\"][1][\"encoding\"][\"y\"][\"axis\"][\"title\"] = \"probability\"; // Tooltip\n\n      spec[\"layer\"][0][\"layer\"][1][\"encoding\"][\"tooltip\"] = [{\n        type: \"quantitative\",\n        field: \"prob\",\n        format: \".3r\",\n        title: \"Cumulative match probability\"\n      }];\n    }\n\n    return spec;\n  };\n}\n\nfunction _base_spec() {\n  return {\n    config: {\n      view: {\n        continuousHeight: 300,\n        continuousWidth: 400\n      }\n    },\n    title: {\n      text: \"Bayes factor intuition chart\",\n      subtitle: \"How each comparison column contributes to the final match score\"\n    },\n    transform: [{\n      filter: \"(datum.bayes_factor !== 1.0)\"\n    }, {\n      window: [{\n        op: \"sum\",\n        field: \"log2_bayes_factor\",\n        as: \"sum\"\n      }, {\n        op: \"lead\",\n        field: \"column_name\",\n        as: \"lead\"\n      }],\n      frame: [null, 0]\n    }, {\n      calculate: 'datum.column_name === \"Final score\" ? datum.sum - datum.log2_bayes_factor : datum.sum',\n      as: \"sum\"\n    }, {\n      calculate: \"datum.lead === null ? datum.column_name : datum.lead\",\n      as: \"lead\"\n    }, {\n      calculate: 'datum.column_name === \"Final score\" || datum.column_name === \"Prior lambda\" ? 0 : datum.sum - datum.log2_bayes_factor',\n      as: \"previous_sum\"\n    }, {\n      calculate: 'datum.sum > datum.previous_sum ? datum.column_name : \"\"',\n      as: \"top_label\"\n    }, {\n      calculate: 'datum.sum < datum.previous_sum ? datum.column_name : \"\"',\n      as: \"bottom_label\"\n    }, {\n      calculate: \"datum.sum > datum.previous_sum ? datum.sum : datum.previous_sum\",\n      as: \"sum_top\"\n    }, {\n      calculate: \"datum.sum < datum.previous_sum ? datum.sum : datum.previous_sum\",\n      as: \"sum_bottom\"\n    }, {\n      calculate: \"(datum.sum + datum.previous_sum) / 2\",\n      as: \"center\"\n    }, {\n      calculate: '(datum.log2_bayes_factor > 0 ? \"+\" : \"\") + datum.log2_bayes_factor',\n      as: \"text_log2_bayes_factor\"\n    }, {\n      calculate: \"datum.sum < datum.previous_sum ? 4 : -4\",\n      as: \"dy\"\n    }, {\n      calculate: 'datum.sum < datum.previous_sum ? \"top\" : \"bottom\"',\n      as: \"baseline\"\n    }, {\n      calculate: \"1. / (1 + pow(2, -1.*datum.sum))\",\n      as: \"prob\"\n    }, {\n      calculate: \"0*datum.sum\",\n      as: \"zero\"\n    }, {\n      calculate: 'datum.sum > datum.previous_sum ? \"↑\" : \"↓\"',\n      as: \"up_down_emoji\"\n    }],\n    layer: [{\n      layer: [{\n        mark: \"rule\",\n        encoding: {\n          y: {\n            field: \"zero\",\n            type: \"quantitative\"\n          },\n          size: {\n            value: 0.5\n          },\n          color: {\n            value: \"black\"\n          }\n        }\n      }, {\n        mark: {\n          type: \"bar\",\n          width: 60\n        },\n        encoding: {\n          color: {\n            condition: {\n              value: \"red\",\n              test: \"(datum.log2_bayes_factor < 0)\"\n            },\n            value: \"green\"\n          },\n          opacity: {\n            condition: {\n              value: 1,\n              test: \"datum.column_name == 'Prior' || datum.column_name == 'Final score'\"\n            },\n            value: 0.5\n          },\n          tooltip: [{\n            type: \"nominal\",\n            field: \"column_name\",\n            title: \"Comparison column\"\n          }, {\n            type: \"nominal\",\n            field: \"value_l\",\n            title: \"Value (L)\"\n          }, {\n            type: \"nominal\",\n            field: \"value_r\",\n            title: \"Value (R)\"\n          }, {\n            type: \"nominal\",\n            field: \"gamma_index\",\n            title: \"Gamma level\"\n          }, {\n            type: \"quantitative\",\n            field: \"bayes_factor\",\n            format: \".3r\",\n            title: \"Bayes factor\"\n          }, {\n            type: \"quantitative\",\n            field: \"log2_bayes_factor\",\n            format: \".3r\",\n            title: \"log2(Bayes factor)\"\n          }, {\n            type: \"quantitative\",\n            field: \"prob\",\n            format: \".3r\",\n            title: \"Cumulative match probability\"\n          }],\n          x: {\n            type: \"nominal\",\n            axis: {\n              labelExpr: \"datum.value == 'Prior' || datum.value == 'Final score' ? '' : datum.value\",\n              labelAlign: \"center\",\n              labelPadding: 10,\n              title: \"Column\",\n              grid: true,\n              tickBand: \"extent\"\n            },\n            field: \"column_name\",\n            sort: null\n          },\n          y: {\n            type: \"quantitative\",\n            axis: {\n              grid: false,\n              orient: \"left\",\n              title: \"log2(Bayes factor)\"\n            },\n            field: \"previous_sum\"\n          },\n          y2: {\n            field: \"sum\"\n          }\n        }\n      }, {\n        mark: {\n          type: \"text\",\n          fontWeight: \"bold\"\n        },\n        encoding: {\n          color: {\n            value: \"white\"\n          },\n          text: {\n            condition: {\n              type: \"nominal\",\n              field: \"log2_bayes_factor\",\n              format: \".2f\",\n              test: \"abs(datum.log2_bayes_factor) > 1\"\n            },\n            value: \"\"\n          },\n          x: {\n            type: \"nominal\",\n            axis: {\n              labelAngle: 0,\n              title: \"Column\"\n            },\n            field: \"column_name\",\n            sort: null\n          },\n          y: {\n            type: \"quantitative\",\n            axis: {\n              orient: \"left\"\n            },\n            field: \"center\"\n          }\n        }\n      }, {\n        mark: {\n          type: \"text\",\n          baseline: \"bottom\",\n          dy: -5,\n          fontWeight: \"bold\"\n        },\n        encoding: {\n          color: {\n            value: \"black\"\n          },\n          text: {\n            condition: {\n              type: \"nominal\",\n              field: \"top_label\",\n              test: \"abs(datum.log2_bayes_factor) > 1\"\n            },\n            value: \"\"\n          },\n          x: {\n            type: \"nominal\",\n            axis: {\n              labelAngle: 0,\n              title: \"Column\"\n            },\n            field: \"column_name\",\n            sort: null\n          },\n          y: {\n            type: \"quantitative\",\n            field: \"sum_top\"\n          }\n        }\n      }, {\n        mark: {\n          type: \"text\",\n          baseline: \"top\",\n          dy: 5,\n          fontWeight: \"bold\"\n        },\n        encoding: {\n          color: {\n            value: \"black\"\n          },\n          text: {\n            condition: {\n              type: \"nominal\",\n              field: \"bottom_label\",\n              test: \"abs(datum.log2_bayes_factor) > 1\"\n            },\n            value: \"\"\n          },\n          x: {\n            type: \"nominal\",\n            axis: {\n              labelAngle: 0,\n              title: \"Column\"\n            },\n            field: \"column_name\",\n            sort: null\n          },\n          y: {\n            type: \"quantitative\",\n            field: \"sum_bottom\"\n          }\n        }\n      }]\n    }, {\n      mark: {\n        type: \"rule\",\n        color: \"black\",\n        strokeWidth: 2,\n        x2Offset: 30,\n        xOffset: -30\n      },\n      encoding: {\n        x: {\n          type: \"nominal\",\n          axis: {\n            labelAngle: 0,\n            title: \"Column\"\n          },\n          field: \"column_name\",\n          sort: null\n        },\n        x2: {\n          field: \"lead\"\n        },\n        y: {\n          type: \"quantitative\",\n          axis: {\n            labelExpr: \"format(1 / (1 + pow(2, -1*datum.value)), '.2r')\",\n            orient: \"right\",\n            title: \"Probability\"\n          },\n          field: \"sum\",\n          scale: {\n            zero: false\n          }\n        }\n      }\n    }],\n    height: 450,\n    resolve: {\n      axis: {\n        y: \"independent\"\n      }\n    },\n    width: {\n      step: 75\n    },\n    $schema: \"https://vega.github.io/schema/vega-lite/v4.8.1.json\",\n    data: {\n      values: null\n    }\n  };\n}\n\nfunction _embed(require) {\n  return require(\"vega-embed@6\");\n}\n\nfunction _bayes_factor_to_prob() {\n  return function bayes_factor_to_prob(b) {\n    return b / (b + 1);\n  };\n}\n\nfunction _log2() {\n  return Math.log2;\n}\n\nfunction _prob_to_bayes_factor() {\n  return function prob_to_bayes_factor(p) {\n    return p / (1 - p);\n  };\n}\n\nfunction _prob_to_log2_bayes_factor(log2, prob_to_bayes_factor) {\n  return function prob_to_log2_bayes_factor(p) {\n    return log2(prob_to_bayes_factor(p));\n  };\n}\n\nfunction _log2_bayes_factor_to_prob(bayes_factor_to_prob) {\n  return function log2_bayes_factor_to_prob(log2_b) {\n    return bayes_factor_to_prob(Math.pow(2, log2_b));\n  };\n}\n\nfunction _first_name_lookup(d3) {\n  return d3.csv(\"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv\", d3.autoType).then(function (csv_file) {\n    var lookup = {};\n    csv_file.forEach(function (row) {\n      lookup[row.firstname] = row.freq;\n    });\n    return lookup;\n  });\n}\n\nfunction _term_freqs(first_name_lookup) {\n  return {\n    first_name: first_name_lookup\n  };\n}\n\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer()).define([\"md\"], _2);\n  main.variable(observer()).define([\"md\"], _3);\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", _splink_settings);\n  main.variable(observer(\"row\")).define(\"row\", _row);\n  main.variable(observer(\"overrides\")).define(\"overrides\", _overrides);\n  main.variable(observer()).define([\"get_waterfall_chart\", \"row\", \"splink_settings\", \"overrides\"], _7);\n  main.variable(observer()).define([\"get_waterfall_chart\", \"row\", \"splink_settings\", \"overrides\"], _8);\n  main.variable(observer()).define([\"md\"], _9);\n  main.variable(observer(\"get_waterfall_chart\")).define(\"get_waterfall_chart\", [\"get_waterfall_chart_data\", \"embed\", \"get_chart_spec\"], _get_waterfall_chart);\n  main.variable(observer(\"get_comparison_column_lookup\")).define(\"get_comparison_column_lookup\", _get_comparison_column_lookup);\n  main.variable(observer(\"get_waterfall_chart_data\")).define(\"get_waterfall_chart_data\", [\"get_waterfall_data_lambda_row\", \"get_waterfall_data_other_rows\", \"get_waterfall_data_final_row\"], _get_waterfall_chart_data);\n  main.variable(observer(\"get_waterfall_row_gamma\")).define(\"get_waterfall_row_gamma\", [\"get_comparison_column_lookup\", \"log2\"], _get_waterfall_row_gamma);\n  main.variable(observer(\"get_waterfall_data_lambda_row\")).define(\"get_waterfall_data_lambda_row\", [\"prob_to_bayes_factor\", \"prob_to_log2_bayes_factor\"], _get_waterfall_data_lambda_row);\n  main.variable(observer(\"get_waterfall_data_other_rows\")).define(\"get_waterfall_data_other_rows\", [\"get_waterfall_row_gamma\"], _get_waterfall_data_other_rows);\n  main.variable(observer(\"get_waterfall_data_final_row\")).define(\"get_waterfall_data_final_row\", _get_waterfall_data_final_row);\n  main.variable(observer(\"get_chart_spec\")).define(\"get_chart_spec\", [\"base_spec\"], _get_chart_spec);\n  main.variable(observer(\"base_spec\")).define(\"base_spec\", _base_spec);\n  main.variable(observer(\"embed\")).define(\"embed\", [\"require\"], _embed);\n  main.variable(observer(\"bayes_factor_to_prob\")).define(\"bayes_factor_to_prob\", _bayes_factor_to_prob);\n  main.variable(observer(\"log2\")).define(\"log2\", _log2);\n  main.variable(observer(\"prob_to_bayes_factor\")).define(\"prob_to_bayes_factor\", _prob_to_bayes_factor);\n  main.variable(observer(\"prob_to_log2_bayes_factor\")).define(\"prob_to_log2_bayes_factor\", [\"log2\", \"prob_to_bayes_factor\"], _prob_to_log2_bayes_factor);\n  main.variable(observer(\"log2_bayes_factor_to_prob\")).define(\"log2_bayes_factor_to_prob\", [\"bayes_factor_to_prob\"], _log2_bayes_factor_to_prob);\n  main.variable(observer(\"first_name_lookup\")).define(\"first_name_lookup\", [\"d3\"], _first_name_lookup);\n  main.variable(observer(\"term_freqs\")).define(\"term_freqs\", [\"first_name_lookup\"], _term_freqs);\n  return main;\n}","import _taggedTemplateLiteral from \"/home/runner/work/robinl.github.io/robinl.github.io/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10, _templateObject11, _templateObject12, _templateObject13;\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport define1 from \"./d25176b0fe784ad0@488.js\";\nimport define2 from \"./843cb6e82d7c3d9b@474.js\";\n\nfunction _title(md) {\n  return md(_templateObject || (_templateObject = _taggedTemplateLiteral([\"# An Interactive Introduction to Probabilistic Record Linkage\"])));\n}\n\nfunction _2(md) {\n  return md(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"*A final version of this notebook can be viewed on my blog [here](https://www.robinlinacre.com/intro_to_probabilistic_linkage/).*\"])));\n}\n\nfunction _para_1(md) {\n  return md(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"Probablistic record linkage is a technique used to link together records that lack unique identifiers.  \\n\\nIn the absence of a unique identifier such as a National Insurance number, we can use a combination of individually non-unique variables such as name, gender and date of birth to identify individuals.\\n\\nRecord linkage can be done within datasets (deduplication) or between datasets (linkage), or both.\\n\"])));\n}\n\nfunction _para_2(md) {\n  return md(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"Linkage is probabilistic in the sense that it relies on the balance on evidence.  In a large dataset, observing that two records match on the full name 'John Smith' provides some evidence that these two records may refer to the same person, but this evidence is inconclusive.  \\n\\nMore broadly, it is often impossible to classify pairs of records as matches or non-matches beyond any doubt.  Instead, the aim of probabilisitic record linkage to to quantify the probability that a pair of records refer to the same entity by considering evidence in favour and against a match and weighting it appropriately.\\n\"])));\n}\n\nfunction _para_3(md) {\n  return md(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"In probabilistic record linkage, we start with a prior, which represents the probability that two records drawn at random are a match.  We then compare the two records, increasing the match probability where columns agree, and decreasing it when columns disagree.  \\n\\n\"])));\n}\n\nfunction _para_4(md) {\n  return md(_templateObject6 || (_templateObject6 = _taggedTemplateLiteral([\"The most common type of probabilistic record linkage model is called the Fellegi-Sunter model. \\n\\nLet's take a look at at an example of a trained Fellegi-Sunter model to calculate match probability interactively.  This model will compare the two records in the table, and assess whether they refer to the same person, or different people.\"])));\n}\n\nfunction _para_5(md) {\n  return md(_templateObject7 || (_templateObject7 = _taggedTemplateLiteral([\"\\n\\u2728<span style=\\\"background-color:yellow\\\">You can edit the records in the table, and the match probability will be estimated.</span>\\u2728\"])));\n}\n\nfunction _table(html) {\n  return html(_templateObject8 || (_templateObject8 = _taggedTemplateLiteral([\"\\n<table id=\\\"data-table\\\" >\\n\\n<tr>\\n\\n<th>First name</th>\\n<th>Middle name</th>\\n<th>Surname</th>\\n<th>DOB</th>\\n<th>Postcode</th>\\n\\n</tr>\\n<tr contenteditable>\\n\\n<td>Mary</td>\\n<td>Emma</td>\\n<td>Smith</td>\\n<td>1990-05-09</td>\\n<td>SW1A 1AA</td>\\n\\n</tr>\\n<tr contenteditable>\\n\\n<td>Mary</td>\\n<td>Emma</td>\\n<td>Smith</td>\\n<td>1990-05-09</td>\\n<td>SW1A 1AA</td>\\n</tr>\\n\\n</table>\\n\"])));\n}\n\nfunction _estimated_probability(html, match_prob) {\n  return html(_templateObject9 || (_templateObject9 = _taggedTemplateLiteral([\"<h3 style=\\\"font-family:Helvetica,Arial,Sans-Serif\\\">Estimated match probability = <span style=\\\"background-color:yellow\\\">\", \"%</h3>\"])), match_prob);\n}\n\nfunction _para_6(md) {\n  return md(_templateObject10 || (_templateObject10 = _taggedTemplateLiteral([\"We can represent the model graphically using a waterfall chart, which is read left to right.  We start with the prior, and take each column into account in turn, with different match weights being applied to each column.  You can hover over the bars to see how the probability changes as each subsequent field is taken into account.\\n\\n\"])));\n}\n\nfunction _show_complex(inputs) {\n  return inputs.toggle({\n    label: \"Show details in waterfall chart\"\n  });\n}\n\nfunction _waterfall_chart(get_waterfall_chart, df_gammas, splink_settings, overrides, show_complex, term_freqs) {\n  return get_waterfall_chart(df_gammas.objects()[0], splink_settings, overrides, !show_complex, term_freqs);\n}\n\nfunction _para_7(md) {\n  return md(_templateObject11 || (_templateObject11 = _taggedTemplateLiteral([\"Columns with higher number of distinct values, such as date of birth, tend to represent stronger evidence in favour of a match since it's less likely that two records chosen at random would match by coincidence.  \\n\\nWhere a column does not match, this is usually evidence against a match.  However, the evidence may not be strong - for example, people move house, which could cause a mismatch on the 'postcode' column.\\n\\nThis, in a nutshell, is how probabilistic record linkage works.  By comparing records and weighting evidence appropriately, we estimate the probability of a match.\"])));\n}\n\nfunction _structure(md) {\n  return md(_templateObject12 || (_templateObject12 = _taggedTemplateLiteral([\"## Structure of this training material\"])));\n}\n\nfunction _para_8(md) {\n  return md(_templateObject13 || (_templateObject13 = _taggedTemplateLiteral([\" The rest of this training material explores the theory and practice of building probabilistic linkage models, focussing on the Fellegi-Sunter model. The sections are as follows:\\n\\n1. [The mathematics of the Fellegi-Sunter model](https://www.robinlinacre.com/maths_of_fellegi_sunter/)\\n2. [Visualising the Fellegi Sunter model](https://www.robinlinacre.com/visualising_fellegi_sunter/)\\n3. [The intuition behind match weights](https://www.robinlinacre.com/understanding_match_weights/)\\n\\nThese materials align closely to the probabilisic model used by [Splink](https://github.com/moj-analytical-services/splink), a piece of open source software for record linkage at scale.\\n\\n\"])));\n}\n\nfunction _match_prob(get_match_probability, df_gammas, splink_settings, term_freqs) {\n  var prob = get_match_probability(df_gammas.objects()[0], splink_settings, term_freqs);\n  return (prob * 100).toPrecision(4);\n}\n\nfunction _tableData(Generators, parseTableData, table) {\n  return Generators.observe(function (notify) {\n    var keyinput = function keyinput(event) {\n      return notify(parseTableData(table));\n    };\n\n    table.addEventListener(\"input\", keyinput, false);\n    notify(parseTableData(table));\n    return function () {\n      return window.removeEventListener(\"input\", keyinput);\n    };\n  });\n}\n\nfunction _parseTableData() {\n  return function parseTableData(table) {\n    var data = [];\n    table.querySelectorAll(\"tr\").forEach(function (row, i) {\n      var cells = row.cells;\n      var row_data = [];\n\n      var _iterator = _createForOfIteratorHelper(cells),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var cell = _step.value;\n          var value = cell.innerText;\n          value = value.trim();\n          value = value.toLowerCase();\n\n          if (value == \"\") {\n            value = null;\n          }\n\n          row_data.push(value);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      data.push(row_data);\n    });\n    var formattedData = data.reduce(function (accumulator, row, i) {\n      if (i == 0) {\n        accumulator.properties = row;\n      } else {\n        var rowObject = {};\n        rowObject[\"uid\"] = i;\n        accumulator.properties.forEach(function (key, i) {\n          rowObject[key] = row[i];\n        });\n        accumulator.push(rowObject);\n      }\n\n      return accumulator;\n    }, []);\n    return formattedData;\n  };\n}\n\nfunction _df_e(get_df_e, df_gammas, splink_settings) {\n  return get_df_e(df_gammas, splink_settings);\n}\n\nfunction _df_gammas(get_df_gammas, df_comparison, splink_settings) {\n  return get_df_gammas(df_comparison, splink_settings);\n}\n\nfunction _df_comparison(get_df_comparison, records_l, records_r) {\n  return get_df_comparison(records_l, records_r);\n}\n\nfunction _records_l(rename_dict_keys, tableData) {\n  return [rename_dict_keys(tableData[0])];\n}\n\nfunction _records_r(rename_dict_keys, tableData) {\n  return [rename_dict_keys(tableData[1])];\n}\n\nfunction _rename_dict_keys() {\n  return function rename_dict_keys(d) {\n    return {\n      uid: d[\"uid\"],\n      fname: d[\"first name\"],\n      mname: d[\"middle name\"],\n      sname: d[\"surname\"],\n      dob: d[\"dob\"],\n      pc: d[\"postcode\"]\n    };\n  };\n}\n\nfunction _fname_case_stmt(dm_intersect, distance) {\n  return function (row) {\n    if (row.fname_l === null || row.fname_r === null) {\n      return -1;\n    }\n\n    if (row.fname_l == row.fname_r) {\n      return 3;\n    }\n\n    if (dm_intersect(row.fname_l, row.fname_r)) {\n      return 2;\n    }\n\n    if (distance(row.fname_l, row.fname_r) > 0.85) {\n      return 1;\n    } else {\n      return 0;\n    }\n  };\n}\n\nfunction _mname_case_stmt(dm_intersect, distance) {\n  return function (row) {\n    if (row.mname_l === null || row.mname_r === null) {\n      return -1;\n    }\n\n    if (row.mname_l == row.mname_r) {\n      return 3;\n    }\n\n    if (dm_intersect(row.mname_l, row.mname_r)) {\n      return 2;\n    }\n\n    if (distance(row.mname_l, row.mname_r) > 0.85) {\n      return 1;\n    } else {\n      return 0;\n    }\n  };\n}\n\nfunction _sname_case_stmt(dm_intersect, distance) {\n  return function (row) {\n    if (row.sname_l === null || row.sname_r === null) {\n      return -1;\n    }\n\n    if (row.sname_l == row.sname_r) {\n      return 3;\n    }\n\n    if (dm_intersect(row.sname_l, row.sname_r)) {\n      return 2;\n    }\n\n    if (distance(row.sname_l, row.sname_r) > 0.85) {\n      return 1;\n    } else {\n      return 0;\n    }\n  };\n}\n\nfunction _abs_date_diff_in_years() {\n  return function (date_l, date_r) {\n    var d_l = new Date(date_l);\n    var d_r = new Date(date_r);\n    var divisor = 24 * 60 * 60 * 1000 * 365;\n    return Math.abs(d_l - d_r) / divisor;\n  };\n}\n\nfunction _dob_case_stmt(levenshtein, abs_date_diff_in_years) {\n  return function (row) {\n    if (row.dob_l === null || row.dob_r === null) {\n      return -1;\n    }\n\n    if (row.dob_l == row.dob_r && row.dob_l.slice(-5) == \"01-01\") {\n      return 4;\n    }\n\n    if (row.dob_l == row.dob_r) {\n      return 5;\n    }\n\n    if (levenshtein(row.dob_l, row.dob_r) <= 1) {\n      return 3;\n    }\n\n    if (abs_date_diff_in_years(row.dob_l, row.dob_r) < 1) {\n      return 2;\n    }\n\n    if (abs_date_diff_in_years(row.dob_l, row.dob_r) < 10) {\n      return 1;\n    } else {\n      return 0;\n    }\n  };\n}\n\nfunction _pc_case_stmt() {\n  return function (row) {\n    if (row.pc_l === null || row.pc_r === null) {\n      return -1;\n    }\n\n    if (row.pc_l == row.pc_r) {\n      return 5;\n    }\n\n    if (row.pc_l.slice(0, 3) == row.pc_r.slice(0, 3)) {\n      return 4;\n    } else {\n      return 0;\n    }\n  };\n}\n\nfunction _splink_settings(fname_case_stmt, mname_case_stmt, sname_case_stmt, dob_case_stmt, pc_case_stmt) {\n  return {\n    proportion_of_matches: 1 / 60e6,\n    comparison_columns: [{\n      num_levels: 4,\n      col_name: \"fname\",\n      u_probabilities: [0.9883897757902356, 0.004639565877697178, 0.002783859108435161, 0.004186799223632191],\n      m_probabilities: [0.013910835049471115, 0.03580070792581899, 0.0026304325373041827, 0.9431284756772805],\n      case_expression: fname_case_stmt\n    }, {\n      num_levels: 4,\n      col_name: \"mname\",\n      u_probabilities: [0.9883897757902356, 0.004639565877697178, 0.002783859108435161, 0.004186799223632191],\n      m_probabilities: [0.013910835049471115, 0.03580070792581899, 0.0026304325373041827, 0.9431284756772805],\n      case_expression: mname_case_stmt\n    }, {\n      num_levels: 4,\n      col_name: \"sname\",\n      u_probabilities: [0.9971958658858057, 0.0015765242689686637, 0.0003754879678726784, 0.0008521218773530913],\n      m_probabilities: [0.01809857679375992, 0.02769695651313621, 0.0014468181425986496, 0.9514336326024172],\n      case_expression: sname_case_stmt\n    }, {\n      col_name: \"dob\",\n      u_probabilities: [0.2807916467157474, 0.20073737664045227, 0.5164828418823143, 0.0019211842885877536, 9.766061108210657e-7, 6.597386678746452e-5],\n      m_probabilities: [0.00024675771766021674, 0.0017179728285089994, 0.009868620663422667, 0.023118927215599792, 0.0036827860949234354, 0.9571689718277999],\n      case_expression: dob_case_stmt\n    }, {\n      col_name: \"pc\",\n      u_probabilities: [0.6751190264364737, 0.22792766449447727, 0.09517523421356786, 1.7091033037790942e-6, 0.0017755009047047013, 8.648474727307328e-7],\n      m_probabilities: [0.18962646163517627, 0.02145498887358967, 0.4023991769621992, 0.11064711462002584, 0.07144100324386156, 0.20090472079462598],\n      case_expression: pc_case_stmt\n    }]\n  };\n}\n\nfunction _overrides() {\n  return {\n    title: {\n      text: \"Match weights and their cumulative contribution to match probability\",\n      subtitle: \"\"\n    },\n    height: 200\n  };\n}\n\nfunction _dm(require) {\n  return require(\"https://bundle.run/double-metaphone@2.0.0\");\n}\n\nfunction _distance(require) {\n  return require(\"jaro-winkler@0.2.8/index.js\");\n}\n\nfunction _dm_intersect(dm) {\n  return function dm_intersect(val_l, val_r) {\n    var arr_l = dm.doubleMetaphone(val_l);\n    var arr_r = dm.doubleMetaphone(val_r);\n    return arr_l.filter(function (value) {\n      return arr_r.includes(value);\n    }).length > 0;\n  };\n}\n\nfunction _first_name_lookup(d3) {\n  return d3.csv(\"https://gist.githubusercontent.com/RobinL/66df3f5d7dbea3d1add1a8e6067c7624/raw/d4d642e631563418e7b7889496c7a9149f259447/firstname_noyear_count2.csv\", d3.autoType).then(function (csv_file) {\n    var lookup = {};\n    csv_file.forEach(function (row) {\n      lookup[row.firstname] = row.freq;\n    });\n    return lookup;\n  });\n}\n\nfunction _surname_lookup(d3) {\n  return d3.csv(\"https://gist.githubusercontent.com/RobinL/3fe7f712ff93393fe0a28cbb1b8c3e46/raw/a87f572e194122dde4743dd905c1ce6c22fd33db/surname_noyear_count2.csv\", d3.autoType).then(function (csv_file) {\n    var lookup = {};\n    csv_file.forEach(function (row) {\n      lookup[row.surname] = row.freq;\n    });\n    return lookup;\n  });\n}\n\nfunction _term_freqs(first_name_lookup, surname_lookup) {\n  return {\n    fname: first_name_lookup,\n    mname: first_name_lookup,\n    sname: surname_lookup\n  };\n}\n\nfunction _levenshtein() {\n  return function (a, b) {\n    if (a.length == 0) return b.length;\n    if (b.length == 0) return a.length;\n    var matrix = []; // increment along the first column of each row\n\n    var i;\n\n    for (i = 0; i <= b.length; i++) {\n      matrix[i] = [i];\n    } // increment each column in the first row\n\n\n    var j;\n\n    for (j = 0; j <= a.length; j++) {\n      matrix[0][j] = j;\n    } // Fill in the rest of the matrix\n\n\n    for (i = 1; i <= b.length; i++) {\n      for (j = 1; j <= a.length; j++) {\n        if (b.charAt(i - 1) == a.charAt(j - 1)) {\n          matrix[i][j] = matrix[i - 1][j - 1];\n        } else {\n          matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, // substitution\n          Math.min(matrix[i][j - 1] + 1, // insertion\n          matrix[i - 1][j] + 1)); // deletion\n        }\n      }\n    }\n\n    return matrix[b.length][a.length];\n  };\n}\n\nfunction _d3(require) {\n  return require(\"d3@6\");\n}\n\nfunction _inputs(require) {\n  return require(\"@observablehq/inputs\");\n}\n\nexport default function define(runtime, observer) {\n  var main = runtime.module();\n  main.variable(observer(\"title\")).define(\"title\", [\"md\"], _title);\n  main.variable(observer()).define([\"md\"], _2);\n  main.variable(observer(\"para_1\")).define(\"para_1\", [\"md\"], _para_1);\n  main.variable(observer(\"para_2\")).define(\"para_2\", [\"md\"], _para_2);\n  main.variable(observer(\"para_3\")).define(\"para_3\", [\"md\"], _para_3);\n  main.variable(observer(\"para_4\")).define(\"para_4\", [\"md\"], _para_4);\n  main.variable(observer(\"para_5\")).define(\"para_5\", [\"md\"], _para_5);\n  main.variable(observer(\"table\")).define(\"table\", [\"html\"], _table);\n  main.variable(observer(\"estimated_probability\")).define(\"estimated_probability\", [\"html\", \"match_prob\"], _estimated_probability);\n  main.variable(observer(\"para_6\")).define(\"para_6\", [\"md\"], _para_6);\n  main.variable(observer(\"viewof show_complex\")).define(\"viewof show_complex\", [\"inputs\"], _show_complex);\n  main.variable(observer(\"show_complex\")).define(\"show_complex\", [\"Generators\", \"viewof show_complex\"], function (G, _) {\n    return G.input(_);\n  });\n  main.variable(observer(\"waterfall_chart\")).define(\"waterfall_chart\", [\"get_waterfall_chart\", \"df_gammas\", \"splink_settings\", \"overrides\", \"show_complex\", \"term_freqs\"], _waterfall_chart);\n  main.variable(observer(\"para_7\")).define(\"para_7\", [\"md\"], _para_7);\n  main.variable(observer(\"structure\")).define(\"structure\", [\"md\"], _structure);\n  main.variable(observer(\"para_8\")).define(\"para_8\", [\"md\"], _para_8);\n  main.variable(observer(\"match_prob\")).define(\"match_prob\", [\"get_match_probability\", \"df_gammas\", \"splink_settings\", \"term_freqs\"], _match_prob);\n  main.variable(observer(\"tableData\")).define(\"tableData\", [\"Generators\", \"parseTableData\", \"table\"], _tableData);\n  main.variable(observer(\"parseTableData\")).define(\"parseTableData\", _parseTableData);\n  var child1 = runtime.module(define1);\n  main.import(\"get_df_gammas\", child1);\n  main.import(\"get_df_e\", child1);\n  main.import(\"get_df_comparison\", child1);\n  main.import(\"get_match_probability\", child1);\n  main.variable(observer(\"df_e\")).define(\"df_e\", [\"get_df_e\", \"df_gammas\", \"splink_settings\"], _df_e);\n  main.variable(observer(\"df_gammas\")).define(\"df_gammas\", [\"get_df_gammas\", \"df_comparison\", \"splink_settings\"], _df_gammas);\n  main.variable(observer(\"df_comparison\")).define(\"df_comparison\", [\"get_df_comparison\", \"records_l\", \"records_r\"], _df_comparison);\n  main.variable(observer(\"records_l\")).define(\"records_l\", [\"rename_dict_keys\", \"tableData\"], _records_l);\n  main.variable(observer(\"records_r\")).define(\"records_r\", [\"rename_dict_keys\", \"tableData\"], _records_r);\n  main.variable(observer(\"rename_dict_keys\")).define(\"rename_dict_keys\", _rename_dict_keys);\n  main.variable(observer(\"fname_case_stmt\")).define(\"fname_case_stmt\", [\"dm_intersect\", \"distance\"], _fname_case_stmt);\n  main.variable(observer(\"mname_case_stmt\")).define(\"mname_case_stmt\", [\"dm_intersect\", \"distance\"], _mname_case_stmt);\n  main.variable(observer(\"sname_case_stmt\")).define(\"sname_case_stmt\", [\"dm_intersect\", \"distance\"], _sname_case_stmt);\n  main.variable(observer(\"abs_date_diff_in_years\")).define(\"abs_date_diff_in_years\", _abs_date_diff_in_years);\n  main.variable(observer(\"dob_case_stmt\")).define(\"dob_case_stmt\", [\"levenshtein\", \"abs_date_diff_in_years\"], _dob_case_stmt);\n  main.variable(observer(\"pc_case_stmt\")).define(\"pc_case_stmt\", _pc_case_stmt);\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", [\"fname_case_stmt\", \"mname_case_stmt\", \"sname_case_stmt\", \"dob_case_stmt\", \"pc_case_stmt\"], _splink_settings);\n  main.variable(observer(\"overrides\")).define(\"overrides\", _overrides);\n  var child2 = runtime.module(define2);\n  main.import(\"get_waterfall_chart\", child2);\n  main.variable(observer(\"dm\")).define(\"dm\", [\"require\"], _dm);\n  main.variable(observer(\"distance\")).define(\"distance\", [\"require\"], _distance);\n  main.variable(observer(\"dm_intersect\")).define(\"dm_intersect\", [\"dm\"], _dm_intersect);\n  main.variable(observer(\"first_name_lookup\")).define(\"first_name_lookup\", [\"d3\"], _first_name_lookup);\n  main.variable(observer(\"surname_lookup\")).define(\"surname_lookup\", [\"d3\"], _surname_lookup);\n  main.variable(observer(\"term_freqs\")).define(\"term_freqs\", [\"first_name_lookup\", \"surname_lookup\"], _term_freqs);\n  main.variable(observer(\"levenshtein\")).define(\"levenshtein\", _levenshtein);\n  main.variable(observer(\"d3\")).define(\"d3\", [\"require\"], _d3);\n  main.variable(observer(\"inputs\")).define(\"inputs\", [\"require\"], _inputs);\n  return main;\n}","import React from 'react'\nimport define from \"@robinl/d51533bbe054b3d8\"\nimport ProbLinkagePage from \"../components/prob_linkage_page\"\nimport { css } from \"@emotion/core\"\n\n\nexport const frontmatter = {\n    title: \"An Interactive Introduction to Probabilistic Record Linkage\",\n    post_date: \"2021-05-25\",\n    code_url: \"https://observablehq.com/@robinl/d51533bbe054b3d8\",\n    post_type: \"obs\",\n    post_category: \"probabilistic_linkage\",\n    description: \"A set of interactive, explorable explanations of the Fellegi Sunter model, providing an introduction to probabilistic record linkage.\"\n}\n\nlet output_order = [\n    \"title\",\n    \"para_1\",\n    \"para_2\",\n    \"para_3\",\n    \"para_4\",\n    \"para_5\",\n    \"table\",\n    \"estimated_probability\",\n    \"para_6\",\n    \"viewof show_complex\",\n    \"waterfall_chart\",\n    \"para_7\",\n    \"structure\",\n    \"para_8\"\n]\n\n\nconst css_override = css`\nmargin-left: auto;\nmargin-right: auto;\nwidth: 90%;\nmax-width: 700px;\ntable {font-size: 1.3rem;\n line-height: 1.5rem;\n}\n#output__table_1 {\n    margin-bottom:10px;\n}\n\n\n`\n\n\n\nexport default (props) => {\n\n    return (<ProbLinkagePage\n        define={define}\n        output_order={output_order}\n        post_frontmatter={frontmatter}\n        css={css_override}\n        current_path={props.path}\n    />)\n\n\n}\n"],"sourceRoot":""}