(self.webpackChunkgatsby_starter_hello_world=self.webpackChunkgatsby_starter_hello_world||[]).push([[976],{2465:function(e,t,n){"use strict";function a(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}n.d(t,{Z:function(){return a}})},1369:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});n(7294);var a=n(835),r=n(674),o=(n(5713),n(5444));var i={name:"mh6tuh",styles:"margin-top:1rem;margin-bottom:0.5rem;"},l={name:"gg4vpm",styles:"display:flex;justify-content:space-between;"},u=["/intro_to_probabilistic_linkage/","/maths_of_fellegi_sunter/","/visualising_fellegi_sunter/","/understanding_match_weights/","/match_weight_dependencies/","/m_u_generator/"],c=function(e){var t=e.current_path,n=u.indexOf(t),a=u[n-1],c=u[n+1];return a=void 0===a?(0,r.tZ)("div",null):(0,r.tZ)("div",null,(0,r.tZ)(o.rU,{to:a}," < Previous article")),c=void 0===c?(0,r.tZ)("div",null):(0,r.tZ)("div",null,(0,r.tZ)(o.rU,{to:c}," Next article >")),(0,r.tZ)("div",null,(0,r.tZ)("hr",{css:i}),(0,r.tZ)("div",{css:l},a,(0,r.tZ)("div",null,(0,r.tZ)(o.rU,{to:"/probabilistic_linkage"},"Probabilistic linkage home")),c))},s=n(8847),_=n(7414),m=n(6140);var f=function(e){var t=(0,r.tZ)(s.Z,{define:e.define,output_order:e.output_order});return(0,r.tZ)(a.Z,{css:e.className},(0,r.tZ)(m.Z,{title:e.post_frontmatter.title,description:e.post_frontmatter.description}),(0,r.tZ)(_.Z,{post_frontmatter:e.post_frontmatter}),t,(0,r.tZ)(c,{current_path:e.current_path}))}},7426:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return an},frontmatter:function(){return en}});n(7294);var a,r,o,i,l,u,c,s,_,m,f,d,b,p,v,h,g,y,w,x,k,q,j,Z,O,S,A,P,E=n(2465),C=n(6156),T=n(2137),M=n(7757),D=n.n(M);function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){(0,C.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function z(e){return e(a||(a=(0,E.Z)(['# Arquero\n\nArquero is a library for query processing and transformation of array-backed data tables. Following the [relational algebra](https://en.wikipedia.org/wiki/Relational_algebra) and inspired by the design of [dplyr](https://dplyr.tidyverse.org/), Arquero provides a fluent API for manipulating column-oriented data frames. Arquero supports a range of data transformation tasks, including filter, sample, aggregation, window, join, and reshaping operations. Arquero is Spanish for "archer": if datasets are [arrows](https://observablehq.com/@theneuralbit/introduction-to-apache-arrow), Arquero helps their aim stay true.'])))}function I(e){return e(r||(r=(0,E.Z)(["Import Arquero and extend it to print HTML tables in Observable:"])))}function W(e,t,n,a){return B.apply(this,arguments)}function B(){return(B=(0,T.Z)(D().mark((function e(t,n,a,r){var o;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("arquero@".concat(n));case 2:return o=e.sent,e.next=5,Promise.all(a.map((function(e){return t(e)})));case 5:return e.sent.forEach((function(e){return o.addPackage(e)})),o.addTableMethod("view",r,{override:!0}),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(){return"4.2.0"}function R(){return[]}function J(e){return e(o||(o=(0,E.Z)(["Export a global reference to Arquero operations:"])))}function N(e){return e.op}function V(e){return e(i||(i=(0,E.Z)(["To use the same setup in your own notebooks, add a cell with the following code:\n~~~ js\nimport { aq, op } from '@uwdata/arquero'\n~~~\n"])))}function U(e){return e(l||(l=(0,E.Z)(["To get started, see the [Introducing Arquero](https://observablehq.com/@uwdata/introducing-arquero) and [Arquero Cookbook](https://observablehq.com/@uwdata/arquero-cookbook) notebooks."])))}function G(e){return e(u||(u=(0,E.Z)(["To use Arquero outside of Observable, see [https://github.com/uwdata/arquero](https://github.com/uwdata/arquero)."])))}function $(e){return e(c||(c=(0,E.Z)(["<hr>\n## Examples\n\nThe core abstractions in Arquero are *data tables*, which model each column as an array of values, and *verbs* that transform data and return new tables. Verbs are table methods, allowing method chaining for multi-step transformations. Though each table is unique, many verbs reuse the underlying columns to limit duplication.\n"])))}function Y(e){return e(s||(s=(0,E.Z)(["Average hours of sunshine per month, from [https://usclimatedata.com/](https://usclimatedata.com/):"])))}function K(e){return e.table({Seattle:[69,108,178,207,253,268,312,281,221,142,72,52],Chicago:[135,136,187,215,281,311,318,283,226,193,113,106],"San Francisco":[165,182,251,281,314,330,300,272,267,243,189,156]})}function Q(e){return e(_||(_=(0,E.Z)(["Sorted differences between Seattle and Chicago:"])))}function X(e,t){return e.derive({month:function(e){return t.row_number()},diff:function(e){return e.Seattle-e.Chicago}}).select("month","diff").orderby("month").view({height:400})}function ee(e){return e(m||(m=(0,E.Z)(["Is Seattle more correlated with San Francisco or Chicago?"])))}function te(e,t){return e.rollup({corr_sf:t.corr("Seattle","San Francisco"),corr_chi:t.corr("Seattle","Chicago")}).view()}function ne(e){return e(f||(f=(0,E.Z)(["Summary statistics per city, as output objects:"])))}function ae(e,t,n){return e.fold(t.all(),{as:["city","sun"]}).groupby("city").rollup({min:function(e){return n.min(e.sun)},max:function(e){return n.max(e.sun)},avg:function(e){return n.average(e.sun)},med:function(e){return n.median(e.sun)},skew:function(e){var t=e.sun;return(n.mean(t)-n.median(t))/n.stdev(t)||0}}).objects()}function re(e){return e(d||(d=(0,E.Z)(["<hr>\n## Utilities\n"])))}function oe(e){var t=function(e){return'<span style="color: #999;">'.concat(e,"</span>")},n="margin: 0; border-collapse: collapse; width: initial;",a="padding: 1px 5px; white-space: nowrap; overflow-x: hidden; text-overflow: ellipsis; font-variant-numeric: tabular-nums;";return function(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"number"==typeof o&&(o={limit:o});var i=L({},o.color);if("function"==typeof o.color)r.columnNames().forEach((function(e){return i[e]=o.color}));else{var l=function(e){var t=i[e];i[e]="function"==typeof t?t:function(){return t}};for(var u in i)l(u)}var c="".concat(n),s=function(e,t,n){return"".concat(a," max-width: ").concat(+o.maxCellWidth||300,"px;")+(i[e]?" background-color: ".concat(i[e](t,n),";"):"")};o=L(L({limit:100,null:t},o),{},{style:{table:c,td:s,th:s}});var _="max-height: ".concat(+o.height||270,"px"),m="".concat(_,"; overflow-x: auto; overflow-y: auto;"),f=e(b||(b=(0,E.Z)(['<div style="','">',"</div>"])),m,r.toHTML(o));return f.value=r,f}}function ie(e,t){var n=e.module();return n.variable(t()).define(["md"],z),n.variable(t()).define(["md"],I),n.variable(t("aq")).define("aq",["require","aq_version","aq_packages","toView"],W),n.variable(t("aq_version")).define("aq_version",H),n.variable(t("aq_packages")).define("aq_packages",R),n.variable(t()).define(["md"],J),n.variable(t("op")).define("op",["aq"],N),n.variable(t()).define(["md"],V),n.variable(t()).define(["md"],U),n.variable(t()).define(["md"],G),n.variable(t()).define(["md"],$),n.variable(t()).define(["md"],Y),n.variable(t("dt")).define("dt",["aq"],K),n.variable(t()).define(["md"],Q),n.variable(t()).define(["dt","op"],X),n.variable(t()).define(["md"],ee),n.variable(t()).define(["dt","op"],te),n.variable(t()).define(["md"],ne),n.variable(t()).define(["dt","aq","op"],ae),n.variable(t()).define(["md"],re),n.variable(t("toView")).define("toView",["html"],oe),n}function le(e){return e(p||(p=(0,E.Z)(["# Fellegi Sunter utils"])))}function ue(){return[{uid:"1_l",fname:"John",sname:"Smith",dob:"1989-03-02",town:"Bristol"},{uid:"2_l",fname:"Tom",sname:"Hanks",dob:"1956-07-09",town:"Concord"},{uid:"3_l",fname:"David",sname:"Smith",dob:"1981-08-21",town:"London"}]}function ce(){return[{uid:"1_r",fname:"Jonathan",sname:"Smith",dob:"1989-03-02",town:"Bristol"},{uid:"2_r",fname:"David",sname:"Smith",dob:"1981-08-21",town:"Peckham"}]}function se(e,t){return e.from(t)}function _e(){return{proportion_of_matches:.01,comparison_columns:[{num_levels:3,col_name:"fname",u_probabilities:[.8,.2],m_probabilities:[.2,.8],case_expression:function(e){return e.fname_l==e.fname_r?1:0}},{num_levels:3,col_name:"sname",u_probabilities:[.9,.1],m_probabilities:[.2,.8],case_expression:function(e){return e.sname_l==e.sname_r?1:0}},{col_name:"dob",u_probabilities:[.99,.01],m_probabilities:[.2,.8],case_expression:function(e){return e.dob_l==e.dob_r?1:0}},{col_name:"town",u_probabilities:[.7,.3],m_probabilities:[.3,.7],case_expression:function(e){return e.town_l==e.town_r?1:0}}]}}function me(e,t,n){return e(t,n)}function fe(e){return e.view()}function de(e,t,n){return e(t,n)}function be(e){return e.view()}function pe(e,t,n,a){return e(t,n,a).view()}function ve(e,t){return function(n,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.objects().map((function(t){return t.match_probability=e(t,a,r),t})),i=t.from(o);return i=i.relocate(["match_probability"],{after:"uid_r"})}}function he(e,t){return function(n,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.comparison_columns,i=e(a.proportion_of_matches),l=o.reduce((function(e,t){var a="𝛾_"+t.col_name,o=n[a];if(-1==o)return e;var i=t.m_probabilities[o],l=t.u_probabilities[o],u=n[t.col_name+"_l"].toLowerCase(),c=n[t.col_name+"_r"].toLowerCase();if(u==c&&t.col_name in r){var s=r[t.col_name],_=s[u]||0,m=s[c]||0,f=Math.max(_,m);f>0&&(l=f)}return e+Math.log2(i/l)}),i);return t(l)}}function ge(e,t){return function(n,a,r){null==r&&(r=a.comparison_columns.length);var o=a.comparison_columns.slice(0,r),i=e(a.proportion_of_matches),l={comparison_vector:[],gamma_symbols:[],m_values:[],u_values:[],m_symbols:[],u_symbols:[],bayes_factors:[],log2_bayes_factors:[],col_names:[],match_probability:null,lam:a.proportion_of_matches};o.forEach((function(e){var t="𝛾_"+e.col_name,a=n[t],r=e.m_probabilities[a],o=e.u_probabilities[a],i=e.col_name.replace("_","\\_");l.comparison_vector.push(a),l.gamma_symbols.push("\\gamma_\\text{".concat(i,"}")),l.col_names.push(t),l.m_values.push(r),l.m_symbols.push("m_{\\text{".concat(i,"},").concat(a,"}")),l.u_values.push(o),l.u_symbols.push("u_{\\text{".concat(i,"},").concat(a,"}")),l.bayes_factors.push(r/o),l.log2_bayes_factors.push(Math.log2(r/o))}));var u=l.log2_bayes_factors.reduce((function(e,t){return e+t}),i);l.match_probability=t(u);var c=a.proportion_of_matches;return l.size_of_match_portion=c*l.m_values.reduce((function(e,t){return e*t}),1),l.size_of_non_match_portion=(1-c)*l.u_values.reduce((function(e,t){return e*t}),1),l}}function ye(e){return function(t,n,a){var r=e(t,n,a),o=r.m_values.map((function(e){return e.toPrecision(3)})),i=r.u_values.map((function(e){return e.toPrecision(3)})),l=r.lam.toPrecision(3),u=[l].concat(o),c=["(1 - ".concat(l,")")].concat(i),s=u.join(" \\times "),_=c.join(" \\times "),m=r.match_probability.toPrecision(3),f=r.size_of_match_portion.toPrecision(3),d=r.size_of_non_match_portion.toPrecision(3);return"\\frac{".concat(s,"}{(").concat(s,") + (").concat(_,")}  \\newline[10pt] = \\frac{").concat(f,"}{").concat(f," + ").concat(d,"}  \\newline[10pt] = ").concat(m)}}function we(e){return function(t,n){var a=e(t,n),r=a.m_symbols,o=a.u_symbols,i=(a.lam,["\\lambda"].concat(r)),l=["(1 - \\lambda)"].concat(o),u=i.join(" "),c=l.join(" ");return"\\frac{".concat(u,"}{").concat(u,") + ").concat(c,"}")}}function xe(e,t,n,a){return e(v||(v=(0,E.Z)(["","\n"])),t(n.objects()[0],a))}function ke(e){return function(t,n,a){var r=e(t,n,a),o=r.gamma_symbols.join(", "),i=r.comparison_vector.join(", ");return"\\bm{\\gamma} = [".concat(o,"]= [").concat(i,"]")}}function qe(e,t,n,a){return e(h||(h=(0,E.Z)(["","\n"])),t(n.objects()[0],a))}function je(e){return e(g||(g=(0,E.Z)(["\bm{gamma} = [gamma_\text{fname}, gamma_\text{sname}]"],["\\bm{\\gamma} = [\\gamma_\\text{fname}, \\gamma_\\text{sname}]"])))}function Ze(e,t,n,a){return e(y||(y=(0,E.Z)(["",""])),t(n.objects()[0],a))}function Oe(e,t,n){return e(t.objects()[0],n)}function Se(e){return function(t,n){var a=e.from(t),r=e.from(n),o=a.join(r,(function(e,t){return!0}),null,{suffix:["_l","_r"]}),i=a.columnNames(),l=[];return i.forEach((function(e){l.push(e+"_l"),l.push(e+"_r")})),o=o.select(l)}}function Ae(e){return function(t,n){var a=n.comparison_columns,r=t.objects();a.forEach((function(e){r.forEach((function(t){t["𝛾_"+e.col_name]=e.case_expression(t)}))})),r=e.from(r);var o=["uid_l","uid_r"];return a.forEach((function(e){o.push(e.col_name+"_l"),o.push(e.col_name+"_r"),o.push("𝛾_"+e.col_name)})),r=r.select(o)}}function Pe(){return function(e){return e/(e+1)}}function Ee(e){return function(t){return e(Math.pow(2,t))}}function Ce(){return function(e){return e/(1-e)}}function Te(e){return function(t){return Math.log2(e(t))}}function Me(e){return e.csv("https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv",e.autoType).then((function(e){var t={};return e.forEach((function(e){t[e.firstname]=e.freq})),t}))}function De(e){return e.csv("https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/last_name.csv",e.autoType).then((function(e){var t={};return e.forEach((function(e){t[e.surname]=e.freq})),t}))}function Fe(e,t){return{fname:e,sname:t}}function Le(e){return e.fname.joshua}function ze(e){return e.sname.linacre}function Ie(e,t){var n=e.module();n.variable(t()).define(["md"],le),n.variable(t("records_l")).define("records_l",ue),n.variable(t("records_r")).define("records_r",ce),n.variable(t("df_r")).define("df_r",["aq","records_r"],se),n.variable(t("splink_settings")).define("splink_settings",_e),n.variable(t("df_comparison")).define("df_comparison",["get_df_comparison","records_l","records_r"],me),n.variable(t()).define(["df_comparison"],fe),n.variable(t("df_gammas")).define("df_gammas",["get_df_gammas","df_comparison","splink_settings"],de),n.variable(t()).define(["df_gammas"],be),n.variable(t()).define(["get_df_e","df_gammas","splink_settings","term_freqs"],pe),n.variable(t("get_df_e")).define("get_df_e",["get_match_probability","aq"],ve),n.variable(t("get_match_probability")).define("get_match_probability",["prob_to_log2_bf","log2_bf_to_prob"],he),n.variable(t("get_match_probability_components")).define("get_match_probability_components",["prob_to_log2_bf","log2_bf_to_prob"],ge),n.variable(t("get_m_u_formula_numbers")).define("get_m_u_formula_numbers",["get_match_probability_components"],ye),n.variable(t("get_m_u_formula_symbols")).define("get_m_u_formula_symbols",["get_match_probability_components"],we),n.variable(t()).define(["tex","get_m_u_formula_symbols","df_gammas","splink_settings"],xe),n.variable(t("get_comparison_vector_symbols_and_numbers")).define("get_comparison_vector_symbols_and_numbers",["get_match_probability_components"],ke),n.variable(t()).define(["tex","get_comparison_vector_symbols_and_numbers","df_gammas","splink_settings"],qe),n.variable(t()).define(["tex"],je),n.variable(t()).define(["tex","get_m_u_formula_numbers","df_gammas","splink_settings"],Ze),n.variable(t()).define(["get_match_probability_components","df_gammas","splink_settings"],Oe),n.variable(t("get_df_comparison")).define("get_df_comparison",["aq"],Se),n.variable(t("get_df_gammas")).define("get_df_gammas",["aq"],Ae),n.variable(t("bayes_factor_to_prob")).define("bayes_factor_to_prob",Pe),n.variable(t("log2_bf_to_prob")).define("log2_bf_to_prob",["bayes_factor_to_prob"],Ee),n.variable(t("prob_to_bayes_factor")).define("prob_to_bayes_factor",Ce),n.variable(t("prob_to_log2_bf")).define("prob_to_log2_bf",["prob_to_bayes_factor"],Te);var a=e.module(ie);return n.import("aq",a),n.import("op",a),n.variable(t("first_name_lookup")).define("first_name_lookup",["d3"],Me),n.variable(t("surname_lookup")).define("surname_lookup",["d3"],De),n.variable(t("term_freqs")).define("term_freqs",["first_name_lookup","surname_lookup"],Fe),n.variable(t()).define(["term_freqs"],Le),n.variable(t()).define(["term_freqs"],ze),n}function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(Object(n),!0).forEach((function(t){(0,C.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function He(e){return e(w||(w=(0,E.Z)(["# Waterfall chart"])))}function Re(e){return e(x||(x=(0,E.Z)(["### Objective\n\nTake \n- a Splink settings object \n- A row of data from `df_e`\nAnd turn it into the data needed for the waterfall chart.\n\n"],["### Objective\n\nTake \n- a Splink settings object \n- A row of data from \\`df_e\\`\nAnd turn it into the data needed for the waterfall chart.\n\n"])))}function Je(e){return e(k||(k=(0,E.Z)(["## Example"])))}function Ne(){return{proportion_of_matches:.01,comparison_columns:[{num_levels:3,col_name:"first_name",u_probabilities:[.8,.2],m_probabilities:[.2,.8]},{num_levels:3,col_name:"surname",u_probabilities:[.8,.2],m_probabilities:[.2,.8]},{col_name:"date_of_birth",u_probabilities:[.99,.01],m_probabilities:[.2,.8]}]}}function Ve(){var e;return e={first_name_l:"John",first_name_r:"John","𝛾_first_name":1,surname_l:"Smith",surname_r:"Smith","𝛾_surname":1,date_of_birth_l:"1992-04-01"},(0,C.Z)(e,"date_of_birth_l","1992-04-02"),(0,C.Z)(e,"𝛾_date_of_birth",0),(0,C.Z)(e,"other","hi"),e}function Ue(){return{height:200}}function Ge(e,t,n,a){return e(t,n,a,!0)}function $e(e,t,n,a){return e(t,n,a,!1)}function Ye(e){return e(q||(q=(0,E.Z)(["## Code"])))}function Ke(e,t,n){return function(a,r,o,i){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},u=e(a,r,l);return t(n(u,o,i))}}function Qe(){return function(e){var t={};return e.comparison_columns.forEach((function(e){var n=e.col_name;t[n]=e})),t}}function Xe(e,t,n){return function(a,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=e(r),l=t(a,r,o),u=[i].concat(l),c=n(r),s=u.reduce((function(e,t){return e+t.log2_bayes_factor}),0);return c.bayes_factor=Math.pow(2,s),c.log2_bayes_factor=s,u.concat([c])}}function et(e,t){return function(n,a,r,o){var i,l,u=n,c=a[u],s=u.replace("𝛾_",""),_=e(r)[s],m=a[s+"_l"],f=a[s+"_r"];-1==c?(i=.5,l=.5):(i=_.u_probabilities[c],l=_.m_probabilities[c],m==f&&s in o&&(i=o[s][m]||i));var d=l/i;return{bayes_factor:d,column_name:s,gamma_column_name:"𝛾_"+s,gamma_index:c,level_name:"level_"+c,log2_bayes_factor:t(d),m_probability:l,num_levels:null,u_probability:i,value_l:m,value_r:f}}}function tt(e,t){return function(n){return{bayes_factor:e(n.proportion_of_matches),column_name:"Prior",gamma_column_name:"",gamma_index:"",level_name:null,log2_bayes_factor:t(n.proportion_of_matches),m_probability:null,num_levels:null,u_probability:null,value_l:"",value_r:""}}}function nt(e){return function(t,n,a){var r=Object.keys(t);return(r=r.filter((function(e){return e.includes("𝛾_")}))).map((function(r){return e(r,t,n,a)}))}}function at(){return function(e){return{bayes_factor:null,column_name:"Final score",gamma_column_name:"",gamma_index:"",level_name:null,log2_bayes_factor:null,m_probability:null,num_levels:null,u_probability:null,value_l:"",value_r:""}}}function rt(e){return function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=JSON.parse(JSON.stringify(e));r.data.values=t;var o=Be(Be({},r),n);if(a){o.layer[1].encoding.y.axis=!1,o.layer[0].layer[2].encoding.text={type:"nominal",field:"up_down_emoji"},o.layer[0].layer[2].encoding.opacity={condition:{value:0,test:"datum.column_name == 'Final score' || datum.column_name == 'Prior'"}};var i="format(1 / (1 + pow(2, -1*datum.value)), '.2r')";o.layer[0].layer[1].encoding.y.axis.labelExpr=i,o.layer[0].layer[1].encoding.y.axis.title="probability",o.layer[0].layer[1].encoding.tooltip=[{type:"quantitative",field:"prob",format:".3r",title:"Cumulative match probability"}]}return o}}function ot(){return{config:{view:{continuousHeight:300,continuousWidth:400}},title:{text:"Bayes factor intuition chart",subtitle:"How each comparison column contributes to the final match score"},transform:[{filter:"(datum.bayes_factor !== 1.0)"},{window:[{op:"sum",field:"log2_bayes_factor",as:"sum"},{op:"lead",field:"column_name",as:"lead"}],frame:[null,0]},{calculate:'datum.column_name === "Final score" ? datum.sum - datum.log2_bayes_factor : datum.sum',as:"sum"},{calculate:"datum.lead === null ? datum.column_name : datum.lead",as:"lead"},{calculate:'datum.column_name === "Final score" || datum.column_name === "Prior lambda" ? 0 : datum.sum - datum.log2_bayes_factor',as:"previous_sum"},{calculate:'datum.sum > datum.previous_sum ? datum.column_name : ""',as:"top_label"},{calculate:'datum.sum < datum.previous_sum ? datum.column_name : ""',as:"bottom_label"},{calculate:"datum.sum > datum.previous_sum ? datum.sum : datum.previous_sum",as:"sum_top"},{calculate:"datum.sum < datum.previous_sum ? datum.sum : datum.previous_sum",as:"sum_bottom"},{calculate:"(datum.sum + datum.previous_sum) / 2",as:"center"},{calculate:'(datum.log2_bayes_factor > 0 ? "+" : "") + datum.log2_bayes_factor',as:"text_log2_bayes_factor"},{calculate:"datum.sum < datum.previous_sum ? 4 : -4",as:"dy"},{calculate:'datum.sum < datum.previous_sum ? "top" : "bottom"',as:"baseline"},{calculate:"1. / (1 + pow(2, -1.*datum.sum))",as:"prob"},{calculate:"0*datum.sum",as:"zero"},{calculate:'datum.sum > datum.previous_sum ? "↑" : "↓"',as:"up_down_emoji"}],layer:[{layer:[{mark:"rule",encoding:{y:{field:"zero",type:"quantitative"},size:{value:.5},color:{value:"black"}}},{mark:{type:"bar",width:60},encoding:{color:{condition:{value:"red",test:"(datum.log2_bayes_factor < 0)"},value:"green"},opacity:{condition:{value:1,test:"datum.column_name == 'Prior' || datum.column_name == 'Final score'"},value:.5},tooltip:[{type:"nominal",field:"column_name",title:"Comparison column"},{type:"nominal",field:"value_l",title:"Value (L)"},{type:"nominal",field:"value_r",title:"Value (R)"},{type:"nominal",field:"gamma_index",title:"Gamma level"},{type:"quantitative",field:"bayes_factor",format:".3r",title:"Bayes factor"},{type:"quantitative",field:"log2_bayes_factor",format:".3r",title:"log2(Bayes factor)"},{type:"quantitative",field:"prob",format:".3r",title:"Cumulative match probability"}],x:{type:"nominal",axis:{labelExpr:"datum.value == 'Prior' || datum.value == 'Final score' ? '' : datum.value",labelAlign:"center",labelPadding:10,title:"Column",grid:!0,tickBand:"extent"},field:"column_name",sort:null},y:{type:"quantitative",axis:{grid:!1,orient:"left",title:"log2(Bayes factor)"},field:"previous_sum"},y2:{field:"sum"}}},{mark:{type:"text",fontWeight:"bold"},encoding:{color:{value:"white"},text:{condition:{type:"nominal",field:"log2_bayes_factor",format:".2f",test:"abs(datum.log2_bayes_factor) > 1"},value:""},x:{type:"nominal",axis:{labelAngle:0,title:"Column"},field:"column_name",sort:null},y:{type:"quantitative",axis:{orient:"left"},field:"center"}}},{mark:{type:"text",baseline:"bottom",dy:-5,fontWeight:"bold"},encoding:{color:{value:"black"},text:{condition:{type:"nominal",field:"top_label",test:"abs(datum.log2_bayes_factor) > 1"},value:""},x:{type:"nominal",axis:{labelAngle:0,title:"Column"},field:"column_name",sort:null},y:{type:"quantitative",field:"sum_top"}}},{mark:{type:"text",baseline:"top",dy:5,fontWeight:"bold"},encoding:{color:{value:"black"},text:{condition:{type:"nominal",field:"bottom_label",test:"abs(datum.log2_bayes_factor) > 1"},value:""},x:{type:"nominal",axis:{labelAngle:0,title:"Column"},field:"column_name",sort:null},y:{type:"quantitative",field:"sum_bottom"}}}]},{mark:{type:"rule",color:"black",strokeWidth:2,x2Offset:30,xOffset:-30},encoding:{x:{type:"nominal",axis:{labelAngle:0,title:"Column"},field:"column_name",sort:null},x2:{field:"lead"},y:{type:"quantitative",axis:{labelExpr:"format(1 / (1 + pow(2, -1*datum.value)), '.2r')",orient:"right",title:"Probability"},field:"sum",scale:{zero:!1}}}}],height:450,resolve:{axis:{y:"independent"}},width:{step:75},$schema:"https://vega.github.io/schema/vega-lite/v4.8.1.json",data:{values:null}}}function it(e){return e("vega-embed@6")}function lt(){return function(e){return e/(e+1)}}function ut(){return Math.log2}function ct(){return function(e){return e/(1-e)}}function st(e,t){return function(n){return e(t(n))}}function _t(e){return function(t){return e(Math.pow(2,t))}}function mt(e){return e.csv("https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv",e.autoType).then((function(e){var t={};return e.forEach((function(e){t[e.firstname]=e.freq})),t}))}function ft(e){return{first_name:e}}function dt(e,t){var n=e.module();return n.variable(t()).define(["md"],He),n.variable(t()).define(["md"],Re),n.variable(t()).define(["md"],Je),n.variable(t("splink_settings")).define("splink_settings",Ne),n.variable(t("row")).define("row",Ve),n.variable(t("overrides")).define("overrides",Ue),n.variable(t()).define(["get_waterfall_chart","row","splink_settings","overrides"],Ge),n.variable(t()).define(["get_waterfall_chart","row","splink_settings","overrides"],$e),n.variable(t()).define(["md"],Ye),n.variable(t("get_waterfall_chart")).define("get_waterfall_chart",["get_waterfall_chart_data","embed","get_chart_spec"],Ke),n.variable(t("get_comparison_column_lookup")).define("get_comparison_column_lookup",Qe),n.variable(t("get_waterfall_chart_data")).define("get_waterfall_chart_data",["get_waterfall_data_lambda_row","get_waterfall_data_other_rows","get_waterfall_data_final_row"],Xe),n.variable(t("get_waterfall_row_gamma")).define("get_waterfall_row_gamma",["get_comparison_column_lookup","log2"],et),n.variable(t("get_waterfall_data_lambda_row")).define("get_waterfall_data_lambda_row",["prob_to_bayes_factor","prob_to_log2_bayes_factor"],tt),n.variable(t("get_waterfall_data_other_rows")).define("get_waterfall_data_other_rows",["get_waterfall_row_gamma"],nt),n.variable(t("get_waterfall_data_final_row")).define("get_waterfall_data_final_row",at),n.variable(t("get_chart_spec")).define("get_chart_spec",["base_spec"],rt),n.variable(t("base_spec")).define("base_spec",ot),n.variable(t("embed")).define("embed",["require"],it),n.variable(t("bayes_factor_to_prob")).define("bayes_factor_to_prob",lt),n.variable(t("log2")).define("log2",ut),n.variable(t("prob_to_bayes_factor")).define("prob_to_bayes_factor",ct),n.variable(t("prob_to_log2_bayes_factor")).define("prob_to_log2_bayes_factor",["log2","prob_to_bayes_factor"],st),n.variable(t("log2_bayes_factor_to_prob")).define("log2_bayes_factor_to_prob",["bayes_factor_to_prob"],_t),n.variable(t("first_name_lookup")).define("first_name_lookup",["d3"],mt),n.variable(t("term_freqs")).define("term_freqs",["first_name_lookup"],ft),n}function bt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}function pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function vt(e){return e(j||(j=(0,E.Z)(["# Interactive probabilistic record linkage model"])))}function ht(e){return e(Z||(Z=(0,E.Z)(["*A final version of this notebook can be viewed on my blog [here](https://www.robinlinacre.com/interactive_fellegi_sunter/).*"])))}function gt(e){return e(O||(O=(0,E.Z)(['Here we use a trained Fellegi-Sunter model to calculate match probabilities interactively.  \n\n✨<span style="background-color:yellow">You can edit the records in the table, and the match probability will be estimated.</span>✨'])))}function yt(e){return e(S||(S=(0,E.Z)(['\n<table id="data-table" >\n\n<tr>\n\n<th>First name</th>\n<th>Middle name</th>\n<th>Surname</th>\n<th>DOB</th>\n<th>Postcode</th>\n\n</tr>\n<tr contenteditable>\n\n<td>Mary</td>\n<td>Emma</td>\n<td>Smith</td>\n<td>1990-05-09</td>\n<td>SW1A 1AA</td>\n\n</tr>\n<tr contenteditable>\n\n<td>Mary</td>\n<td>Emma</td>\n<td>Smith</td>\n<td>1990-05-09</td>\n<td>SW1A 1AA</td>\n</tr>\n\n</table>\n'])))}function wt(e,t){return e(A||(A=(0,E.Z)(['<h3 style="font-family:Helvetica,Arial,Sans-Serif">Estimated match probability = <span style="background-color:yellow">',"%</h3>"])),t)}function xt(e){return e(P||(P=(0,E.Z)(["The charts shows how the match probability was calculated:"])))}function kt(e){return e.toggle({label:"Show details in waterfall chart"})}function qt(e,t,n,a,r,o){return e(t.objects()[0],n,a,!r,o)}function jt(e,t,n,a){return(100*e(t.objects()[0],n,a)).toPrecision(4)}function Zt(e,t,n){return e.observe((function(e){var a=function(a){return e(t(n))};return n.addEventListener("input",a,!1),e(t(n)),function(){return window.removeEventListener("input",a)}}))}function Ot(){return function(e){var t=[];return e.querySelectorAll("tr").forEach((function(e,n){var a,r=[],o=bt(e.cells);try{for(o.s();!(a=o.n()).done;){var i=a.value.innerText;""==(i=(i=i.trim()).toLowerCase())&&(i=null),r.push(i)}}catch(l){o.e(l)}finally{o.f()}t.push(r)})),t.reduce((function(e,t,n){if(0==n)e.properties=t;else{var a={};a.uid=n,e.properties.forEach((function(e,n){a[e]=t[n]})),e.push(a)}return e}),[])}}function St(e,t,n){return e(t,n)}function At(e,t,n){return e(t,n)}function Pt(e,t,n){return e(t,n)}function Et(e,t){return[e(t[0])]}function Ct(e,t){return[e(t[1])]}function Tt(){return function(e){return{uid:e.uid,fname:e["first name"],mname:e["middle name"],sname:e.surname,dob:e.dob,pc:e.postcode}}}function Mt(e,t){return function(n){return null===n.fname_l||null===n.fname_r?-1:n.fname_l==n.fname_r?3:e(n.fname_l,n.fname_r)?2:t(n.fname_l,n.fname_r)>.85?1:0}}function Dt(e,t){return function(n){return null===n.mname_l||null===n.mname_r?-1:n.mname_l==n.mname_r?3:e(n.mname_l,n.mname_r)?2:t(n.mname_l,n.mname_r)>.85?1:0}}function Ft(e,t){return function(n){return null===n.sname_l||null===n.sname_r?-1:n.sname_l==n.sname_r?3:e(n.sname_l,n.sname_r)?2:t(n.sname_l,n.sname_r)>.85?1:0}}function Lt(){return function(e,t){var n=new Date(e),a=new Date(t);return Math.abs(n-a)/31536e6}}function zt(e,t){return function(n){return null===n.dob_l||null===n.dob_r?-1:n.dob_l==n.dob_r&&"01-01"==n.dob_l.slice(-5)?4:n.dob_l==n.dob_r?5:e(n.dob_l,n.dob_r)<=1?3:t(n.dob_l,n.dob_r)<1?2:t(n.dob_l,n.dob_r)<10?1:0}}function It(){return function(e){return null===e.pc_l||null===e.pc_r?-1:e.pc_l==e.pc_r?5:e.pc_l.slice(0,3)==e.pc_r.slice(0,3)?4:0}}function Wt(e,t,n,a,r){return{proportion_of_matches:1/6e7,comparison_columns:[{num_levels:4,col_name:"fname",u_probabilities:[.9883897757902356,.004639565877697178,.002783859108435161,.004186799223632191],m_probabilities:[.013910835049471115,.03580070792581899,.0026304325373041827,.9431284756772805],case_expression:e},{num_levels:4,col_name:"mname",u_probabilities:[.9883897757902356,.004639565877697178,.002783859108435161,.004186799223632191],m_probabilities:[.013910835049471115,.03580070792581899,.0026304325373041827,.9431284756772805],case_expression:t},{num_levels:4,col_name:"sname",u_probabilities:[.9971958658858057,.0015765242689686637,.0003754879678726784,.0008521218773530913],m_probabilities:[.01809857679375992,.02769695651313621,.0014468181425986496,.9514336326024172],case_expression:n},{col_name:"dob",u_probabilities:[.2807916467157474,.20073737664045227,.5164828418823143,.0019211842885877536,9.766061108210657e-7,6597386678746452e-20],m_probabilities:[.00024675771766021674,.0017179728285089994,.009868620663422667,.023118927215599792,.0036827860949234354,.9571689718277999],case_expression:a},{col_name:"pc",u_probabilities:[.6751190264364737,.22792766449447727,.09517523421356786,17091033037790942e-22,.0017755009047047013,8.648474727307328e-7],m_probabilities:[.18962646163517627,.02145498887358967,.4023991769621992,.11064711462002584,.07144100324386156,.20090472079462598],case_expression:r}]}}function Bt(){return{title:{text:"Match weights and their cumulative contribution to match probability",subtitle:""},height:200}}function Ht(e){return e("https://bundle.run/double-metaphone@2.0.0")}function Rt(e){return e("jaro-winkler@0.2.8/index.js")}function Jt(e){return function(t,n){var a=e.doubleMetaphone(t),r=e.doubleMetaphone(n);return a.filter((function(e){return r.includes(e)})).length>0}}function Nt(e){return e.csv("https://gist.githubusercontent.com/RobinL/66df3f5d7dbea3d1add1a8e6067c7624/raw/d4d642e631563418e7b7889496c7a9149f259447/firstname_noyear_count2.csv",e.autoType).then((function(e){var t={};return e.forEach((function(e){t[e.firstname]=e.freq})),t}))}function Vt(e){return e.csv("https://gist.githubusercontent.com/RobinL/3fe7f712ff93393fe0a28cbb1b8c3e46/raw/a87f572e194122dde4743dd905c1ce6c22fd33db/surname_noyear_count2.csv",e.autoType).then((function(e){var t={};return e.forEach((function(e){t[e.surname]=e.freq})),t}))}function Ut(e,t){return{fname:e,mname:e,sname:t}}function Gt(){return function(e,t){if(0==e.length)return t.length;if(0==t.length)return e.length;var n,a,r=[];for(n=0;n<=t.length;n++)r[n]=[n];for(a=0;a<=e.length;a++)r[0][a]=a;for(n=1;n<=t.length;n++)for(a=1;a<=e.length;a++)t.charAt(n-1)==e.charAt(a-1)?r[n][a]=r[n-1][a-1]:r[n][a]=Math.min(r[n-1][a-1]+1,Math.min(r[n][a-1]+1,r[n-1][a]+1));return r[t.length][e.length]}}function $t(e){return e("d3@6")}function Yt(e){return e("@observablehq/inputs")}function Kt(e,t){var n=e.module();n.variable(t("title")).define("title",["md"],vt),n.variable(t()).define(["md"],ht),n.variable(t("para_1")).define("para_1",["md"],gt),n.variable(t("table")).define("table",["html"],yt),n.variable(t("estimated_probability")).define("estimated_probability",["html","match_prob"],wt),n.variable(t("para_2")).define("para_2",["md"],xt),n.variable(t("viewof show_complex")).define("viewof show_complex",["inputs"],kt),n.variable(t("show_complex")).define("show_complex",["Generators","viewof show_complex"],(function(e,t){return e.input(t)})),n.variable(t("waterfall_chart")).define("waterfall_chart",["get_waterfall_chart","df_gammas","splink_settings","overrides","show_complex","term_freqs"],qt),n.variable(t("match_prob")).define("match_prob",["get_match_probability","df_gammas","splink_settings","term_freqs"],jt),n.variable(t("tableData")).define("tableData",["Generators","parseTableData","table"],Zt),n.variable(t("parseTableData")).define("parseTableData",Ot);var a=e.module(Ie);n.import("get_df_gammas",a),n.import("get_df_e",a),n.import("get_df_comparison",a),n.import("get_match_probability",a),n.variable(t("df_e")).define("df_e",["get_df_e","df_gammas","splink_settings"],St),n.variable(t("df_gammas")).define("df_gammas",["get_df_gammas","df_comparison","splink_settings"],At),n.variable(t("df_comparison")).define("df_comparison",["get_df_comparison","records_l","records_r"],Pt),n.variable(t("records_l")).define("records_l",["rename_dict_keys","tableData"],Et),n.variable(t("records_r")).define("records_r",["rename_dict_keys","tableData"],Ct),n.variable(t("rename_dict_keys")).define("rename_dict_keys",Tt),n.variable(t("fname_case_stmt")).define("fname_case_stmt",["dm_intersect","distance"],Mt),n.variable(t("mname_case_stmt")).define("mname_case_stmt",["dm_intersect","distance"],Dt),n.variable(t("sname_case_stmt")).define("sname_case_stmt",["dm_intersect","distance"],Ft),n.variable(t("abs_date_diff_in_years")).define("abs_date_diff_in_years",Lt),n.variable(t("dob_case_stmt")).define("dob_case_stmt",["levenshtein","abs_date_diff_in_years"],zt),n.variable(t("pc_case_stmt")).define("pc_case_stmt",It),n.variable(t("splink_settings")).define("splink_settings",["fname_case_stmt","mname_case_stmt","sname_case_stmt","dob_case_stmt","pc_case_stmt"],Wt),n.variable(t("overrides")).define("overrides",Bt);var r=e.module(dt);return n.import("get_waterfall_chart",r),n.variable(t("dm")).define("dm",["require"],Ht),n.variable(t("distance")).define("distance",["require"],Rt),n.variable(t("dm_intersect")).define("dm_intersect",["dm"],Jt),n.variable(t("first_name_lookup")).define("first_name_lookup",["d3"],Nt),n.variable(t("surname_lookup")).define("surname_lookup",["d3"],Vt),n.variable(t("term_freqs")).define("term_freqs",["first_name_lookup","surname_lookup"],Ut),n.variable(t("levenshtein")).define("levenshtein",Gt),n.variable(t("d3")).define("d3",["require"],$t),n.variable(t("inputs")).define("inputs",["require"],Yt),n}var Qt=n(1369),Xt=n(674);var en={title:"Interactive probabilistic record linkage model",post_date:"2021-05-17",code_url:"https://observablehq.com/@robinl/9534e8e74053c14e",post_type:"obs",post_category:"probabilistic_linkage",description:"A live, interactive, explorable probabilistic record linkage (Fellegi Sunter) model"},tn=["title","para_1","table","estimated_probability","para_2","viewof show_complex","waterfall_chart"],nn={name:"lst669",styles:"margin-left:auto;margin-right:auto;width:90%;max-width:800px;table{font-size:1.3rem;line-height:1.5rem;}#output__table_1{margin-bottom:10px;}"},an=function(e){return(0,Xt.tZ)(Qt.Z,{define:Kt,output_order:tn,post_frontmatter:en,css:nn,current_path:e.path})}}}]);
//# sourceMappingURL=component---src-pages-interactive-fellegi-sunter-jsx-60cdab99156b1b8240df.js.map