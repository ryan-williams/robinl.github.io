(self.webpackChunkgatsby_starter_hello_world=self.webpackChunkgatsby_starter_hello_world||[]).push([[948],{2465:function(e,n,t){"use strict";function a(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}t.d(n,{Z:function(){return a}})},1369:function(e,n,t){"use strict";t.d(n,{Z:function(){return f}});t(7294);var a=t(835),r=t(674),o=(t(5713),t(5444));var i={name:"mh6tuh",styles:"margin-top:1rem;margin-bottom:0.5rem;"},l={name:"gg4vpm",styles:"display:flex;justify-content:space-between;"},s=["/intro_to_probabilistic_linkage/","/maths_of_fellegi_sunter/","/visualising_fellegi_sunter/","/understanding_match_weights/","/match_weight_dependencies/","/m_u_generator/"],m=function(e){var n=e.current_path,t=s.indexOf(n),a=s[t-1],m=s[t+1];return a=void 0===a?(0,r.tZ)("div",null):(0,r.tZ)("div",null,(0,r.tZ)(o.rU,{to:a}," < Previous article")),m=void 0===m?(0,r.tZ)("div",null):(0,r.tZ)("div",null,(0,r.tZ)(o.rU,{to:m}," Next article >")),(0,r.tZ)("div",null,(0,r.tZ)("hr",{css:i}),(0,r.tZ)("div",{css:l},a,(0,r.tZ)("div",null,(0,r.tZ)(o.rU,{to:"/probabilistic_linkage"},"Probabilistic linkage home")),m))},c=t(8847),u=t(7414),_=t(6140);var f=function(e){var n=(0,r.tZ)(c.Z,{define:e.define,output_order:e.output_order});return(0,r.tZ)(a.Z,{css:e.className},(0,r.tZ)(_.Z,{title:e.post_frontmatter.title,description:e.post_frontmatter.description}),(0,r.tZ)(u.Z,{post_frontmatter:e.post_frontmatter}),n,(0,r.tZ)(m,{current_path:e.current_path}))}},2857:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Ia},frontmatter:function(){return Wa}});t(7294);var a,r,o,i,l,s=t(6156),m=t(2465);function c(e){return e(a||(a=(0,m.Z)(["# Treemap for Bayes Intuition"])))}function u(e,n){return e.textarea({value:n,rows:29})}function _(e,n){var t=e.comparison_columns.length;return n.range([0,t],{step:1,label:"How many columns to take account of?"})}function f(e){return e(r||(r=(0,m.Z)(["In the following diagram, the outermost rectangle represents the space all pairwise record comparisons.  \n\nThis can then be recursively split into subsets, beginning with spliting between record pairs that match and those that do not match, then further splitting these rectangles based on comparisons of the values in columns.\n"])))}function d(e,n,t){return e(n,t,600)}function b(e,n,t,a,r,i,l){return function(s,c,u){var _=e(s),f=n(_,u),d=t(o||(o=(0,m.Z)(['<div class="treemap_container">']))),b=a.select(d).append("div").attr("class","svg-tooltip").style("position","absolute").style("display","inline-block").style("visibility","hidden").attr("pointer-events","none"),p=a.select(d).append("svg").attr("height",u).attr("width",r),h=a.filter(f,(function(e){return e.depth<=c+1}));h=a.group(h,(function(e){return e.height}));var v=p.selectAll("g").data(h).join("g").selectAll("g").data((function(e){return e[1]})).join("g").attr("transform",(function(e){return"translate(".concat(e.x0,",").concat(e.y0,")")}));return v.append("rect").attr("id",(function(e){return(e.nodeUid=i.uid("node")).id})).attr("width",(function(e){return e.x1-e.x0})).attr("height",(function(e){return e.y1-e.y0})).attr("stroke-width","1px").attr("stroke","black").attr("fill",(function(e){if(e.depth==c+1)return a.rgb(e.data.colour);var n=a.rgb(e.data.colour);return"#ffffff"!=n.hex()&&(1==e.depth?n.opacity=.3:n.opacity=0),n})),v.append("foreignObject").attr("pointer-events","none").attr("width",(function(e){return e.x1-e.x0})).attr("height",(function(e){return e.y1-e.y0})).attr("xmlns","http://www.w3.org/1999/xhtml").append("xhtml:div").attr("class","wrap-info").append("div").html((function(e){return l(e,c)})),v.filter((function(e){return e.children})).selectAll("tspan").attr("dx",3).attr("y",13),v.filter((function(e){return!e.children})).selectAll("tspan").attr("x",3).attr("y",(function(e,n,t){return"".concat(.3*(n===t.length-1)+1.1+.9*n,"em")})),p.selectAll("rect").on("mouseover",(function(e){return b.style("visibility","visible")})).on("mousemove",(function(e){var n,t,o=a.select(this).datum(),i=l(o,c);b.html(i);b.node().getBoundingClientRect().height;var s=b.node().getBoundingClientRect().width;n=e.offsetY+10+"px",t=r-e.layerX>s?e.offsetX+10+"px":e.offsetX-s-10+"px";var m="visible";return""==i&&(m="hidden"),b.style("top",n).style("left",t).style("visibility",m)})).on("click",(function(e){console.log("height: ".concat(u)),console.log("event.layerY: ".concat(e.layerY))})).on("mouseout",(function(){return b.style("visibility","hidden")})),d}}function p(e){return function n(t,a,r){if("children"in t)t.children.forEach((function(e){n(e,a,r)}));else{var o=e(a,t,r);t.children=o}delete t.value}}function h(e,n,t){return function(a,r,o){var i,l,s=[];return o?(i=a.m_probabilities,l=e):(i=a.u_probabilities,l=n),i.forEach((function(e,n){var o="gamma_"+a.col_name+" = "+n,i={name:o,name_list:r.name_list.concat(o),value:r.value*e,prob:e,prob_list:r.prob_list.concat(e)};a.gamma_value==n&&r.colour==l?i.colour=l:i.colour=t.rgb(255,255,255),s.push(i)})),s}}function v(e,n,t,a){return function(r){var o=r.proportion_of_matches,i={name:"All comparisons",name_list:[],prob_list:[],prob:1,colour:e.rgb(255,255,255),children:[{name:"matches",name_list:["match"],prob_list:[o],prob:o,value:o,colour:n},{name:"non-match",name_list:["non-match"],prob_list:[1-o],prob:1-o,value:1-o,colour:t}]},l=i.children[0],s=i.children[1];return r.comparison_columns.forEach((function(e,n){a(l,e,!0),a(s,e,!1)})),i}}function g(e,n){return function(t,a){var r=t.data.name_list,o=t.data.prob_list,l=r.map((function(e,n){return[e,o[n]]})).map((function(n){return"<p>".concat(n[0]," (").concat(e(n[1]),")")})).join(" and "),s=o.reduce((function(e,n){return e*n}),1);l+="<p>Proportion of all comparisons: ".concat(e(s));var c=n(i||(i=(0,m.Z)(["",""])),l);return t.depth==a+1?c.innerHTML:""}}function w(e){return JSON.parse(e)}function y(e){return e(l||(l=(0,m.Z)(["\n<style>\n.wrap-info {\n  padding: 5px;\n  font-family: monospace;\n  font-size: 0.6em;\n  line-height: 1.3em;\n}\n.wrap-info p {\n  margin-top: 0px;\n  margin-bottom: 0.1rem;\n  \n}\ntextarea {\n    max-height: 1000em !important\n}\n\n.svg-tooltip {\n\n    background: rgba(69,77,93,.9);\n    border-radius: .1rem;\n    color: #fff;\n    display: inline-block;\n    max-width: 500px;\n    padding: .2rem .4rem;\n    position: absolute;\n    text-overflow: ellipsis;\n    white-space: pre;\n    z-index: 300;\n    visibility: hidden;\n  }\n\n.svg-tooltip p {\nfont-family: sans-serif;\n    padding: 0;\n    margin: 0.2rem;\n      font-size: 0.8em;\n    line-height: 1.0em;\n  }\n</style>"])))}function x(e,n){return function(t,a){return e.treemap().tile(e.treemapSquarify).size([n,a]).paddingOuter(5).paddingTop(5).paddingInner(5).round(!0)(e.hierarchy(t).sum((function(e){return e.value})).sort((function(e,n){return n.value-e.value})))}}function Z(){return'{\n    "proportion_of_matches": 0.4,\n    "comparison_columns": [\n        {\n            "col_name": "fname",\n            "m_probabilities": [0.25, 0.75],\n            "u_probabilities": [0.7,  0.3],\n            "gamma_value": 1\n        },\n        {\n            "col_name": "sname",\n            "m_probabilities": [0.2, 0.8],\n            "u_probabilities": [0.8,  0.2],\n            "gamma_value": 0\n        },\n        {\n            "col_name": "dob",\n            "m_probabilities": [0.2, 0.8],\n            "u_probabilities": [0.8,  0.2],\n            "gamma_value": 1\n        },\n        {\n            "col_name": "town",\n            "m_probabilities": [0.2, 0.8],\n            "u_probabilities": [0.8,  0.2],\n            "gamma_value": 1\n        }\n    ]\n}'}function k(e){return e.format(".1%")}function q(e){return e.scaleOrdinal(e.schemeCategory10)}function j(e,n){return e.rgb(n(2)).brighter(2.5)}function O(e,n){return e.rgb(n(1)).brighter(1.5)}function P(e){return e("d3@6")}function T(e){return e("@observablehq/inputs")}function S(){return"Links:\n\nx times more likely: \nhttps://betterexplained.com/articles/understanding-bayes-theorem-with-ratios/\nhttps://rss.onlinelibrary.wiley.com/doi/pdf/10.1111/j.1740-9713.2006.00204.x\n\nOdds are not quite the same as bayes factors:  https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/readings/MIT18_05S14_Reading12b.pdf\n\nhttps://cran.r-project.org/web/packages/BayesFactor/vignettes/odds_probs.html#:~:text=The%20Bayes%20factor%20represents%20the,are%20what%20are%20being%20changed.&text=Further%2C%20these%20odds%20can%20be,models%20sum%20to%20known%20probability.\nThe Bayes factor represents the relative evidence between two models – that is, the change in the model odds due to the data – but the odds are what are being changed. \n\n\nhttps://bookdown.org/kevin_davisross/bayesian-reasoning-and-methods/bayes-factor.html\nRepresenting bayes theorem using bf\n\n"}function A(e,n){var t=e.module();return t.variable(n()).define(["md"],c),t.variable(n("viewof settings_raw")).define("viewof settings_raw",["inputs","default_settings"],u),t.variable(n("settings_raw")).define("settings_raw",["Generators","viewof settings_raw"],(function(e,n){return e.input(n)})),t.variable(n("viewof max_depth_1")).define("viewof max_depth_1",["settings","inputs"],_),t.variable(n("max_depth_1")).define("max_depth_1",["Generators","viewof max_depth_1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["md"],f),t.variable(n()).define(["plot_treemap","settings","max_depth_1"],d),t.variable(n("plot_treemap")).define("plot_treemap",["generate_treemap_data","treemap","html","d3","width","DOM","box_html"],b),t.variable(n("add_children_from_column")).define("add_children_from_column",["children_to_add"],p),t.variable(n("children_to_add")).define("children_to_add",["color_match","color_non_match","d3"],h),t.variable(n("generate_treemap_data")).define("generate_treemap_data",["d3","color_match","color_non_match","add_children_from_column"],v),t.variable(n("box_html")).define("box_html",["format_perc","html"],g),t.variable(n("settings")).define("settings",["settings_raw"],w),t.variable(n("styles")).define("styles",["html"],y),t.variable(n("treemap")).define("treemap",["d3","width"],x),t.variable(n("default_settings")).define("default_settings",Z),t.variable(n("format_perc")).define("format_perc",["d3"],k),t.variable(n("colours")).define("colours",["d3"],q),t.variable(n("color_match")).define("color_match",["d3","colours"],j),t.variable(n("color_non_match")).define("color_non_match",["d3","colours"],O),t.variable(n("d3")).define("d3",["require"],P),t.variable(n("inputs")).define("inputs",["require"],T),t.variable(n()).define(S),t}var E,B,C,F,W,M,z,I,D,G,L,K,$,H,N,R,V,J,U,Y,X,Q,ee,ne,te,ae,re,oe,ie,le,se,me,ce,ue,_e,fe,de,be,pe,he,ve,ge,we,ye,xe,Ze,ke,qe,je,Oe,Pe,Te,Se,Ae,Ee,Be,Ce,Fe,We,Me,ze,Ie,De,Ge,Le,Ke,$e,He,Ne,Re,Ve,Je,Ue,Ye,Xe,Qe,en,nn,tn,an,rn,on,ln,sn,mn,cn,un,_n,fn,dn,bn,pn,hn,vn,gn,wn=t(2137),yn=t(7757),xn=t.n(yn);function Zn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function kn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Zn(Object(t),!0).forEach((function(n){(0,s.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Zn(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function qn(e){return e(E||(E=(0,m.Z)(['# Arquero\n\nArquero is a library for query processing and transformation of array-backed data tables. Following the [relational algebra](https://en.wikipedia.org/wiki/Relational_algebra) and inspired by the design of [dplyr](https://dplyr.tidyverse.org/), Arquero provides a fluent API for manipulating column-oriented data frames. Arquero supports a range of data transformation tasks, including filter, sample, aggregation, window, join, and reshaping operations. Arquero is Spanish for "archer": if datasets are [arrows](https://observablehq.com/@theneuralbit/introduction-to-apache-arrow), Arquero helps their aim stay true.'])))}function jn(e){return e(B||(B=(0,m.Z)(["Import Arquero and extend it to print HTML tables in Observable:"])))}function On(e,n,t,a){return Pn.apply(this,arguments)}function Pn(){return(Pn=(0,wn.Z)(xn().mark((function e(n,t,a,r){var o;return xn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n("arquero@".concat(t));case 2:return o=e.sent,e.next=5,Promise.all(a.map((function(e){return n(e)})));case 5:return e.sent.forEach((function(e){return o.addPackage(e)})),o.addTableMethod("view",r,{override:!0}),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tn(){return"4.2.0"}function Sn(){return[]}function An(e){return e(C||(C=(0,m.Z)(["Export a global reference to Arquero operations:"])))}function En(e){return e.op}function Bn(e){return e(F||(F=(0,m.Z)(["To use the same setup in your own notebooks, add a cell with the following code:\n~~~ js\nimport { aq, op } from '@uwdata/arquero'\n~~~\n"])))}function Cn(e){return e(W||(W=(0,m.Z)(["To get started, see the [Introducing Arquero](https://observablehq.com/@uwdata/introducing-arquero) and [Arquero Cookbook](https://observablehq.com/@uwdata/arquero-cookbook) notebooks."])))}function Fn(e){return e(M||(M=(0,m.Z)(["To use Arquero outside of Observable, see [https://github.com/uwdata/arquero](https://github.com/uwdata/arquero)."])))}function Wn(e){return e(z||(z=(0,m.Z)(["<hr>\n## Examples\n\nThe core abstractions in Arquero are *data tables*, which model each column as an array of values, and *verbs* that transform data and return new tables. Verbs are table methods, allowing method chaining for multi-step transformations. Though each table is unique, many verbs reuse the underlying columns to limit duplication.\n"])))}function Mn(e){return e(I||(I=(0,m.Z)(["Average hours of sunshine per month, from [https://usclimatedata.com/](https://usclimatedata.com/):"])))}function zn(e){return e.table({Seattle:[69,108,178,207,253,268,312,281,221,142,72,52],Chicago:[135,136,187,215,281,311,318,283,226,193,113,106],"San Francisco":[165,182,251,281,314,330,300,272,267,243,189,156]})}function In(e){return e(D||(D=(0,m.Z)(["Sorted differences between Seattle and Chicago:"])))}function Dn(e,n){return e.derive({month:function(e){return n.row_number()},diff:function(e){return e.Seattle-e.Chicago}}).select("month","diff").orderby("month").view({height:400})}function Gn(e){return e(G||(G=(0,m.Z)(["Is Seattle more correlated with San Francisco or Chicago?"])))}function Ln(e,n){return e.rollup({corr_sf:n.corr("Seattle","San Francisco"),corr_chi:n.corr("Seattle","Chicago")}).view()}function Kn(e){return e(L||(L=(0,m.Z)(["Summary statistics per city, as output objects:"])))}function $n(e,n,t){return e.fold(n.all(),{as:["city","sun"]}).groupby("city").rollup({min:function(e){return t.min(e.sun)},max:function(e){return t.max(e.sun)},avg:function(e){return t.average(e.sun)},med:function(e){return t.median(e.sun)},skew:function(e){var n=e.sun;return(t.mean(n)-t.median(n))/t.stdev(n)||0}}).objects()}function Hn(e){return e(K||(K=(0,m.Z)(["<hr>\n## Utilities\n"])))}function Nn(e){var n=function(e){return'<span style="color: #999;">'.concat(e,"</span>")},t="margin: 0; border-collapse: collapse; width: initial;",a="padding: 1px 5px; white-space: nowrap; overflow-x: hidden; text-overflow: ellipsis; font-variant-numeric: tabular-nums;";return function(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"number"==typeof o&&(o={limit:o});var i=kn({},o.color);if("function"==typeof o.color)r.columnNames().forEach((function(e){return i[e]=o.color}));else{var l=function(e){var n=i[e];i[e]="function"==typeof n?n:function(){return n}};for(var s in i)l(s)}var c="".concat(t),u=function(e,n,t){return"".concat(a," max-width: ").concat(+o.maxCellWidth||300,"px;")+(i[e]?" background-color: ".concat(i[e](n,t),";"):"")};o=kn(kn({limit:100,null:n},o),{},{style:{table:c,td:u,th:u}});var _="max-height: ".concat(+o.height||270,"px"),f="".concat(_,"; overflow-x: auto; overflow-y: auto;"),d=e($||($=(0,m.Z)(['<div style="','">',"</div>"])),f,r.toHTML(o));return d.value=r,d}}function Rn(e,n){var t=e.module();return t.variable(n()).define(["md"],qn),t.variable(n()).define(["md"],jn),t.variable(n("aq")).define("aq",["require","aq_version","aq_packages","toView"],On),t.variable(n("aq_version")).define("aq_version",Tn),t.variable(n("aq_packages")).define("aq_packages",Sn),t.variable(n()).define(["md"],An),t.variable(n("op")).define("op",["aq"],En),t.variable(n()).define(["md"],Bn),t.variable(n()).define(["md"],Cn),t.variable(n()).define(["md"],Fn),t.variable(n()).define(["md"],Wn),t.variable(n()).define(["md"],Mn),t.variable(n("dt")).define("dt",["aq"],zn),t.variable(n()).define(["md"],In),t.variable(n()).define(["dt","op"],Dn),t.variable(n()).define(["md"],Gn),t.variable(n()).define(["dt","op"],Ln),t.variable(n()).define(["md"],Kn),t.variable(n()).define(["dt","aq","op"],$n),t.variable(n()).define(["md"],Hn),t.variable(n("toView")).define("toView",["html"],Nn),t}function Vn(e){return e(H||(H=(0,m.Z)(["# Fellegi Sunter utils"])))}function Jn(){return[{uid:"1_l",fname:"John",sname:"Smith",dob:"1989-03-02",town:"Bristol"},{uid:"2_l",fname:"Tom",sname:"Hanks",dob:"1956-07-09",town:"Concord"},{uid:"3_l",fname:"David",sname:"Smith",dob:"1981-08-21",town:"London"}]}function Un(){return[{uid:"1_r",fname:"Jonathan",sname:"Smith",dob:"1989-03-02",town:"Bristol"},{uid:"2_r",fname:"David",sname:"Smith",dob:"1981-08-21",town:"Peckham"}]}function Yn(e,n){return e.from(n)}function Xn(){return{proportion_of_matches:.01,comparison_columns:[{num_levels:3,col_name:"fname",u_probabilities:[.8,.2],m_probabilities:[.2,.8],case_expression:function(e){return e.fname_l==e.fname_r?1:0}},{num_levels:3,col_name:"sname",u_probabilities:[.9,.1],m_probabilities:[.2,.8],case_expression:function(e){return e.sname_l==e.sname_r?1:0}},{col_name:"dob",u_probabilities:[.99,.01],m_probabilities:[.2,.8],case_expression:function(e){return e.dob_l==e.dob_r?1:0}},{col_name:"town",u_probabilities:[.7,.3],m_probabilities:[.3,.7],case_expression:function(e){return e.town_l==e.town_r?1:0}}]}}function Qn(e,n,t){return e(n,t)}function et(e){return e.view()}function nt(e,n,t){return e(n,t)}function tt(e){return e.view()}function at(e,n,t,a){return e(n,t,a).view()}function rt(e,n){return function(t,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.objects().map((function(n){return n.match_probability=e(n,a,r),n})),i=n.from(o);return i=i.relocate(["match_probability"],{after:"uid_r"})}}function ot(e,n){return function(t,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.comparison_columns,i=e(a.proportion_of_matches),l=o.reduce((function(e,n){var a="𝛾_"+n.col_name,o=t[a];if(-1==o)return e;var i=n.m_probabilities[o],l=n.u_probabilities[o],s=t[n.col_name+"_l"].toLowerCase(),m=t[n.col_name+"_r"].toLowerCase();if(s==m&&n.col_name in r){var c=r[n.col_name],u=c[s]||0,_=c[m]||0,f=Math.max(u,_);f>0&&(l=f)}return e+Math.log2(i/l)}),i);return n(l)}}function it(e,n){return function(t,a,r){null==r&&(r=a.comparison_columns.length);var o=a.comparison_columns.slice(0,r),i=e(a.proportion_of_matches),l={comparison_vector:[],gamma_symbols:[],m_values:[],u_values:[],m_symbols:[],u_symbols:[],bayes_factors:[],log2_bayes_factors:[],col_names:[],match_probability:null,lam:a.proportion_of_matches};o.forEach((function(e){var n="𝛾_"+e.col_name,a=t[n],r=e.m_probabilities[a],o=e.u_probabilities[a],i=e.col_name.replace("_","\\_");l.comparison_vector.push(a),l.gamma_symbols.push("\\gamma_\\text{".concat(i,"}")),l.col_names.push(n),l.m_values.push(r),l.m_symbols.push("m_{\\text{".concat(i,"},").concat(a,"}")),l.u_values.push(o),l.u_symbols.push("u_{\\text{".concat(i,"},").concat(a,"}")),l.bayes_factors.push(r/o),l.log2_bayes_factors.push(Math.log2(r/o))}));var s=l.log2_bayes_factors.reduce((function(e,n){return e+n}),i);l.match_probability=n(s);var m=a.proportion_of_matches;return l.size_of_match_portion=m*l.m_values.reduce((function(e,n){return e*n}),1),l.size_of_non_match_portion=(1-m)*l.u_values.reduce((function(e,n){return e*n}),1),l}}function lt(e){return function(n,t,a){var r=e(n,t,a),o=r.m_values.map((function(e){return e.toPrecision(3)})),i=r.u_values.map((function(e){return e.toPrecision(3)})),l=r.lam.toPrecision(3),s=[l].concat(o),m=["(1 - ".concat(l,")")].concat(i),c=s.join(" \\times "),u=m.join(" \\times "),_=r.match_probability.toPrecision(3),f=r.size_of_match_portion.toPrecision(3),d=r.size_of_non_match_portion.toPrecision(3);return"\\frac{".concat(c,"}{(").concat(c,") + (").concat(u,")}  \\newline[10pt] = \\frac{").concat(f,"}{").concat(f," + ").concat(d,"}  \\newline[10pt] = ").concat(_)}}function st(e){return function(n,t){var a=e(n,t),r=a.m_symbols,o=a.u_symbols,i=(a.lam,["\\lambda"].concat(r)),l=["(1 - \\lambda)"].concat(o),s=i.join(" "),m=l.join(" ");return"\\frac{".concat(s,"}{").concat(s,") + ").concat(m,"}")}}function mt(e,n,t,a){return e(N||(N=(0,m.Z)(["","\n"])),n(t.objects()[0],a))}function ct(e){return function(n,t,a){var r=e(n,t,a),o=r.gamma_symbols.join(", "),i=r.comparison_vector.join(", ");return"\\bm{\\gamma} = [".concat(o,"]= [").concat(i,"]")}}function ut(e,n,t,a){return e(R||(R=(0,m.Z)(["","\n"])),n(t.objects()[0],a))}function _t(e){return e(V||(V=(0,m.Z)(["\bm{gamma} = [gamma_\text{fname}, gamma_\text{sname}]"],["\\bm{\\gamma} = [\\gamma_\\text{fname}, \\gamma_\\text{sname}]"])))}function ft(e,n,t,a){return e(J||(J=(0,m.Z)(["",""])),n(t.objects()[0],a))}function dt(e,n,t){return e(n.objects()[0],t)}function bt(e){return function(n,t){var a=e.from(n),r=e.from(t),o=a.join(r,(function(e,n){return!0}),null,{suffix:["_l","_r"]}),i=a.columnNames(),l=[];return i.forEach((function(e){l.push(e+"_l"),l.push(e+"_r")})),o=o.select(l)}}function pt(e){return function(n,t){var a=t.comparison_columns,r=n.objects();a.forEach((function(e){r.forEach((function(n){n["𝛾_"+e.col_name]=e.case_expression(n)}))})),r=e.from(r);var o=["uid_l","uid_r"];return a.forEach((function(e){o.push(e.col_name+"_l"),o.push(e.col_name+"_r"),o.push("𝛾_"+e.col_name)})),r=r.select(o)}}function ht(){return function(e){return e/(e+1)}}function vt(e){return function(n){return e(Math.pow(2,n))}}function gt(){return function(e){return e/(1-e)}}function wt(e){return function(n){return Math.log2(e(n))}}function yt(e){return e.csv("https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv",e.autoType).then((function(e){var n={};return e.forEach((function(e){n[e.firstname]=e.freq})),n}))}function xt(e){return e.csv("https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/last_name.csv",e.autoType).then((function(e){var n={};return e.forEach((function(e){n[e.surname]=e.freq})),n}))}function Zt(e,n){return{fname:e,sname:n}}function kt(e){return e.fname.joshua}function qt(e){return e.sname.linacre}function jt(e,n){var t=e.module();t.variable(n()).define(["md"],Vn),t.variable(n("records_l")).define("records_l",Jn),t.variable(n("records_r")).define("records_r",Un),t.variable(n("df_r")).define("df_r",["aq","records_r"],Yn),t.variable(n("splink_settings")).define("splink_settings",Xn),t.variable(n("df_comparison")).define("df_comparison",["get_df_comparison","records_l","records_r"],Qn),t.variable(n()).define(["df_comparison"],et),t.variable(n("df_gammas")).define("df_gammas",["get_df_gammas","df_comparison","splink_settings"],nt),t.variable(n()).define(["df_gammas"],tt),t.variable(n()).define(["get_df_e","df_gammas","splink_settings","term_freqs"],at),t.variable(n("get_df_e")).define("get_df_e",["get_match_probability","aq"],rt),t.variable(n("get_match_probability")).define("get_match_probability",["prob_to_log2_bf","log2_bf_to_prob"],ot),t.variable(n("get_match_probability_components")).define("get_match_probability_components",["prob_to_log2_bf","log2_bf_to_prob"],it),t.variable(n("get_m_u_formula_numbers")).define("get_m_u_formula_numbers",["get_match_probability_components"],lt),t.variable(n("get_m_u_formula_symbols")).define("get_m_u_formula_symbols",["get_match_probability_components"],st),t.variable(n()).define(["tex","get_m_u_formula_symbols","df_gammas","splink_settings"],mt),t.variable(n("get_comparison_vector_symbols_and_numbers")).define("get_comparison_vector_symbols_and_numbers",["get_match_probability_components"],ct),t.variable(n()).define(["tex","get_comparison_vector_symbols_and_numbers","df_gammas","splink_settings"],ut),t.variable(n()).define(["tex"],_t),t.variable(n()).define(["tex","get_m_u_formula_numbers","df_gammas","splink_settings"],ft),t.variable(n()).define(["get_match_probability_components","df_gammas","splink_settings"],dt),t.variable(n("get_df_comparison")).define("get_df_comparison",["aq"],bt),t.variable(n("get_df_gammas")).define("get_df_gammas",["aq"],pt),t.variable(n("bayes_factor_to_prob")).define("bayes_factor_to_prob",ht),t.variable(n("log2_bf_to_prob")).define("log2_bf_to_prob",["bayes_factor_to_prob"],vt),t.variable(n("prob_to_bayes_factor")).define("prob_to_bayes_factor",gt),t.variable(n("prob_to_log2_bf")).define("prob_to_log2_bf",["prob_to_bayes_factor"],wt);var a=e.module(Rn);return t.import("aq",a),t.import("op",a),t.variable(n("first_name_lookup")).define("first_name_lookup",["d3"],yt),t.variable(n("surname_lookup")).define("surname_lookup",["d3"],xt),t.variable(n("term_freqs")).define("term_freqs",["first_name_lookup","surname_lookup"],Zt),t.variable(n()).define(["term_freqs"],kt),t.variable(n()).define(["term_freqs"],qt),t}function Ot(e){return e(U||(U=(0,m.Z)(["# Fellegi-Sunter visualisation interface"])))}function Pt(e,n,t){return function(a){var r=1==a.gamma_value?"match":"mismatch",o=e.radio(["match","mismatch"],{label:"Comparison of ".concat(a.col_name," is a:"),value:r}),i=e.range([0,1],{label:n(Y||(Y=(0,m.Z)(["u_\text{",",level_0}"],["u_\\text{",",level\\_0}"])),a.col_name),value:a.u_probabilities[0]}),l=e.range([0,1],{label:n(X||(X=(0,m.Z)(["u_\text{",",level_1}"],["u_\\text{",",level\\_1}"])),a.col_name),value:a.u_probabilities[1]}),s=e.range([0,1],{label:n(Q||(Q=(0,m.Z)(["m_\text{",",level_0}"],["m_\\text{",",level\\_0}"])),a.col_name),value:a.m_probabilities[0]}),c=e.range([0,1],{label:n(ee||(ee=(0,m.Z)(["m_\text{",",level_1}"],["m_\\text{",",level\\_1}"])),a.col_name),value:a.m_probabilities[1]}),u=t(ne||(ne=(0,m.Z)(["\n    <h4>Choose value and parameters for ","</h4>\n    ",'\n    <div class="container">\n      <div class="item-0">',"",'</div>\n      <div class="item-1">',"","</div>\n    </div>\n  "])),a.col_name,o,i,s,l,c),_=function(){return{col_name:a.col_name,gamma_value:o.querySelector("input").checked?1:0,u_probabilities:[i.value,l.value],m_probabilities:[s.value,c.value]}};return o.onclick=function(){console.log(o.value),u.value=_()},i.oninput=function(){l.value=1-i.value,u.value=_()},l.oninput=function(){i.value=1-l.value,u.value=_()},s.oninput=function(){c.value=1-s.value,u.value=_()},c.oninput=function(){s.value=1-c.value,u.value=_()},u.value=_(),u}}function Tt(e){return e({col_name:"fname",gamma_value:1,m_probabilities:[.3,.7],u_probabilities:[.75,.25]})}function St(e){return e}function At(e){return e({col_name:"sname",gamma_value:0,m_probabilities:[.2,.8],u_probabilities:[.85,.15]})}function Et(e){return e({col_name:"dob",gamma_value:1,m_probabilities:[.2,.8],u_probabilities:[.8,.2]})}function Bt(e){return e({col_name:"town",gamma_value:1,m_probabilities:[.3,.7],u_probabilities:[.9,.1]})}function Ct(e,n){return e.range([0,1],{label:n(te||(te=(0,m.Z)(["lambda"],["\\lambda"]))),value:.3})}function Ft(e,n,t,a,r){return{proportion_of_matches:e,comparison_columns:[n,t,a,r]}}function Wt(e){return e(ae||(ae=(0,m.Z)(["<style>.container {\n  display: flex;\nflex-wrap: wrap;\n  gap: 12px;\n}\n</style>\n"])))}function Mt(e){return e("@observablehq/inputs")}function zt(e,n){var t=e.module();return t.variable(n()).define(["md"],Ot),t.variable(n("my_interface")).define("my_interface",["inputs","tex","html"],Pt),t.variable(n("viewof fname_val")).define("viewof fname_val",["my_interface"],Tt),t.variable(n("fname_val")).define("fname_val",["Generators","viewof fname_val"],(function(e,n){return e.input(n)})),t.variable(n()).define(["fname_val"],St),t.variable(n("viewof sname_val")).define("viewof sname_val",["my_interface"],At),t.variable(n("sname_val")).define("sname_val",["Generators","viewof sname_val"],(function(e,n){return e.input(n)})),t.variable(n("viewof dob_val")).define("viewof dob_val",["my_interface"],Et),t.variable(n("dob_val")).define("dob_val",["Generators","viewof dob_val"],(function(e,n){return e.input(n)})),t.variable(n("viewof town_val")).define("viewof town_val",["my_interface"],Bt),t.variable(n("town_val")).define("town_val",["Generators","viewof town_val"],(function(e,n){return e.input(n)})),t.variable(n("viewof lam")).define("viewof lam",["inputs","tex"],Ct),t.variable(n("lam")).define("lam",["Generators","viewof lam"],(function(e,n){return e.input(n)})),t.variable(n("splink_settings")).define("splink_settings",["lam","fname_val","sname_val","dob_val","town_val"],Ft),t.variable(n("form_styles")).define("form_styles",["html"],Wt),t.variable(n("inputs")).define("inputs",["require"],Mt),t}function It(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function Dt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?It(Object(t),!0).forEach((function(n){(0,s.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):It(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function Gt(e){return e(re||(re=(0,m.Z)(["# Visualising the Fellegi Sunter model "])))}function Lt(e){return e(oe||(oe=(0,m.Z)(["*A final version of this notebook can be viewed on my blog [here](https://www.robinlinacre.com/visualising_fellegi_sunter/).*"])))}function Kt(e,n){return e(ie||(ie=(0,m.Z)(["The [previous article](https://www.robinlinacre.com/maths_of_fellegi_sunter/) presented an implementation of the Fellegi Sunter model.  We showed that match probability could be represented by Equation 1 - which is reproduced below:\n","\n\n"])),n(le||(le=(0,m.Z)(["\noperatorname{Pr}(\text{records match}|gamma_{1},gamma_{2},ldots,gamma_{K})  \newline [10pt] = \frac{lambda m_{1ell}m_{2ell}ldots m_{Kell}}{lambda m_{1ell}m_{2ell}ldots m_{Kell}+ (1-lambda)u_{1ell}u_{1ell} ldots u_{Kell}} "],["\n\\operatorname{Pr}(\\text{records match}|\\gamma_{1},\\gamma_{2},\\ldots,\\gamma_{K})  \\newline [10pt] = \\frac{\\lambda m_{1\\ell}m_{2\\ell}\\ldots m_{K\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}\\ldots m_{K\\ell}+ (1-\\lambda)u_{1\\ell}u_{1\\ell} \\ldots u_{K\\ell}} "]))))}function $t(e){return e(se||(se=(0,m.Z)(["This article presents a way to understand and visualise this formula."])))}function Ht(e){return e(me||(me=(0,m.Z)(["In our visualisation, we are going to take each piece of evidence into account in turn. This is possible due to our assumption of conditional independence of comparison columns given the match status.\n\nThe means Equation 1 is equivalent to a repeated application of Bayes' Theorem (see annex). See [here](https://www.youtube.com/watch?v=HZGCoVF3YvM) is more in depth video about Bayes Theorem.\n"])))}function Nt(e){return e(ce||(ce=(0,m.Z)(["## Example\n\nWe are going to compute match probability for a record comparison with the following comparison columns:\n\n- `fname` (first name)\n- `sname` (surname)\n- `dob` (date of birth)\n- `town` \n\n\nThe default parameter values are a bit unrealistic, but help make sure the diagrams are legible.\n"],["## Example\n\nWe are going to compute match probability for a record comparison with the following comparison columns:\n\n- \\`fname\\` (first name)\n- \\`sname\\` (surname)\n- \\`dob\\` (date of birth)\n- \\`town\\` \n\n\nThe default parameter values are a bit unrealistic, but help make sure the diagrams are legible.\n"])))}function Rt(e){return e(ue||(ue=(0,m.Z)(["## Step 1"])))}function Vt(e,n,t,a){return e(_e||(_e=(0,m.Z)(["We begin by visualising the space of all pairwise record comparisons, splitting the overall comparison space into "," and "," using our prior, ",""])),n(fe||(fe=(0,m.Z)(["matches"]))),t(de||(de=(0,m.Z)(["non-matches"]))),a(be||(be=(0,m.Z)(["operatorname{Pr}(\text{records match}) =  lambda"],["\\operatorname{Pr}(\\text{records match}) =  \\lambda"]))))}function Jt(e){return e}function Ut(e,n){return e(n,0,300)}function Yt(e,n,t,a,r){return e(pe||(pe=(0,m.Z)(["Using only this information, our estimate of match probability is just the prior:\n\n","\n\n"])),n(he||(he=(0,m.Z)(["\text{match probability} =  \frac{lambda }{lambda + (1-lambda)}  \newline [10pt] = \frac{colorbox{","}{\text{yellow area}}}{colorbox{","}{\text{yellow area}} + colorbox{","}{\text{blue area}} }= "," "],["\\text{match probability} =  \\frac{\\lambda }{\\lambda + (1-\\lambda)}  \\newline [10pt] = \\frac{\\colorbox{","}{\\text{yellow area}}}{\\colorbox{","}{\\text{yellow area}} + \\colorbox{","}{\\text{blue area}} }= "," "])),t.hex(),t.hex(),a.hex(),r.proportion_of_matches.toPrecision(4)))}function Xt(e){return e(ve||(ve=(0,m.Z)(["## Step 2 - First name"])))}function Qt(e){return e(ge||(ge=(0,m.Z)(["We will now choose the parameters of the model for the first name field, and then take this information into account in the diagram."])))}function ea(e){return e}function na(e,n,t,a,r,o,i,l,s){return e(we||(we=(0,m.Z)([" ","\nAn example of the data would be:\n","\n\nAccording to the model parameters you've chosen:\n\n\n- ","\n- ","\n\n\n\nGiven this observation, we can subdivide the comparison space, and we know we must be in the "," or "," part of the following diagram:\n"])),n("fname",t),a(r(1)),o("fname",i(1),t,"m"),o("fname",i(1),t,"u"),l(ye||(ye=(0,m.Z)(["yellow"]))),s(xe||(xe=(0,m.Z)(["blue"]))))}function ta(e,n){return e(n,1,300)}function aa(e,n,t,a,r,o,i,l,s){return e(Ze||(Ze=(0,m.Z)([" What's the probability we're in the "," area?  This must be:\n\n","\n\nFrom this diagram we can see that the "," and the \n",".\n\nSo:\n\n","\n\nWhich, in numbers is:\n\n","\n"])),n(ke||(ke=(0,m.Z)(["yellow"]))),t(qe||(qe=(0,m.Z)(["\text{match probability} = \frac{colorbox{","}{\text{yellow area}}}{colorbox{","}{\text{yellow area}} + colorbox{","}{\text{blue area}} } "],["\\text{match probability} = \\frac{\\colorbox{","}{\\text{yellow area}}}{\\colorbox{","}{\\text{yellow area}} + \\colorbox{","}{\\text{blue area}} } "])),a.hex(),a.hex(),r.hex()),o(je||(je=(0,m.Z)(["colorbox{","}{$\text{yellow area} = lambda m_{1ell}$}"],["\\colorbox{","}{$\\text{yellow area} = \\lambda m_{1\\ell}$}"])),a.hex()),o(Oe||(Oe=(0,m.Z)(["colorbox{","}{$\text{blue area} = (1-lambda) u_{1ell}$}"],["\\colorbox{","}{$\\text{blue area} = (1-\\lambda) u_{1\\ell}$}"])),r.hex()),t(Pe||(Pe=(0,m.Z)(["\text{match probability} =  \frac{lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}}"],["\\text{match probability} =  \\frac{\\lambda m_{1\\ell}}{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell}}"]))),o(Te||(Te=(0,m.Z)(["",""])),i(l(2),s,1)))}function ra(e){return e(Se||(Se=(0,m.Z)(["## Step 3 - Surname"])))}function oa(e){return e(Ae||(Ae=(0,m.Z)(["Let's also choose parameters for `sname`, the surname field:"],["Let's also choose parameters for \\`sname\\`, the surname field:"])))}function ia(e){return e}function la(e,n,t,a,r,o,i,l,s){return e(Ee||(Ee=(0,m.Z)(["","\nAn example of the data would be:\n","\n\nAccording to the model parameters you've chosen:\n\n\n- ","\n- ","\n\n\n\nGiven this observation, we can subdivide the comparison space, and we know we must be in the "," or "," part of the following diagram:"])),n("sname",t),a(r(2)),o("sname",i(2),t,"m"),o("sname",i(2),t,"u"),l(Be||(Be=(0,m.Z)(["yellow"]))),s(Ce||(Ce=(0,m.Z)(["blue"]))))}function sa(e,n){return e(n,2,300)}function ma(e,n,t,a,r,o,i){return e(Fe||(Fe=(0,m.Z)(["We now have:\n\n","\n\n","\n\nWhich, in numbers is:\n\n","\n"])),n(We||(We=(0,m.Z)(["\text{match probability} = \frac{colorbox{","}{\text{yellow area}}}{colorbox{","}{\text{yellow area}} + colorbox{","}{\text{blue area}} } "],["\\text{match probability} = \\frac{\\colorbox{","}{\\text{yellow area}}}{\\colorbox{","}{\\text{yellow area}} + \\colorbox{","}{\\text{blue area}} } "])),t.hex(),t.hex(),a.hex()),n(Me||(Me=(0,m.Z)(["= \frac{lambda m_{1ell}m_{2ell}}{lambda m_{1ell}m_{2ell}+ (1-lambda)u_{1ell}u_{2ell}}"],["= \\frac{\\lambda m_{1\\ell}m_{2\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}+ (1-\\lambda)u_{1\\ell}u_{2\\ell}}"]))),n(ze||(ze=(0,m.Z)(["",""])),r(o(2),i,2)))}function ca(e){return e(Ie||(Ie=(0,m.Z)(["## Step 4 - Date of birth"])))}function ua(e){return e}function _a(e,n,t,a,r,o,i,l,s){return e(De||(De=(0,m.Z)([" ","\nAn example of the data would be:\n","\n\nAccording to the model parameters you've chosen:\n\n\n- ","\n- ","\n\n\n\nGiven this observation, we can subdivide the comparison space, and we know we must be in the "," or "," part of the following diagram:\n"])),n("dob",t),a(r(3)),o("dob",i(3),t,"m"),o("dob",i(3),t,"u"),l(Ge||(Ge=(0,m.Z)(["yellow"]))),s(Le||(Le=(0,m.Z)(["blue"]))))}function fa(e,n){return e(n,3,300)}function da(e,n,t,a,r){return e(Ke||(Ke=(0,m.Z)(["We now have:\n\n","\n\n","\n"])),n($e||($e=(0,m.Z)(["\text{match probability} =  \frac{lambda m_{1ell}m_{2ell}m_{3ell}}{lambda m_{1ell}m_{2ell}m_{3ell}+ (1-lambda)u_{1ell}u_{2ell}u_{3ell}}"],["\\text{match probability} =  \\frac{\\lambda m_{1\\ell}m_{2\\ell}m_{3\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}m_{3\\ell}+ (1-\\lambda)u_{1\\ell}u_{2\\ell}u_{3\\ell}}"]))),n(He||(He=(0,m.Z)(["",""])),t(a(3),r,3)))}function ba(e){return e(Ne||(Ne=(0,m.Z)(["## Step 5: Town"])))}function pa(e){return e}function ha(e,n,t,a,r,o,i,l,s){return e(Re||(Re=(0,m.Z)(["The final column is town.\n\n","\nAn example of the final data would be:\n","\n\nAccording to the model parameters you've chosen:\n\n\n- ","\n- ","\n\n\n\nGiven this observation, we can subdivide the comparison space, and we know we must be in the "," or "," part of the following diagram:\n"])),n("town",t),a(r(4)),o("town",i(4),t,"m"),o("town",i(4),t,"u"),l(Ve||(Ve=(0,m.Z)(["yellow"]))),s(Je||(Je=(0,m.Z)(["blue"]))))}function va(e,n){return e(n,4,300)}function ga(e,n,t,a,r,o){return e(Ue||(Ue=(0,m.Z)(["The final match probability is therefore:\n\n","\n\nWhich, in numbers is:\n\n\n","\n"])),n(Ye||(Ye=(0,m.Z)(["\text{match probability} =  \frac{lambda m_{1ell}m_{2ell}m_{3ell}m_{4ell}}{lambda m_{1ell}m_{2ell}m_{3ell}m_{4ell}+ (1-lambda)u_{1ell}u_{2ell}u_{3ell}u_{4ell}}"],["\\text{match probability} =  \\frac{\\lambda m_{1\\ell}m_{2\\ell}m_{3\\ell}m_{4\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}m_{3\\ell}m_{4\\ell}+ (1-\\lambda)u_{1\\ell}u_{2\\ell}u_{3\\ell}u_{4\\ell}}"]))),t(Xe||(Xe=(0,m.Z)(["",""])),a(r(4),o)))}function wa(e,n,t){return e(Qe||(Qe=(0,m.Z)(["## Annex:  Mathematical representation\n\nThis annex shows why it's possible to represent the calculation of match probability as a step-by-step computation.  \n\nIn particular, we will show that we can calculate match probability using a repeated application of Bayes Theorem.  In pseudocode, our algorithm will be:\n\n```\nprior = lambda\nfor col in compaison_columns:\n  posterior = bayes(col, prior)\n  prior = posterior\n```\n\n\nWhere the final value of the posterior is equal to ",".\n\nTo demonstrate why this works, consider equation 1, for the case of two columns:\n\n","\n\nWe start by applying Bayes Theorem once, accounting for the first comparison column:\n\n","\n\nThis posterior, ",", becomes the new prior, which we now use instead of lambda:\n","\n\nNote that:\n\n","\n\nBut "," shows that  the term "," appears on both top and bottom of "," and therefore cancels, leaving ","  as desired.\n\n"],["## Annex:  Mathematical representation\n\nThis annex shows why it's possible to represent the calculation of match probability as a step-by-step computation.  \n\nIn particular, we will show that we can calculate match probability using a repeated application of Bayes Theorem.  In pseudocode, our algorithm will be:\n\n\\`\\`\\`\nprior = lambda\nfor col in compaison_columns:\n  posterior = bayes(col, prior)\n  prior = posterior\n\\`\\`\\`\n\n\nWhere the final value of the posterior is equal to ",".\n\nTo demonstrate why this works, consider equation 1, for the case of two columns:\n\n","\n\nWe start by applying Bayes Theorem once, accounting for the first comparison column:\n\n","\n\nThis posterior, ",", becomes the new prior, which we now use instead of lambda:\n","\n\nNote that:\n\n","\n\nBut "," shows that  the term "," appears on both top and bottom of "," and therefore cancels, leaving ","  as desired.\n\n"])),n(en||(en=(0,m.Z)(["\noperatorname{Pr}(\text{records match}|gamma_{1},gamma_{2},ldots,gamma_{K})"],["\n\\operatorname{Pr}(\\text{records match}|\\gamma_{1},\\gamma_{2},\\ldots,\\gamma_{K})"]))),t(nn||(nn=(0,m.Z)(["\noperatorname{Pr}(\text{records match}|gamma_{1},gamma_{2}) = \frac{lambda m_{1ell}m_{2ell}}{lambda m_{1ell}m_{2ell}+ (1-lambda)u_{1ell}u_{1ell}} \tag{2.1}"],["\n\\operatorname{Pr}(\\text{records match}|\\gamma_{1},\\gamma_{2}) = \\frac{\\lambda m_{1\\ell}m_{2\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}+ (1-\\lambda)u_{1\\ell}u_{1\\ell}} \\tag{2.1}"]))),t(tn||(tn=(0,m.Z)(["\noperatorname{Pr}(\text{records match}|gamma_{1}) = t = \frac{lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}}"],["\n\\operatorname{Pr}(\\text{records match}|\\gamma_{1}) = t = \\frac{\\lambda m_{1\\ell}}{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell}}"]))),n(an||(an=(0,m.Z)(["t"]))),t(rn||(rn=(0,m.Z)(["\n\text{posterior} = operatorname{Pr}(\text{records match}|gamma_{1},gamma_{2}) = \frac{t m_{2ell}}{t m_{2ell}+ (1-t)u_{2ell}}\tag{2.2}"],["\n\\text{posterior} = \\operatorname{Pr}(\\text{records match}|\\gamma_{1},\\gamma_{2}) = \\frac{t m_{2\\ell}}{t m_{2\\ell}+ (1-t)u_{2\\ell}}\\tag{2.2}"]))),t(on||(on=(0,m.Z)(["\n1- t = 1 - \frac{lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}} = \frac{lambda m_{1ell}+ (1-lambda)u_{1ell} - lambda m_{1ell}}{lambda m_{1ell}+ (1-lambda)u_{1ell}} = \frac{(1-lambda)u_{1ell} }{lambda m_{1ell}+ (1-lambda)u_{1ell}}\tag{2.3}"],["\n1- t = 1 - \\frac{\\lambda m_{1\\ell}}{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell}} = \\frac{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell} - \\lambda m_{1\\ell}}{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell}} = \\frac{(1-\\lambda)u_{1\\ell} }{\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell}}\\tag{2.3}"]))),n(ln||(ln=(0,m.Z)(["(2.3)"]))),n(sn||(sn=(0,m.Z)(["(lambda m_{1ell}+ (1-lambda)u_{1ell})"],["(\\lambda m_{1\\ell}+ (1-\\lambda)u_{1\\ell})"]))),n(mn||(mn=(0,m.Z)(["(2.2)"]))),n(cn||(cn=(0,m.Z)(["(2.1)"]))))}function ya(e){return e.options({displayMode:!0,fleqn:!0})}function xa(e,n,t){return e(un||(un=(0,m.Z)(["<style>\n.katex-display>.katex { font-size: 1em}\n\n\ntextarea {\n    max-height: 1000em !important;\n    font-family: monospace !important;\n}\n\n.katex-display>.katex>.katex-html>.tag {right: unset; padding-left:4em}\n\n.hl_m {\nbackground-color: ",";\ndisplay:inline-block;\n}\n\n.hl_nm {\nbackground-color: ",";\ndisplay:inline-block;\n}\n\n</style>"])),n.hex(),t.hex())}function Za(e){return function(n){var t={},a={fname:[{fname_l:"John",fname_r:"Tom"},{fname_l:"John",fname_r:"John"}],sname:[{sname_l:"Smith",sname_r:"Hanks"},{sname_l:"Smith",sname_r:"Smith"}],dob:[{dob_l:"1989-03-02",dob_r:"1981-08-21"},{dob_l:"1989-03-02",dob_r:"1989-03-02"}],town:[{town_l:"Bristol",town_r:"Peckham"},{town_l:"Bristol",town_r:"Bristol"}]};return e.comparison_columns.slice(0,n).forEach((function(e){var n=a[e.col_name][e.gamma_value];t=Dt(Dt({},t),n);var r="𝛾_"+e.col_name;t[r]=e.gamma_value})),t}}function ka(e){return function(n){var t=e(n),a=Object.keys(t).filter((function(e){return!e.includes("𝛾_")})),r={};return a.forEach((function(e){r[e]=t[e]})),r}}function qa(e){return function(n){var t=Object.keys(n).join(" | "),a=Object.keys(n).map((function(e){return"-"})).join(" | "),r=Object.values(n).join(" | ");return e(_n||(_n=(0,m.Z)([""," \n "," \n "," \n"],[""," \\n "," \\n "," \\n"])),t,a,r)}}function ja(e){return e}function Oa(e){return function(n){return e(fn||(fn=(0,m.Z)(['<span class="hl_nm">',"</span>"])),n)}}function Pa(e){return function(n){return e(dn||(dn=(0,m.Z)(['<span class="hl_m">',"</span>"])),n)}}function Ta(e){return e}function Sa(e,n,t){return function(a,r,o,i){var l,s=o.comparison_columns.filter((function(e){return e.col_name==a}))[0],c=r["𝛾_"+a];1==c?l="matches":0==c&&(l="does not match");a.replace("_","\\_");var u,_="The column `".concat(a,"` ").concat(l),f=100*s["".concat(i,"_probabilities")][c];return f=parseFloat(f).toFixed(0)+"%",u="m"==i?e(bn||(bn=(0,m.Z)(["matching records"]))):n(pn||(pn=(0,m.Z)(["non-matching records"]))),t(hn||(hn=(0,m.Z)([""," in "," of ",""])),_,f,u)}}function Aa(e,n){return function(t,a){var r,o;a.comparison_columns.forEach((function(e){e.col_name==t&&(r=e)}));var i=r.gamma_value;return o=0==i?"does not match":"matches",e(vn||(vn=(0,m.Z)(["You have chosen that the column `","` ",", i.e. that "," = ","."],["You have chosen that the column \\`","\\` ",", i.e. that "," = ","."])),t,o,n(gn||(gn=(0,m.Z)(["gamma_\text{","}"],["\\gamma_\\text{","}"])),t),i)}}function Ea(e){return e("@observablehq/inputs")}function Ba(e,n){var t=e.module();t.variable(n("title")).define("title",["md"],Gt),t.variable(n()).define(["md"],Lt),t.variable(n("para_1")).define("para_1",["md","texd"],Kt),t.variable(n("para_2")).define("para_2",["md"],$t),t.variable(n("para_3")).define("para_3",["md"],Ht),t.variable(n("para_4")).define("para_4",["md"],Nt),t.variable(n("subhead_1")).define("subhead_1",["md"],Rt),t.variable(n("para_5")).define("para_5",["md","m","nm","tex"],Vt),t.variable(n("lam_view")).define("lam_view",["viewof lam"],Jt),t.variable(n("treemap_1")).define("treemap_1",["plot_treemap","splink_settings"],Ut),t.variable(n("para_6")).define("para_6",["md","texd","color_match","color_non_match","splink_settings"],Yt),t.variable(n("subhead_2")).define("subhead_2",["md"],Xt),t.variable(n("para_7")).define("para_7",["md"],Qt),t.variable(n("fname_view")).define("fname_view",["viewof fname_val"],ea),t.variable(n("para_8")).define("para_8",["md","choice_text","splink_settings","dict_as_md_table_row","get_row_no_gammas","get_m_u_text","get_row","m","nm"],na),t.variable(n("treemap_2")).define("treemap_2",["plot_treemap","splink_settings"],ta),t.variable(n("para_9")).define("para_9",["md","m","texd","color_match","color_non_match","tex","get_m_u_formula_numbers","get_row","splink_settings"],aa),t.variable(n("subhead_3")).define("subhead_3",["md"],ra),t.variable(n("para_10")).define("para_10",["md"],oa),t.variable(n("sname_view")).define("sname_view",["viewof sname_val"],ia),t.variable(n("para_11")).define("para_11",["md","choice_text","splink_settings","dict_as_md_table_row","get_row_no_gammas","get_m_u_text","get_row","m","nm"],la),t.variable(n("treemap_3")).define("treemap_3",["plot_treemap","splink_settings"],sa),t.variable(n("para_12")).define("para_12",["md","texd","color_match","color_non_match","get_m_u_formula_numbers","get_row","splink_settings"],ma),t.variable(n("subhead_4")).define("subhead_4",["md"],ca),t.variable(n("dob_view")).define("dob_view",["viewof dob_val"],ua),t.variable(n("para_13")).define("para_13",["md","choice_text","splink_settings","dict_as_md_table_row","get_row_no_gammas","get_m_u_text","get_row","m","nm"],_a),t.variable(n("treemap_4")).define("treemap_4",["plot_treemap","splink_settings"],fa),t.variable(n("para_14")).define("para_14",["md","texd","get_m_u_formula_numbers","get_row","splink_settings"],da),t.variable(n("subhead_5")).define("subhead_5",["md"],ba),t.variable(n("town_view")).define("town_view",["viewof town_val"],pa),t.variable(n("para_15")).define("para_15",["md","choice_text","splink_settings","dict_as_md_table_row","get_row_no_gammas","get_m_u_text","get_row","m","nm"],ha),t.variable(n("treemap_5")).define("treemap_5",["plot_treemap","splink_settings"],va),t.variable(n("para_16")).define("para_16",["md","texd","tex","get_m_u_formula_numbers","get_row","splink_settings"],ga),t.variable(n("annex")).define("annex",["md","tex","texd"],wa),t.variable(n("texd")).define("texd",["tex"],ya),t.variable(n("css_styles")).define("css_styles",["html","color_match","color_non_match"],xa);var a=e.module(A);t.import("default_settings",a),t.variable(n("get_row")).define("get_row",["splink_settings"],Za),t.variable(n("get_row_no_gammas")).define("get_row_no_gammas",["get_row"],ka);var r=e.module(jt);t.import("get_m_u_formula_symbols",r),t.import("get_m_u_formula_numbers",r),t.import("get_comparison_vector_symbols_and_numbers",r),t.import("get_match_probability_components",r),t.variable(n("dict_as_md_table_row")).define("dict_as_md_table_row",["md"],qa);var o=e.module(A);t.import("styles",o),t.import("plot_treemap",o),t.import("color_match",o),t.import("color_non_match",o),t.variable(n("additional_styles")).define("additional_styles",["styles"],ja),t.variable(n("nm")).define("nm",["html"],Oa),t.variable(n("m")).define("m",["html"],Pa);var i=e.module(zt);return t.import("splink_settings",i),t.import("viewof lam",i),t.import("lam",i),t.import("viewof fname_val",i),t.import("fname_val",i),t.import("viewof sname_val",i),t.import("sname_val",i),t.import("viewof dob_val",i),t.import("dob_val",i),t.import("viewof town_val",i),t.import("town_val",i),t.import("form_styles",i),t.variable(n("styles2")).define("styles2",["form_styles"],Ta),t.variable(n("get_m_u_text")).define("get_m_u_text",["m","nm","md"],Sa),t.variable(n("choice_text")).define("choice_text",["md","tex"],Aa),t.variable(n("inputs")).define("inputs",["require"],Ea),t}var Ca=t(1369),Fa=t(674);var Wa={title:"Visualising the Fellegi Sunter model",post_date:"2021-05-07",code_url:"https://observablehq.com/@robinl/visualising-fellegi-sunter",post_type:"obs",post_category:"probabilistic_linkage",description:"An set of interactive, explorable explanations of the Fellegi Sunter model of probabilistic record linkage.  This article presents a way of visualising how the model works."},Ma=["additional_styles","title","para_1","para_2","para_3","para_4","subhead_1","para_5","lam_view","treemap_1","para_6","subhead_2","para_7","fname_view","para_8","treemap_2","para_9","subhead_3","para_10","sname_view","para_11","treemap_3","para_12","subhead_4","dob_view","para_13","treemap_4","para_14","subhead_5","town_view","para_15","treemap_5","para_16","annex","additional_styles","styles2","css_styles"],za={name:"1aymd26",styles:"margin-left:auto;margin-right:auto;width:90%;max-width:800px;table{font-size:0.8rem;line-height:1rem;}div{position:relative}.wrap-info{font-size:0.7rem;}rem;"},Ia=function(e){return(0,Fa.tZ)(Ca.Z,{define:Ba,output_order:Ma,post_frontmatter:Wa,css:za,current_path:e.path})}}}]);
//# sourceMappingURL=component---src-pages-visualising-fellegi-sunter-jsx-cb07b0cf356804ab9fde.js.map