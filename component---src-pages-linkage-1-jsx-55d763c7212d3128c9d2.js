(self.webpackChunkgatsby_starter_hello_world=self.webpackChunkgatsby_starter_hello_world||[]).push([[472],{2465:function(e,t,n){"use strict";function i(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}n.d(t,{Z:function(){return i}})},2263:function(e,t,n){"use strict";n(7294);var i=n(835),a=n(8847),r=n(7414),o=n(6140),l=n(674);t.Z=function(e){var t;return t=e.define?(0,l.tZ)(a.Z,{define:e.define,output_order:e.output_order}):e.children,(0,l.tZ)(i.Z,{css:e.className},(0,l.tZ)(o.Z,{title:e.post_frontmatter.title,description:e.post_frontmatter.description}),(0,l.tZ)(r.Z,{post_frontmatter:e.post_frontmatter}),t)}},2770:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return mr},frontmatter:function(){return cr}});n(7294);var i,a,r,o,l,s,u,c,d,m,f,p,v,b,h,_,g,w,y,x,k,Z,j,A,M,C,T,D,P,G,S,L,I,z,E,q,N,O,V,B,W,F,U,R,Y,H,Q,J,K,X,$,ee,te,ne,ie,ae,re,oe,le,se,ue,ce,de,me,fe,pe,ve,be,he,_e,ge,we,ye,xe,ke,Ze,je,Ae,Me,Ce,Te,De,Pe,Ge,Se,Le,Ie,ze,Ee,qe,Ne,Oe,Ve,Be,We,Fe,Ue,Re,Ye,He,Qe,Je,Ke,Xe,$e,et,tt,nt,it,at,rt,ot,lt,st,ut,ct,dt,mt,ft=n(2465),pt=n(2137),vt=n(8481),bt=n(7757),ht=n.n(bt);function _t(e){return e(i||(i=(0,ft.Z)(["| <h3>Friends & Family:</h3>  |   |\n|---|---|\n| **[@mbostock/form-input](/@mbostock/form-input)**  | Fully custom forms, combining inputs into a single reactive cell. |\n| **[@zechasault/color-schemes-and-interpolators-picker](/@zechasault/color-schemes-and-interpolators-picker)**  | Color scheme and interoplation pickers. |\n| **[@mootari/range-slider](https://observablehq.com/@mootari/range-slider)**  |  True range sliders, setting both a minimum and maximum value. |\n| **[@bumbeishvili/data-driven-range-sliders](/@bumbeishvili/data-driven-range-sliders)** | Data-driven range sliders, displaying a distribution histogram of the underlying data. |\n| **[@trebor/snapping-histogram-slider](/@trebor/snapping-histogram-slider)** | Another data-driven range slider option. |\n| **[@mootari’s 2D Slider](https://observablehq.com/d/98bbb19bf9e859ee)** | Two dimensional sliders, exploring discrete points on a plane. |\n| **[@yurivish/ternary-slider](/@yurivish/ternary-slider)** | Nifty ternary plot inputs, describing the percentages of a whole composed of exactly three things. |\n\n\n<br>*If you have any improvements for the bazaar, [please make your change in a fork and send it to me as a suggestion.](https://observablehq.com/@observablehq/suggestions-and-comments)*"])))}function gt(e){return e(a||(a=(0,ft.Z)(['---\n## Sliders\n\n~~~js\nimport {slider} from "@jashkenas/inputs"\n~~~'])))}function wt(e){return e()}function yt(e){return e({min:0,max:1,step:.01,format:".0%",description:"Zero to one, formatted as a percentage"})}function xt(e){return e({min:0,max:1,step:.01,format:function(e){return"".concat(Math.round(100*e)," per cent")},description:"Zero to one, formatted with a custom function"})}function kt(e){return e({min:0,max:1e9,step:1e3,value:325e4,format:",",description:"Zero to one billion, in steps of one thousand, formatted as a (US) number"})}function Zt(e){return e({min:0,max:100,step:1,value:10,title:"Integers",description:"Integers from zero through 100"})}function jt(e){return e({min:.9,max:1.1,precision:3,description:"A high precision slider example"})}function At(e){return e({min:.9,max:1.1,precision:3,submit:!0,description:"The same as a4, but only changes value on submit"})}function Mt(e){return e(r||(r=(0,ft.Z)(["More [fancy slider techniques](https://beta.observablehq.com/@mootari/prime-numbers-slider)."])))}function Ct(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="number"==typeof t?{value:t}:t,i=n.min,a=void 0===i?0:i,r=n.max,o=void 0===r?1:r,l=n.value,s=void 0===l?(o+a)/2:l,u=n.step,c=void 0===u?"any":u,d=n.precision,m=void 0===d?2:d,f=n.title,p=n.description,v=n.getValue,b=n.format,h=n.display,_=n.submit;return m=Math.pow(10,m),v||(v=function(e){return Math.round(e.valueAsNumber*m)/m}),e({type:"range",title:f,description:p,submit:_,format:b,display:h,attributes:{min:a,max:o,step:c,value:s},getValue:v})}}function Tt(e){return e(o||(o=(0,ft.Z)(['---\n## Buttons\n\n~~~js\nimport {button} from "@jashkenas/inputs"\n~~~'])))}function Dt(e){return e()}function Pt(e){return!this}function Gt(e){return e({value:"Click me",description:"We use a reference to the button below to record the time you pressed it."})}function St(e){return new Date(Date.now()).toUTCString()}function Lt(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="string"==typeof t?{value:t}:t,i=n.value,a=void 0===i?"Ok":i,r=n.title,o=n.description,l=n.disabled,s=e({type:"button",title:r,description:o,attributes:{disabled:l,value:a}});return s.output.remove(),s}}function It(e){return e(l||(l=(0,ft.Z)(['---\n## Dropdown Menus and Multiselects\n\n~~~js\nimport {select} from "@jashkenas/inputs"\n~~~'])))}function zt(e){return e(["Spring","Summer","Fall","Winter"])}function Et(e){return e}function qt(e){return e({title:"Stooges",description:"Please pick your favorite stooge.",options:["Curly","Larry","Moe","Shemp"],value:"Moe"})}function Nt(e){return e}function Ot(e){return e({description:"As a child, which vegetables did you refuse to eat?",options:["Spinach","Broccoli","Brussels Sprouts","Cauliflower","Kale","Turnips","Green Beans","Asparagus"],multiple:!0})}function Vt(e){return e}function Bt(e){var t=e({title:"How are you feeling today?",options:[{label:"🤷",value:"shrug"},{label:"😂",value:"tears-of-joy"},{label:"😍",value:"loving-it"},{label:"🤔",value:"hmmm"},{label:"😱",value:"yikes"},{label:"😈",value:"mischievous"},{label:"💩",value:"poo"}],value:"hmmm"});return t.input.style.fontSize="30px",t.input.style.marginTop="8px",t}function Wt(e){return e}function Ft(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Array.isArray(n)?{options:n}:n,a=i.value,r=i.title,o=i.description,l=i.submit,c=i.multiple,d=i.size,m=i.options;m=m.map((function(e){return"object"==typeof e?e:{value:e,label:e}}));var f=e({type:"select",title:r,description:o,submit:l,getValue:function(e){var t=Array.prototype.filter.call(e.options,(function(e){return e.selected})).map((function(e){return e.value}));return c?t:t[0]},form:t(s||(s=(0,ft.Z)(['\n      <form>\n        <select name="input" ',">\n          ","\n        </select>\n      </form>\n    "])),c?'multiple size="'.concat(d||m.length,'"'):"",m.map((function(e){var n=e.value,i=e.label;return Object.assign(t(u||(u=(0,ft.Z)(["<option>"]))),{value:n,selected:Array.isArray(a)?a.includes(n):a===n,textContent:i})})))});return f.output.remove(),f}}function Ut(e){return e(c||(c=(0,ft.Z)(['---\n## Autoselects\n*A variant of an option menu, using an autocompleting text input, via HTML’s datalist element.* \n\n~~~js\nimport {autoSelect} from "@jashkenas/inputs"\n~~~'])))}function Rt(e,t){return e({options:t.objects.states.geometries.map((function(e){return e.properties.name})),placeholder:"Search for a US state . . ."})}function Yt(e){return e}function Ht(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Array.isArray(n)?{options:n}:n,a=i.value,r=i.title,o=i.description,l=(i.autocomplete,i.placeholder),s=(i.size,i.options),u=i.list,c=void 0===u?"options":u,f=new Set(s),p=e({type:"text",title:r,description:o,action:function(e){e.value=e.input.value=a||"",e.onsubmit=function(e){return e.preventDefault()},e.input.oninput=function(t){t.stopPropagation(),e.value=e.input.value,f.has(e.input.value)&&e.dispatchEvent(new CustomEvent("input"))}},form:t(d||(d=(0,ft.Z)(['\n      <form>\n         <input name="input" type="text" autocomplete="off" \n          placeholder="','" style="font-size: 1em;" list=','>\n          <datalist id="','">\n              ',"\n          </datalist>\n      </form>\n      "])),l,c,c,s.map((function(e){return Object.assign(t(m||(m=(0,ft.Z)(["<option>"]))),{value:e})})))});return p.output.remove(),p}}function Qt(e){return e(f||(f=(0,ft.Z)(['---\n## Color Pickers\n\n*value: a hexadecimal string, e.g. * `"#bada55"` \n\n~~~js\nimport {color} from "@jashkenas/inputs"\n~~~'],['---\n## Color Pickers\n\n*value: a hexadecimal string, e.g. * \\`"#bada55"\\` \n\n~~~js\nimport {color} from "@jashkenas/inputs"\n~~~'])))}function Jt(e){return e()}function Kt(e){return e({value:"#0000ff",title:"Background Color",description:"This color picker starts out blue"})}function Xt(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="string"==typeof t?{value:t}:t,i=n.value,a=void 0===i?"#000000":i,r=n.title,o=n.description,l=n.submit,s=n.display,u=e({type:"color",title:r,description:o,submit:l,display:s,attributes:{value:a}});return(r||o)&&(u.input.style.margin="5px 0"),u}}function $t(e){return e(p||(p=(0,ft.Z)([' ---\n## Coordinates\n\n*value: an array pair of `[longitude, latitude]`, e.g. * `[-122.27, 37.87]` \n\n~~~js\nimport {coordinates} from "@jashkenas/inputs"\n~~~'],[' ---\n## Coordinates\n\n*value: an array pair of \\`[longitude, latitude]\\`, e.g. * \\`[-122.27, 37.87]\\` \n\n~~~js\nimport {coordinates} from "@jashkenas/inputs"\n~~~'])))}function en(e){return e()}function tn(e){return e}function nn(e){return e({title:"Hometown",description:"Enter the coordinates of where you were born",value:[-122.27,37.87],submit:!0})}function an(e){return e}function rn(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Array.isArray(n)?{value:n}:n,a=i.value,r=void 0===a?[]:a,o=i.title,l=i.description,s=i.submit,u=(0,vt.Z)(r,2),c=u[0],d=u[1];c=null!=c?c:"",d=null!=d?d:"";var m=e(v||(v=(0,ft.Z)(['<input name="input" type="number" autocomplete="off" min="-180" max="180" style="width: 80px;" step="any" value="','" />'])),c),f=e(b||(b=(0,ft.Z)(['<input name="input" type="number" autocomplete="off" min="-90" max="90" style="width: 80px;" step="any" value="','" />'])),d),p=t({type:"coordinates",title:o,description:l,submit:s,getValue:function(){var e=m.valueAsNumber,t=f.valueAsNumber;return[isNaN(e)?null:e,isNaN(t)?null:t]},form:e(h||(h=(0,ft.Z)(['\n      <form>\n        <label style="display: inline-block; font: 600 0.8rem sans-serif; margin: 6px 0 0;">\n          <span style="display: inline-block; width: 70px;">Longitude:</span>\n          ','\n        </label>\n        <br>\n        <label style="display: inline-block; font: 600 0.8rem sans-serif; margin: 0 0 6px;">\n          <span style="display: inline-block; width: 70px;">Latitude:</span>\n          ',"\n        </label>\n      </form>\n    "])),m,f)});return p.output.remove(),p}}function on(e){return e(_||(_=(0,ft.Z)([' ---\n## World Map Coordinates\n\n*value: an array pair of `[longitude, latitude]`, e.g. * `[-122.27, 37.87]` \n\n~~~js\nimport {worldMapCoordinates} from "@jashkenas/inputs"\n~~~'],[' ---\n## World Map Coordinates\n\n*value: an array pair of \\`[longitude, latitude]\\`, e.g. * \\`[-122.27, 37.87]\\` \n\n~~~js\nimport {worldMapCoordinates} from "@jashkenas/inputs"\n~~~'])))}function ln(e){return e([-122.27,37.87])}function sn(e){return e}function un(e,t,n,i,a,r,o){return function(){var l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=Array.isArray(l)?{value:l}:l,u=s.value,c=void 0===u?[]:u,d=s.title,m=s.description,f=s.width,p=void 0===f?400:f,v=Math.round(.525*p),b=(0,vt.Z)(c,2),h=b[0],_=b[1];h=null!=h?h:null,_=null!=_?_:null;var y=e(g||(g=(0,ft.Z)(['<form style="width: ','px;"></form>'])),p),x=t.context2d(p,v),k=x.canvas;k.style.margin="10px 0 0";var Z=n.geoNaturalEarth1().precision(.1).fitSize([p,v],{type:"Sphere"}),j=n.geoPath(Z,x).pointRadius(2.5);function A(){if(x.fillStyle="#fff",x.fillRect(0,0,p,v),x.beginPath(),j(i),x.lineWidth=.35,x.strokeStyle="#ddd",x.stroke(),x.beginPath(),j(a),x.fillStyle="#f4f4f4",x.fill(),x.beginPath(),j(r),x.strokeStyle="#aaa",x.stroke(),null!=h&&null!=_){var e={type:"MultiPoint",coordinates:[[h,_]]};x.beginPath(),j(e),x.fillStyle="#f00",x.fill()}}y.append(k),k.onclick=function(e){var t=e.offsetX,n=e.offsetY,i=Z.invert([t,n]);h=+i[0].toFixed(2),_=+i[1].toFixed(2),A(),k.dispatchEvent(new CustomEvent("input",{bubbles:!0}))},A();var M=o({type:"worldMapCoordinates",title:d,description:m,display:function(t){return e(w||(w=(0,ft.Z)(['<div style="position: absolute; width: ','px; white-space: nowrap; color: #444; text-align: center; font: 13px sans-serif; margin-top: -18px;">\n            <span style="color: #777;">Longitude:</span> ','\n            &nbsp; &nbsp; \n            <span style="color: #777;">Latitude:</span> '," \n          </div>"])),p,null!=h?h:"",null!=_?_:"")},getValue:function(){return[null!=h?h:null,null!=_?_:null]},form:y});return M}}function cn(e){return e(y||(y=(0,ft.Z)([' ---\n## U.S.A. Map Coordinates\n\n*value: an array pair of `[longitude, latitude]`, e.g. * `[-122.27, 37.87]` \n\n~~~js\nimport {usaMapCoordinates} from "@jashkenas/inputs"\n~~~'],[' ---\n## U.S.A. Map Coordinates\n\n*value: an array pair of \\`[longitude, latitude]\\`, e.g. * \\`[-122.27, 37.87]\\` \n\n~~~js\nimport {usaMapCoordinates} from "@jashkenas/inputs"\n~~~'])))}function dn(e){return e([-122.27,37.87])}function mn(e){return e}function fn(e){return e({title:"A Mini Map",description:"Defaults to New York City",width:200,value:[-74,40.71]})}function pn(e){return e}function vn(e,t,n,i,a,r){return function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=Array.isArray(o)?{value:o}:o,s=l.value,u=void 0===s?[]:s,c=l.title,d=l.description,m=l.width,f=void 0===m?400:m,p=f/960,v=600*p,b=(0,vt.Z)(u,2),h=b[0],_=b[1];h=null!=h?h:null,_=null!=_?_:null;var g=e(x||(x=(0,ft.Z)(['<form style="width: ','px;"></form>'])),f),w=t.context2d(f,v),y=w.canvas;y.style.margin="5px 0 0";var Z=n.geoAlbersUsa().scale(1280).translate([480,300]),j=n.geoPath().context(w).pointRadius(2.5/p);function A(){if(w.clearRect(0,0,f,v),w.save(),w.scale(p,p),w.lineWidth=.35/p,w.beginPath(),j(i),w.fillStyle="#f4f4f4",w.fill(),w.beginPath(),j(a),w.strokeStyle="#aaa",w.stroke(),null!=h&&null!=_){var e={type:"MultiPoint",coordinates:[Z([h,_])]};w.beginPath(),j(e),w.fillStyle="#f00",w.fill()}w.restore()}g.append(y),y.onclick=function(e){var t=e.offsetX,n=e.offsetY,i=Z.invert([t/p,n/p]);h=+i[0].toFixed(2),_=+i[1].toFixed(2),A(),y.dispatchEvent(new CustomEvent("input",{bubbles:!0}))},A();var M=r({type:"worldMapCoordinates",title:c,description:d,display:function(t){return e(k||(k=(0,ft.Z)(['<div style="position: absolute; width: ','px; white-space: nowrap; color: #444; text-align: center; font: 13px sans-serif; margin-top: -18px;">\n            <span style="color: #777;">Longitude:</span> ','\n            &nbsp; &nbsp; \n            <span style="color: #777;">Latitude:</span> '," \n          </div>"])),f,null!=h?h:"",null!=_?_:"")},getValue:function(){return[null!=h?h:null,null!=_?_:null]},form:g});return M}}function bn(e){return e(Z||(Z=(0,ft.Z)([' ---\n## Dates\n\n*value: a YYYY-MM-DD formatted string: * `"2016-11-08"` \n\n~~~js\nimport {date} from "@jashkenas/inputs"\n~~~'],[' ---\n## Dates\n\n*value: a YYYY-MM-DD formatted string: * \\`"2016-11-08"\\` \n\n~~~js\nimport {date} from "@jashkenas/inputs"\n~~~'])))}function hn(e){return e()}function _n(e){return e({title:"2017",min:"2017-01-01",max:"2017-12-31",value:"2017-01-01",description:"Only dates within the 2017 calendar year are allowed"})}function gn(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="string"==typeof t?{value:t}:t,i=n.min,a=n.max,r=n.value,o=n.title,l=n.description,s=n.display;return e({type:"date",title:o,description:l,display:s,attributes:{min:i,max:a,value:r}})}}function wn(e){return e(j||(j=(0,ft.Z)([' ---\n## Times\n\n*value: a HH:MM:SS formatted string: * `"09:30:45"`\n<br>*(Time values are always in 24-hour format)*\n\n~~~js\nimport {time} from "@jashkenas/inputs"\n~~~'],[' ---\n## Times\n\n*value: a HH:MM:SS formatted string: * \\`"09:30:45"\\`\n<br>*(Time values are always in 24-hour format)*\n\n~~~js\nimport {time} from "@jashkenas/inputs"\n~~~'])))}function yn(e){return e()}function xn(e){return e}function kn(e){return e({title:"Afternoon",min:"12:00:00",max:"23:59:59",value:"13:00:00",step:1,description:"Only times after noon are allowed, and seconds are included"})}function Zn(e){return e}function jn(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="string"==typeof t?{value:t}:t,i=n.min,a=n.max,r=n.step,o=n.value,l=n.title,s=n.description,u=n.display,c=e({type:"time",title:l,description:s,display:u,getValue:function(e){return e.value?e.value:void 0},attributes:{min:i,max:a,step:r,value:o}});return c.output.remove(),c}}function An(e){return e(A||(A=(0,ft.Z)(['---\n## File Upload\n*Use the JavaScript [File API](https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications) to work with uploaded file contents.*\n\n`import {file} from "@jashkenas/inputs"`'],['---\n## File Upload\n*Use the JavaScript [File API](https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications) to work with uploaded file contents.*\n\n\\`import {file} from "@jashkenas/inputs"\\`'])))}function Mn(e){return e()}function Cn(e){return e({title:"Photographs",description:"Only .jpg files are allowed in this example. Choose some images, and they’ll appear in the cell below.",accept:".jpg",multiple:!0})}function Tn(e,t,n){return Dn.apply(this,arguments)}function Dn(){return(Dn=(0,pt.Z)(ht().mark((function e(t,n,i){var a,r,o;return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t(Q||(Q=(0,ft.Z)(["<div>"]))),r=0;case 2:if(!(r<n.length)){e.next=12;break}return n[r],o=t(J||(J=(0,ft.Z)(['<img height="125px" style="margin: 2px;" />']))),e.next=7,i.url(n[r]);case 7:o.src=e.sent,a.append(o);case 9:r++,e.next=2;break;case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pn(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.multiple,i=t.accept,a=t.title,r=t.description,o=e({type:"file",title:a,description:r,attributes:{multiple:n,accept:i},action:function(e){e.input.onchange=function(){e.value=n?e.input.files:e.input.files[0],e.dispatchEvent(new CustomEvent("input"))}}});return o.output.remove(),o.input.onchange(),o}}function Gn(e){return e(M||(M=(0,ft.Z)(['---\n## Text Inputs\n\n~~~js\nimport {text} from "@jashkenas/inputs"\n~~~'])))}function Sn(e){return e()}function Ln(e){return e({title:"A Text Input",placeholder:"Placeholder text",description:"Note that text inputs don’t show output on the right"})}function In(e){return e}function zn(e){return e({placeholder:"Placeholder text",description:"This input only changes value on submit",submit:"Go"})}function En(e){return e}function qn(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="string"==typeof t?{value:t}:t,i=n.value,a=n.title,r=n.description,o=n.autocomplete,l=void 0===o?"off":o,s=n.maxlength,u=n.minlength,c=n.pattern,d=n.placeholder,m=n.size,f=n.submit,p=e({type:"text",title:a,description:r,submit:f,attributes:{value:i,autocomplete:l,maxlength:s,minlength:u,pattern:c,placeholder:d,size:m}});return p.output.remove(),p.input.style.fontSize="1em",p}}function Nn(e){return e(C||(C=(0,ft.Z)(['---\n## Textareas\n\n~~~js\nimport {textarea} from "@jashkenas/inputs"\n~~~'])))}function On(e){return e()}function Vn(e){return e}function Bn(e){return e({title:"Your Great American Novel",placeholder:"Insert story here...",spellcheck:!0,width:"100%",rows:10,submit:"Publish"})}function Wn(e){return e}function Fn(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i="string"==typeof n?{value:n}:n,a=i.value,r=void 0===a?"":a,o=i.title,l=i.description,s=i.autocomplete,u=i.cols,c=void 0===u?45:u,d=i.rows,m=void 0===d?3:d,f=i.width,p=i.height,v=i.maxlength,b=i.placeholder,h=i.spellcheck,_=i.wrap,g=i.submit,w=e({form:t(T||(T=(0,ft.Z)(['<form><textarea style="display: block; font-size: 0.8em;" name=input>',"</textarea></form>"])),r),title:o,description:l,submit:g,attributes:{autocomplete:s,cols:c,rows:m,maxlength:v,placeholder:b,spellcheck:h,wrap:_}});return w.output.remove(),null!=f&&(w.input.style.width=f),null!=p&&(w.input.style.height=p),g&&(w.submit.style.margin="0"),(o||l)&&(w.input.style.margin="3px 0"),w}}function Un(e){return e(D||(D=(0,ft.Z)(['---\n## Radio Buttons\n\n~~~js\nimport {radio} from "@jashkenas/inputs"\n~~~'])))}function Rn(e){return e(["Lust","Gluttony","Greed","Sloth","Wrath","Envy","Pride"])}function Yn(e){return e}function Hn(e){return e({title:"Contact Us",description:"Please select your preferred contact method",options:[{label:"By Email",value:"email"},{label:"By Phone",value:"phone"},{label:"By Pager",value:"pager"}],value:"pager"})}function Qn(e){return e}function Jn(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Array.isArray(n)?{options:n}:n,a=i.value,r=i.title,o=i.description,l=i.submit,s=i.options;s=s.map((function(e){return"string"==typeof e?{value:e,label:e}:e}));var u=e({type:"radio",title:r,description:o,submit:l,getValue:function(e){if(e.checked)return e.value;var t=Array.prototype.find.call(e,(function(e){return e.checked}));return t?t.value:void 0},form:t(P||(P=(0,ft.Z)(["\n      <form>\n        ","\n      </form>\n    "])),s.map((function(e){var n=e.value,i=e.label,r=t(G||(G=(0,ft.Z)(["<input type=radio name=input ",' style="vertical-align: baseline;" />'])),n===a?"checked":"");return r.setAttribute("value",n),t(S||(S=(0,ft.Z)(['\n          <label style="display: inline-block; margin: 5px 10px 3px 0; font-size: 0.85em;">\n           ',"\n           ","\n          </label>"])),r,i)})))});return u.output.remove(),u}}function Kn(e){return e(L||(L=(0,ft.Z)(['---\n## Checkboxes\n\n~~~js\nimport {checkbox} from "@jashkenas/inputs"\n~~~'])))}function Xn(e){return e(["Lust","Gluttony","Greed","Sloth","Wrath","Envy","Pride"])}function $n(e){return e}function ei(e){return e({title:"Colors",description:"Please select your favorite colors",options:[{value:"r",label:"Red"},{value:"o",label:"Orange"},{value:"y",label:"Yellow"},{value:"g",label:"Green"},{value:"b",label:"Blue"},{value:"i",label:"Indigo"},{value:"v",label:"Violet"}],value:["r","g","b"],submit:!0})}function ti(e){return e}function ni(e){return e({description:"Just a single checkbox to toggle",options:[{value:"toggle",label:"On"}],value:"toggle"})}function ii(e){return e}function ai(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Array.isArray(n)?{options:n}:n,a=i.value,r=i.title,o=i.description,l=i.submit,s=i.options;s=s.map((function(e){return"string"==typeof e?{value:e,label:e}:e}));var u=e({type:"checkbox",title:r,description:o,submit:l,getValue:function(e){return e.length?Array.prototype.filter.call(e,(function(e){return e.checked})).map((function(e){return e.value})):!!e.checked&&e.value},form:t(I||(I=(0,ft.Z)(["\n      <form>\n        ","\n      </form>\n    "])),s.map((function(e){var n=e.value,i=e.label,r=t(z||(z=(0,ft.Z)(["<input type=checkbox name=input ",' style="vertical-align: baseline;" />'])),(a||[]).indexOf(n)>-1?"checked":"");return r.setAttribute("value",n),t(E||(E=(0,ft.Z)(['<label style="display: inline-block; margin: 5px 10px 3px 0; font-size: 0.85em;">\n           ',"\n           ","\n          </label>"])),r,i)})))});return u.output.remove(),u}}function ri(e){return e(q||(q=(0,ft.Z)(['---\n## Numbers\n\n~~~js\nimport {number} from "@jashkenas/inputs"\n~~~'])))}function oi(e){return e()}function li(e){return e}function si(e){return e({placeholder:"13+",title:"Your Age",submit:!0})}function ui(e){return e}function ci(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="number"==typeof t||"string"==typeof t?{value:+t}:t,i=n.value,a=n.title,r=n.description,o=n.placeholder,l=n.submit,s=n.step,u=void 0===s?"any":s,c=n.min,d=n.max,m=e({type:"number",title:a,description:r,submit:l,attributes:{value:i,placeholder:o,step:u,min:c,max:d,autocomplete:"off"},getValue:function(e){return e.valueAsNumber}});return m.output.remove(),m.input.style.width="auto",m.input.style.fontSize="1em",m}}function di(e){return e(N||(N=(0,ft.Z)(['---\n## Passwords\n\n~~~js\nimport {password} from "@jashkenas/inputs"\n~~~'])))}function mi(e){return e({value:"password"})}function fi(e){return e}function pi(e){return e({title:"Your super secret password",description:"Less than 12 characters, please.",minlength:6,maxlength:12})}function vi(e){return e}function bi(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="string"==typeof t?{value:t}:t,i=n.value,a=n.title,r=n.description,o=n.autocomplete,l=void 0===o?"off":o,s=n.maxlength,u=n.minlength,c=n.pattern,d=n.placeholder,m=n.size,f=n.submit,p=e({type:"password",title:a,description:r,submit:f,attributes:{value:i,autocomplete:l,maxlength:s,minlength:u,pattern:c,placeholder:d,size:m}});return p.output.remove(),p.input.style.fontSize="1em",p}}function hi(e){return e(O||(O=(0,ft.Z)(["---\n## Wishlist (Send suggestions, please!)\n\n* 2D coordinate input (using an &lt;svg>)\n* 3D coordinate input (for say, positioning a camera in a WebGL sketch)\n* Geocoder search with location autocomplete that returns longitude and latitude.\n* Degrees or radians input, for circular things, or angles.\n* A dimensions input, or a box-model input, with margin (and optionally, padding).\n* A map-projection-picker input, rendering little thumbnails of all the d3-geo-projections.\n* Other useful formatting options.\n\n---"])))}function _i(e,t){return function(n){var i=n.form,a=n.type,r=void 0===a?"text":a,o=n.attributes,l=void 0===o?{}:o,s=n.action,u=n.getValue,c=n.title,d=n.description,m=n.format,f=n.display,p=n.submit,v=(n.options,e(V||(V=(0,ft.Z)(["<div></div>"]))));if(i||(i=e(B||(B=(0,ft.Z)(["<form>\n\t<input name=input type="," />\n  </form>"])),r)),Object.keys(l).forEach((function(e){var t=l[e];null!=t&&i.input.setAttribute(e,t)})),p&&i.append(e(W||(W=(0,ft.Z)(['<input name=submit type=submit style="margin: 0 0.75em" value="','" />'])),"string"==typeof p?p:"Submit")),i.append(e(F||(F=(0,ft.Z)(['<output name=output style="font: 14px Menlo, Consolas, monospace; margin-left: 0.5em;"></output>'])))),c&&i.prepend(e(U||(U=(0,ft.Z)(['<div style="font: 700 0.9rem sans-serif;">',"</div>"])),c)),d&&i.append(e(R||(R=(0,ft.Z)(['<div style="font-size: 0.85rem; font-style: italic;">',"</div>"])),d)),m&&(m="function"==typeof m?m:t.format(m)),s)s(i);else{var b=p?"onsubmit":"button"==r?"onclick":"checkbox"==r||"radio"==r?"onchange":"oninput";i[b]=function(e){e&&e.preventDefault();var t=u?u(i.input):i.input.value;if(i.output){var n=f?f(t):m?m(t):t;if(n instanceof window.Element){for(;i.output.hasChildNodes();)i.output.removeChild(i.output.lastChild);i.output.append(n)}else i.output.value=n}i.value=t,"oninput"!==b&&i.dispatchEvent(new CustomEvent("input",{bubbles:!0}))},"oninput"!==b&&(v.oninput=function(e){return e&&e.stopPropagation()&&e.preventDefault()}),"onsubmit"!==b&&(i.onsubmit=function(e){return e&&e.preventDefault()}),i[b]()}for(;i.childNodes.length;)v.appendChild(i.childNodes[0]);return i.append(v),i}}function gi(e){return e("d3-geo@1")}function wi(e){return e("d3-format@1")}function yi(e){return e("topojson-client@3")}function xi(){return ki.apply(this,arguments)}function ki(){return(ki=(0,pt.Z)(ht().mark((function e(){return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://cdn.jsdelivr.net/npm/world-atlas@1/world/110m.json");case 2:return e.abrupt("return",e.sent.json());case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zi(e,t){return e.feature(t,t.objects.land)}function ji(e,t){return e.feature(t,t.objects.countries)}function Ai(){return Mi.apply(this,arguments)}function Mi(){return(Mi=(0,pt.Z)(ht().mark((function e(){return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://cdn.jsdelivr.net/npm/us-atlas@^2.1/us/states-10m.json");case 2:return e.abrupt("return",e.sent.json());case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ci(e,t){return e.feature(t,t.objects.nation)}function Ti(e,t){return e.feature(t,t.objects.states)}function Di(e){return e.geoGraticule10()}function Pi(e){var t=e(Y||(Y=(0,ft.Z)(["License: [MIT](https://opensource.org/licenses/MIT)"])));return t.value="MIT",t}function Gi(e){return e(H||(H=(0,ft.Z)(["*Clip art courtesy [ClipArt ETC](https://etc.usf.edu/clipart/), radio buttons and checkboxes courtesy [Amit Sch](https://beta.observablehq.com/@meetamit/multiple-choice-inputs).*"])))}function Si(e,t){var n=e.module();return n.variable(t()).define(["md"],_t),n.variable(t("sliderDemo")).define("sliderDemo",["md"],gt),n.variable(t("viewof a")).define("viewof a",["slider"],wt),n.variable(t("a")).define("a",["Generators","viewof a"],(function(e,t){return e.input(t)})),n.variable(t("viewof a1")).define("viewof a1",["slider"],yt),n.variable(t("a1")).define("a1",["Generators","viewof a1"],(function(e,t){return e.input(t)})),n.variable(t("viewof a1_1")).define("viewof a1_1",["slider"],xt),n.variable(t("a1_1")).define("a1_1",["Generators","viewof a1_1"],(function(e,t){return e.input(t)})),n.variable(t("viewof a2")).define("viewof a2",["slider"],kt),n.variable(t("a2")).define("a2",["Generators","viewof a2"],(function(e,t){return e.input(t)})),n.variable(t("viewof a3")).define("viewof a3",["slider"],Zt),n.variable(t("a3")).define("a3",["Generators","viewof a3"],(function(e,t){return e.input(t)})),n.variable(t("viewof a4")).define("viewof a4",["slider"],jt),n.variable(t("a4")).define("a4",["Generators","viewof a4"],(function(e,t){return e.input(t)})),n.variable(t("viewof a5")).define("viewof a5",["slider"],At),n.variable(t("a5")).define("a5",["Generators","viewof a5"],(function(e,t){return e.input(t)})),n.variable(t()).define(["md"],Mt),n.variable(t("slider")).define("slider",["input"],Ct),n.variable(t("buttonDemo")).define("buttonDemo",["md"],Tt),n.variable(t("viewof b")).define("viewof b",["button"],Dt),n.variable(t("b")).define("b",["Generators","viewof b"],(function(e,t){return e.input(t)})),n.variable(t()).define(["b"],Pt),n.variable(t("viewof b1")).define("viewof b1",["button"],Gt),n.variable(t("b1")).define("b1",["Generators","viewof b1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["b1"],St),n.variable(t("button")).define("button",["input"],Lt),n.variable(t("selectDemo")).define("selectDemo",["md"],It),n.variable(t("viewof dd")).define("viewof dd",["select"],zt),n.variable(t("dd")).define("dd",["Generators","viewof dd"],(function(e,t){return e.input(t)})),n.variable(t()).define(["dd"],Et),n.variable(t("viewof dd1")).define("viewof dd1",["select"],qt),n.variable(t("dd1")).define("dd1",["Generators","viewof dd1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["dd1"],Nt),n.variable(t("viewof dd2")).define("viewof dd2",["select"],Ot),n.variable(t("dd2")).define("dd2",["Generators","viewof dd2"],(function(e,t){return e.input(t)})),n.variable(t()).define(["dd2"],Vt),n.variable(t("viewof dd3")).define("viewof dd3",["select"],Bt),n.variable(t("dd3")).define("dd3",["Generators","viewof dd3"],(function(e,t){return e.input(t)})),n.variable(t()).define(["dd3"],Wt),n.variable(t("select")).define("select",["input","html"],Ft),n.variable(t("autoSelectDemo")).define("autoSelectDemo",["md"],Ut),n.variable(t("viewof as")).define("viewof as",["autoSelect","usa"],Rt),n.variable(t("as")).define("as",["Generators","viewof as"],(function(e,t){return e.input(t)})),n.variable(t()).define(["as"],Yt),n.variable(t("autoSelect")).define("autoSelect",["input","html"],Ht),n.variable(t("colorDemo")).define("colorDemo",["md"],Qt),n.variable(t("viewof c")).define("viewof c",["color"],Jt),n.variable(t("c")).define("c",["Generators","viewof c"],(function(e,t){return e.input(t)})),n.variable(t("viewof c1")).define("viewof c1",["color"],Kt),n.variable(t("c1")).define("c1",["Generators","viewof c1"],(function(e,t){return e.input(t)})),n.variable(t("color")).define("color",["input"],Xt),n.variable(t("coordinatesDemo")).define("coordinatesDemo",["md"],$t),n.variable(t("viewof coords1")).define("viewof coords1",["coordinates"],en),n.variable(t("coords1")).define("coords1",["Generators","viewof coords1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["coords1"],tn),n.variable(t("viewof coords2")).define("viewof coords2",["coordinates"],nn),n.variable(t("coords2")).define("coords2",["Generators","viewof coords2"],(function(e,t){return e.input(t)})),n.variable(t()).define(["coords2"],an),n.variable(t("coordinates")).define("coordinates",["html","input"],rn),n.variable(t("worldMapCoordinatesDemo")).define("worldMapCoordinatesDemo",["md"],on),n.variable(t("viewof worldMap1")).define("viewof worldMap1",["worldMapCoordinates"],ln),n.variable(t("worldMap1")).define("worldMap1",["Generators","viewof worldMap1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["worldMap1"],sn),n.variable(t("worldMapCoordinates")).define("worldMapCoordinates",["html","DOM","d3geo","graticule","land","countries","input"],un),n.variable(t("usaMapCoordinatesDemo")).define("usaMapCoordinatesDemo",["md"],cn),n.variable(t("viewof usaMap1")).define("viewof usaMap1",["usaMapCoordinates"],dn),n.variable(t("usaMap1")).define("usaMap1",["Generators","viewof usaMap1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["usaMap1"],mn),n.variable(t("viewof usaMap2")).define("viewof usaMap2",["usaMapCoordinates"],fn),n.variable(t("usaMap2")).define("usaMap2",["Generators","viewof usaMap2"],(function(e,t){return e.input(t)})),n.variable(t()).define(["usaMap2"],pn),n.variable(t("usaMapCoordinates")).define("usaMapCoordinates",["html","DOM","d3geo","nation","states","input"],vn),n.variable(t("dateDemo")).define("dateDemo",["md"],bn),n.variable(t("viewof d")).define("viewof d",["date"],hn),n.variable(t("d")).define("d",["Generators","viewof d"],(function(e,t){return e.input(t)})),n.variable(t("viewof d1")).define("viewof d1",["date"],_n),n.variable(t("d1")).define("d1",["Generators","viewof d1"],(function(e,t){return e.input(t)})),n.variable(t("date")).define("date",["input"],gn),n.variable(t("timeDemo")).define("timeDemo",["md"],wn),n.variable(t("viewof t")).define("viewof t",["time"],yn),n.variable(t("t")).define("t",["Generators","viewof t"],(function(e,t){return e.input(t)})),n.variable(t()).define(["t"],xn),n.variable(t("viewof t1")).define("viewof t1",["time"],kn),n.variable(t("t1")).define("t1",["Generators","viewof t1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["t1"],Zn),n.variable(t("time")).define("time",["input"],jn),n.variable(t("fileDemo")).define("fileDemo",["md"],An),n.variable(t("viewof e")).define("viewof e",["file"],Mn),n.variable(t("e")).define("e",["Generators","viewof e"],(function(e,t){return e.input(t)})),n.variable(t("viewof e1")).define("viewof e1",["file"],Cn),n.variable(t("e1")).define("e1",["Generators","viewof e1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["html","e1","Files"],Tn),n.variable(t("file")).define("file",["input"],Pn),n.variable(t("textDemo")).define("textDemo",["md"],Gn),n.variable(t("viewof f")).define("viewof f",["text"],Sn),n.variable(t("f")).define("f",["Generators","viewof f"],(function(e,t){return e.input(t)})),n.variable(t("viewof f1")).define("viewof f1",["text"],Ln),n.variable(t("f1")).define("f1",["Generators","viewof f1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["f1"],In),n.variable(t("viewof f2")).define("viewof f2",["text"],zn),n.variable(t("f2")).define("f2",["Generators","viewof f2"],(function(e,t){return e.input(t)})),n.variable(t()).define(["f2"],En),n.variable(t("text")).define("text",["input"],qn),n.variable(t("textareaDemo")).define("textareaDemo",["md"],Nn),n.variable(t("viewof g")).define("viewof g",["textarea"],On),n.variable(t("g")).define("g",["Generators","viewof g"],(function(e,t){return e.input(t)})),n.variable(t()).define(["g"],Vn),n.variable(t("viewof g1")).define("viewof g1",["textarea"],Bn),n.variable(t("g1")).define("g1",["Generators","viewof g1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["g1"],Wn),n.variable(t("textarea")).define("textarea",["input","html"],Fn),n.variable(t("radioDemo")).define("radioDemo",["md"],Un),n.variable(t("viewof r")).define("viewof r",["radio"],Rn),n.variable(t("r")).define("r",["Generators","viewof r"],(function(e,t){return e.input(t)})),n.variable(t()).define(["r"],Yn),n.variable(t("viewof r1")).define("viewof r1",["radio"],Hn),n.variable(t("r1")).define("r1",["Generators","viewof r1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["r1"],Qn),n.variable(t("radio")).define("radio",["input","html"],Jn),n.variable(t("checkboxDemo")).define("checkboxDemo",["md"],Kn),n.variable(t("viewof ch")).define("viewof ch",["checkbox"],Xn),n.variable(t("ch")).define("ch",["Generators","viewof ch"],(function(e,t){return e.input(t)})),n.variable(t()).define(["ch"],$n),n.variable(t("viewof ch1")).define("viewof ch1",["checkbox"],ei),n.variable(t("ch1")).define("ch1",["Generators","viewof ch1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["ch1"],ti),n.variable(t("viewof ch3")).define("viewof ch3",["checkbox"],ni),n.variable(t("ch3")).define("ch3",["Generators","viewof ch3"],(function(e,t){return e.input(t)})),n.variable(t()).define(["ch3"],ii),n.variable(t("checkbox")).define("checkbox",["input","html"],ai),n.variable(t("numberDemo")).define("numberDemo",["md"],ri),n.variable(t("viewof h")).define("viewof h",["number"],oi),n.variable(t("h")).define("h",["Generators","viewof h"],(function(e,t){return e.input(t)})),n.variable(t()).define(["h"],li),n.variable(t("viewof h1")).define("viewof h1",["number"],si),n.variable(t("h1")).define("h1",["Generators","viewof h1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["h1"],ui),n.variable(t("number")).define("number",["input"],ci),n.variable(t("passwordDemo")).define("passwordDemo",["md"],di),n.variable(t("viewof i")).define("viewof i",["password"],mi),n.variable(t("i")).define("i",["Generators","viewof i"],(function(e,t){return e.input(t)})),n.variable(t()).define(["i"],fi),n.variable(t("viewof i1")).define("viewof i1",["password"],pi),n.variable(t("i1")).define("i1",["Generators","viewof i1"],(function(e,t){return e.input(t)})),n.variable(t()).define(["i1"],vi),n.variable(t("password")).define("password",["input"],bi),n.variable(t()).define(["md"],hi),n.variable(t("input")).define("input",["html","d3format"],_i),n.variable(t("d3geo")).define("d3geo",["require"],gi),n.variable(t("d3format")).define("d3format",["require"],wi),n.variable(t("topojson")).define("topojson",["require"],yi),n.variable(t("world")).define("world",xi),n.variable(t("land")).define("land",["topojson","world"],Zi),n.variable(t("countries")).define("countries",["topojson","world"],ji),n.variable(t("usa")).define("usa",Ai),n.variable(t("nation")).define("nation",["topojson","usa"],Ci),n.variable(t("states")).define("states",["topojson","usa"],Ti),n.variable(t("graticule")).define("graticule",["d3geo"],Di),n.variable(t("viewof license")).define("viewof license",["md"],Pi),n.variable(t("license")).define("license",["Generators","viewof license"],(function(e,t){return e.input(t)})),n.variable(t()).define(["md"],Gi),n}function Li(e){return e(K||(K=(0,ft.Z)(["# Vega-Lite API v4"])))}function Ii(e){return e(X||(X=(0,ft.Z)(["The [Vega-Lite JavaScript API](https://github.com/vega/vega-lite-api/) provides a convenient way to write [Vega-Lite](https://vega.github.io/vega-lite) specifications in a programmatic fashion. Scroll down for some usage examples, or browse the [Vega-Lite API example collection](https://observablehq.com/collection/@vega/vega-lite-api)!\n\nThis notebook uses **version 4** of Vega-Lite and the corresponding Vega-Lite API 4.0. _To use the more recent Vega-Lite version 5, see the [Vega-Lite API v5 notebook](https://observablehq.com/@vega/vega-lite-api-v5) instead._\n\nWant to learn more about data visualization and how to use the Vega-Lite API? Read the [introduction to Vega-Lite](https://observablehq.com/@uwdata/introduction-to-vega-lite) and the [data visualization curriculum](https://observablehq.com/@uwdata/data-visualization-curriculum?collection=@uwdata/visualization-curriculum)."])))}function zi(e){return e($||($=(0,ft.Z)(["\nThe cell below imports the Vega-Lite API and registers the desired versions of Vega and Vega-Lite, along with default [Vega View options](https://vega.github.io/vega/docs/api/view/#view) and [Vega-Lite configuration](https://vega.github.io/vega-lite/docs/config.html):\n"])))}function Ei(e){return qi.apply(this,arguments)}function qi(){return(qi=(0,pt.Z)(ht().mark((function e(t){var n,i,a,r,o,l,s;return ht().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(["vega@5.19.1","vega-lite@4.17.0","vega-lite-api@4.0.0","vega-tooltip@0.25.1"].map((function(e){return t(e)})));case 2:return n=e.sent,i=(0,vt.Z)(n,4),a=i[0],r=i[1],o=i[2],l=i[3],s={config:{config:{view:{continuousWidth:400,continuousHeight:300},mark:{tooltip:null}}},init:function(e){e.tooltip((new l.Handler).call),e.container()&&(e.container().style["overflow-x"]="auto")},view:{loader:a.loader({baseURL:"https://cdn.jsdelivr.net/npm/vega-datasets@2/"}),renderer:"canvas"}},e.abrupt("return",o.register(a,r,s));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ni(e){return e(ee||(ee=(0,ft.Z)(["To use the same setup in your own notebooks, add a cell with the following code:\n~~~ js\nimport {vl} from '@vega/vega-lite-api'\n~~~\nTo use the API outside of Observable, see the [stand-alone usage instructions](#standalone_use) below.\n"])))}function Oi(e){return e(te||(te=(0,ft.Z)(["## Zip Codes\n\nA dot for each zip code in the United States, colored by the first digit.\n"])))}function Vi(e,t){return e.markSquare({size:2,opacity:1}).data("data/zipcodes.csv").transform(e.calculate("substring(datum.zip_code, 0, 1)").as("digit")).project(e.projection("albersUsa")).encode(e.longitude().fieldQ("longitude"),e.latitude().fieldQ("latitude"),e.color().fieldN("digit")).width(t).height(Math.floor(t/1.75)).autosize({type:"fit-x",contains:"padding"}).config({view:{stroke:null}}).render()}function Bi(e){return e(ne||(ne=(0,ft.Z)(["## Interactive Seattle Weather 2012-2015\n\nA scatter plot and summary histogram with linked `selections` between plots to perform cross-filtering and configure conditional color encodings.\n"],["## Interactive Seattle Weather 2012-2015\n\nA scatter plot and summary histogram with linked \\`selections\\` between plots to perform cross-filtering and configure conditional color encodings.\n"])))}function Wi(e,t){var n=e.selectInterval().encodings("x"),i=e.selectMulti().encodings("color"),a={domain:["sun","fog","drizzle","rain","snow"],range:["#e7ba52","#a7a7a7","#aec7e8","#1f77b4","#9467bd"]},r=e.markPoint({filled:!0}).encode(e.color().value("lightgray").if(n,e.color().fieldN("weather").scale(a).title("Weather")),e.size().fieldQ("precipitation").scale({domain:[-1,50],range:[10,500]}).title("Precipitation"),e.order().fieldQ("precipitation").sort("descending"),e.x().timeMD("date").axis({title:"Date",format:"%b"}),e.y().fieldQ("temp_max").scale({domain:[-5,40]}).axis({title:"Maximum Daily Temperature (°C)"})).width(t).height(300).select(n).transform(e.filter(i)),o=e.markBar().encode(e.color().value("lightgray").if(i,e.color().fieldN("weather").scale(a).title("Weather")),e.x().count(),e.y().fieldN("weather").scale({domain:a.domain}).title("Weather")).width(t).select(i).transform(e.filter(n));return e.vconcat(r,o).data("data/seattle-weather.csv").autosize({type:"fit-x",contains:"padding"}).render()}function Fi(e){return e(ie||(ie=(0,ft.Z)(["## Parallel Coordinates\n\nA [parallel coordinates plot](https://en.wikipedia.org/wiki/Parallel_coordinates) that uses `window` and `fold` transforms to convert the four dimensions of penguin measurements into normalized coordinates that can be visualized as `line` marks. The graphic includes an additional layer with custom `text` mark labels for the parallel axis grid lines. We render the plot as SVG by passing `{renderer:'svg'}` to the `render` method.\n"],["## Parallel Coordinates\n\nA [parallel coordinates plot](https://en.wikipedia.org/wiki/Parallel_coordinates) that uses \\`window\\` and \\`fold\\` transforms to convert the four dimensions of penguin measurements into normalized coordinates that can be visualized as \\`line\\` marks. The graphic includes an additional layer with custom \\`text\\` mark labels for the parallel axis grid lines. We render the plot as SVG by passing \\`{renderer:'svg'}\\` to the \\`render\\` method.\n"])))}function Ui(e,t){var n=e.markLine({strokeWidth:1.5,opacity:.5}).encode(e.color().fieldN("Species").sort("descending"),e.detail().fieldN("index"),e.x().fieldO("key").scale({type:"point",padding:0}).axis({domain:!1,ticks:!1,title:!1,grid:!0,gridColor:"#888",labelAngle:0,labelPadding:8,labelFontWeight:"bold"}),e.y().fieldQ("fraction").axis(null)),i=e.markText({dx:-2,align:"right",baseline:"middle"}).transform(e.groupby("key").aggregate(e.min("value").as("min"),e.max("value").as("max")),e.fold("min","max").as("op","value"),e.groupby("key").window(e.percent_rank("value").as("fraction"))).encode(e.x().fieldN("key"),e.y().fieldQ("fraction").axis(null),e.text().field("value").format(","));return e.layer(n,i).data("data/penguins.json").transform(e.filter('datum["Beak Length (mm)"] != null'),e.window(e.row_number().as("index")),e.fold(["Beak Length (mm)","Beak Depth (mm)","Flipper Length (mm)","Body Mass (g)"]).as("key","value"),e.groupby("key").join(e.min("value").as("min"),e.max("value").as("max")),e.calculate("(datum.value - datum.min) / (datum.max - datum.min)").as("fraction")).width(t).height(300).autosize({type:"fit-x",contains:"padding"}).render({renderer:"svg"})}function Ri(e){return e(ae||(ae=(0,ft.Z)(['<hr/>\n## Stand-Alone Usage in a Web Browser\n\nTo use the Vega-Lite API in the browser outside of Observable, you need to include all the dependencies, set the default configuration, and then register the Vega libraries. Here is some starting code to build from:\n\n~~~html\n<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <script src="https://cdn.jsdelivr.net/npm/vega@5"><\/script>\n    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"><\/script>\n    <script src="https://cdn.jsdelivr.net/npm/vega-lite-api@4"><\/script>\n    <script src="https://cdn.jsdelivr.net/npm/vega-tooltip"><\/script>\n  </head>\n  <body>\n    <div id="view"></div>\n\n    <script>\n      // setup API options\n      const options = {\n        config: {\n          // Vega-Lite default configuration\n        },\n        init: (view) => {\n          // initialize tooltip handler\n          view.tooltip(new vegaTooltip.Handler().call);\n        },\n        view: {\n          // view constructor options\n          // remove the loader if you don\'t want to default to vega-datasets!\n          loader: vega.loader({\n            baseURL: "https://cdn.jsdelivr.net/npm/vega-datasets@2/",\n          }),\n          renderer: "canvas",\n        },\n      };\n\n      // register vega and vega-lite with the API\n      vl.register(vega, vegaLite, options);\n\n      // now you can use the API!\n      vl.markBar({ tooltip: true })\n        .data([\n          { a: "A", b: 28 }, { a: "B", b: 55 }, { a: "C", b: 43 },\n          { a: "D", b: 91 }, { a: "E", b: 81 }, { a: "F", b: 53 },\n          { a: "G", b: 19 }, { a: "H", b: 87 }, { a: "I", b: 52 },\n        ])\n        .encode(\n          vl.x().fieldQ("b"),\n          vl.y().fieldN("a"),\n          vl.tooltip([vl.fieldQ("b"), vl.fieldN("a")])\n        )\n        .render()\n        .then(viewElement => {\n          // render returns a promise to a DOM element containing the chart\n          // viewElement.value contains the Vega View object instance\n          document.getElementById(\'view\').appendChild(viewElement);\n        });\n    <\/script>\n  </body>\n</html>\n\n~~~'])))}function Yi(e,t){var n=e.module();return n.variable(t()).define(["md"],Li),n.variable(t()).define(["md"],Ii),n.variable(t()).define(["md"],zi),n.variable(t("vl")).define("vl",["require"],Ei),n.variable(t()).define(["md"],Ni),n.variable(t("zip_codes")).define("zip_codes",["md"],Oi),n.variable(t()).define(["vl","width"],Vi),n.variable(t("interactive_weather")).define("interactive_weather",["md"],Bi),n.variable(t()).define(["vl","width"],Wi),n.variable(t("parallel_coordinats")).define("parallel_coordinats",["md"],Fi),n.variable(t()).define(["vl","width"],Ui),n.variable(t("standalone_use")).define("standalone_use",["md"],Ri),n}function Hi(e){return e(re||(re=(0,ft.Z)(["# Unsupervised probabalistic data matching using the Expectation Maximisation algorithm"])))}function Qi(e){return e(oe||(oe=(0,ft.Z)(["This notebook is an interactive implementation of the Fellegi-Sunter model of record linkage, with record linkage probabilities estimated using the Expectation Maximisation (EM) algorithm.  \n\nThis is an unsupervised approach to finding matching records, which seems like magic to me - so hopefully this notebook helps demystify how this is possible.\n"])))}function Ji(e){return e(le||(le=(0,ft.Z)(["## Input data\n\nConsider two tables, which we are trying to match to one another.   `mob` stands for month of birth.\n**Note**: You can edit this data so long as you keep the column names the same.\n\n"],["## Input data\n\nConsider two tables, which we are trying to match to one another.   \\`mob\\` stands for month of birth.\n**Note**: You can edit this data so long as you keep the column names the same.\n\n"])))}function Ki(e){return e(se||(se=(0,ft.Z)(["**Left table:**"])))}function Xi(e,t){return e({value:t,rows:6,width:"100%"})}function $i(e,t,n){return e(ue||(ue=(0,ft.Z)(["",""])),t(n))}function ea(e){return e(ce||(ce=(0,ft.Z)(["**Right table:**"])))}function ta(e,t){return e({value:t,rows:6,width:"100%"})}function na(e,t,n){return e(de||(de=(0,ft.Z)(["\n\n","\n\n\n"])),t(n))}function ia(e){return e(me||(me=(0,ft.Z)(["**Real matches**\n\nThese are the records which match in reality. You only need to include records which match, i.e. where label = 1.  These are the unknowns the model is trying to estimate \n"])))}function aa(e,t){return e({value:t,rows:6,width:"100%"})}function ra(e,t,n,i,a){return e(fe||(fe=(0,ft.Z)(["","\n\n","\n\n\n\nFinally, here are all the possible record comparisons:\n\n",""])),t(pe||(pe=(0,ft.Z)(["<br>"]))),n(i),n(a))}function oa(e,t,n,i){return e(ve||(ve=(0,ft.Z)(["To set this up as a maximum likelihood estimation problem, we need to make some assumptions about the structure of the problem, and choose some parameters to estimate.\n\nFirst, we will designate λ the proportion of comparisons which are matches.  This is an unknown parameter to be estimated.  In the case of this data, the true λ is ",".\n\nNext, we will create the concept of a _comparison vector_, which is a way of encoding record comparisons into a vector.  \n\nIn this simple example our comparison vector, "," will be of length "," , i.e. "," and will encode the following two rules:\n\n- If `mob` matches,  "," else ","\n- If `surname` matches exactly  ",". If it is similar ",".  Otherwise ","\n\n\nWe will then assume that element "," of the comparison vector is a draw from one of two discrete distributions:\n\n",", the discrete distribution of "," when the records match\n\nand \n\n\n",", the discrete distribution of "," when the records do not match\n\n"],["To set this up as a maximum likelihood estimation problem, we need to make some assumptions about the structure of the problem, and choose some parameters to estimate.\n\nFirst, we will designate λ the proportion of comparisons which are matches.  This is an unknown parameter to be estimated.  In the case of this data, the true λ is ",".\n\nNext, we will create the concept of a _comparison vector_, which is a way of encoding record comparisons into a vector.  \n\nIn this simple example our comparison vector, "," will be of length "," , i.e. "," and will encode the following two rules:\n\n- If \\`mob\\` matches,  "," else ","\n- If \\`surname\\` matches exactly  ",". If it is similar ",".  Otherwise ","\n\n\nWe will then assume that element "," of the comparison vector is a draw from one of two discrete distributions:\n\n",", the discrete distribution of "," when the records match\n\nand \n\n\n",", the discrete distribution of "," when the records do not match\n\n"])),t(n),i(be||(be=(0,ft.Z)(["gamma"],["\\gamma"]))),i(he||(he=(0,ft.Z)(["k=2"]))),i(_e||(_e=(0,ft.Z)(["gamma = [gamma_1, gamma_2]"],["\\gamma = [\\gamma_1, \\gamma_2]"]))),i(ge||(ge=(0,ft.Z)(["gamma_1 = 1"],["\\gamma_1 = 1"]))),i(we||(we=(0,ft.Z)(["gamma_1 = 0"],["\\gamma_1 = 0"]))),i(ye||(ye=(0,ft.Z)(["gamma_2 = 1"],["\\gamma_2 = 1"]))),i(xe||(xe=(0,ft.Z)(["gamma_2 = 0.5"],["\\gamma_2 = 0.5"]))),i(ke||(ke=(0,ft.Z)(["gamma_2 = 0"],["\\gamma_2 = 0"]))),i(Ze||(Ze=(0,ft.Z)(["i"]))),i(je||(je=(0,ft.Z)(["pi_{i,m=1}"],["\\pi_{i,m=1}"]))),i(Ae||(Ae=(0,ft.Z)(["gamma_i"],["\\gamma_i"]))),i(Me||(Me=(0,ft.Z)(["pi_{i,m=0}"],["\\pi_{i,m=0}"]))),i(Ce||(Ce=(0,ft.Z)(["gamma_i"],["\\gamma_i"]))))}function la(e,t,n){return e(Te||(Te=(0,ft.Z)([" Here are the comparison vectors for this data:\n\n","\n\nEach row represents the comparison vector, which has two elements [𝛾1, 𝛾2].  \n\n"])),t(n))}function sa(e,t){return e(De||(De=(0,ft.Z)(["These assumptions are all we need to define the equation for the likelihood.  The equation looks quite complicated (see page 356 [here](https://imai.fas.harvard.edu/research/files/linkage.pdf)):\n\n","\n\nBut expressed in words it's quite simple - approximately:\n\n- For each element of the comparison vector, the probability of the observed outcome is ","\n- Compute this probability for each of the "," elements of the comparison vector in the row, and multiply together.  This represents the likelihood of the row\n- Compute this for each row, and multiply together\n\n"])),t(Pe||(Pe=(0,ft.Z)(["prod_{i=1}^{N_{mathcal{A}}} prod_{j=1}^{N_{mathcal{B}}}left{sum_{m=0}^{1} lambda^{m}(1-lambda)^{1-m} prod_{k=1}^{K}left(prod_{ell=0}^{L_{k}-1} pi_{k m ell}^{1left{gamma_{k}(i, j)=ell\right}}\right)^{1-delta_{k}(i, j)}\right}"],["\\prod_{i=1}^{N_{\\mathcal{A}}} \\prod_{j=1}^{N_{\\mathcal{B}}}\\left\\{\\sum_{m=0}^{1} \\lambda^{m}(1-\\lambda)^{1-m} \\prod_{k=1}^{K}\\left(\\prod_{\\ell=0}^{L_{k}-1} \\pi_{k m \\ell}^{1\\left\\{\\gamma_{k}(i, j)=\\ell\\right\\}}\\right)^{1-\\delta_{k}(i, j)}\\right\\}"]))),t(Ge||(Ge=(0,ft.Z)(["lambda (pi_{i,m=1}|gamma_i)  + (1-lambda) (pi_{i,m=0}|gamma_i)"],["\\lambda (\\pi_{i,m=1}|\\gamma_i)  + (1-\\lambda) (\\pi_{i,m=0}|\\gamma_i)"]))),t(Se||(Se=(0,ft.Z)(["k"]))))}function ua(e,t){return e(Le||(Le=(0,ft.Z)(["To estimate which record comparisons are matches, we need to estimate the unknown parameters, which are "," and the parameters of the four discrete distributions ",".\n\nThere's an algorithm called the Expectation Maximisation algorithm which can solve this problem iteratively.\n\nIn this notebook, rather than implement this algorithm, we will simply let you choose the parameters to try and maximise the log likelihood manually.  \n\n## Estimating matches"])),t(Ie||(Ie=(0,ft.Z)(["lambda"],["\\lambda"]))),t(ze||(ze=(0,ft.Z)(["pi_{i,m}"],["\\pi_{i,m}"]))))}function ca(e){return e({title:"Choose λ, the proportion of combinations which are matches",min:0,max:1,step:.01,value:.5})}function da(e){return e({title:"Month of birth comparison, probability month of birth matches given m=1",min:0,max:1,step:.01,value:.5})}function ma(e){return e({title:"Month of birth comparison, probability month of birth matches given records DO NOT match",min:0,max:1,step:.01,value:.5})}function fa(e){return e({title:"Surname comparison, probability field exactly matches given records match",min:0,max:1,step:.01,value:.3})}function pa(e){return e({title:"Surname comparison, probability fields similar given records match",min:0,max:1,step:.01,value:.3})}function va(e){return e({title:"Surname comparison, probability field exactly matches given records DO NOT match",min:0,max:1,step:.01,value:.3})}function ba(e){return e({title:"Surname comparison, probability fields similar given records DO NOT match",min:0,max:1,step:.01,value:.3})}function ha(e,t,n){return e(Ee||(Ee=(0,ft.Z)(["The log likelihood given these parameters is ",""])),t(n))}function _a(e){return e(qe||(qe=(0,ft.Z)(["Here's a history of the values of log likelihood as you've been adjusting the sliders:"])))}function ga(e,t,n){var i=t.map((function(e,t){return{log_likelihood:e.log_likelihood,i:t}}));return i=i.filter((function(e){return e.log_likelihood>-1e6})),n.markLine().data(i).encode(n.y().field("log_likelihood").type("quantitative").scale({zero:!1}),n.x().field("i").type("quantitative")).height(200).render()}function wa(e,t){return e(Ne||(Ne=(0,ft.Z)(["This chart shows "," and ",", the discrete distributions that you've chosen for ",", the `mob` comparison vector."],["This chart shows "," and ",", the discrete distributions that you've chosen for ",", the \\`mob\\` comparison vector."])),t(Oe||(Oe=(0,ft.Z)(["pi_{1,m=0}"],["\\pi_{1,m=0}"]))),t(Ve||(Ve=(0,ft.Z)(["pi_{1,m=1}"],["\\pi_{1,m=1}"]))),t(Be||(Be=(0,ft.Z)(["gamma_1"],["\\gamma_1"]))))}function ya(e,t,n){var i=[{"𝛾_val":"1",probability:e,m:1,rule:"mob"},{"𝛾_val":"0",probability:1-e,m:1,rule:"mob"},{"𝛾_val":"1",probability:t,m:0,rule:"mob"},{"𝛾_val":"0",probability:1-t,m:0,rule:"mob"}];return n.markBar().data(i).encode(n.y().field("𝛾_val").type("nominal"),n.x().field("probability").type("quantitative"),n.column().fieldN("m").title(null),n.color().fieldN("m")).height(30).width(100).render()}function xa(e,t){return e(We||(We=(0,ft.Z)(["This chart shows "," and ",", the discrete distributions you've chosen for ",", the `surname` comparison vector."],["This chart shows "," and ",", the discrete distributions you've chosen for ",", the \\`surname\\` comparison vector."])),t(Fe||(Fe=(0,ft.Z)(["pi_{2,m=0}"],["\\pi_{2,m=0}"]))),t(Ue||(Ue=(0,ft.Z)(["pi_{2,m=1}"],["\\pi_{2,m=1}"]))),t(Re||(Re=(0,ft.Z)(["gamma_2"],["\\gamma_2"]))))}function ka(e,t,n,i,a){var r=[{"𝛾_val":"1",probability:e,m:1,rule:"surname"},{"𝛾_val":"0.5",probability:t,m:1,rule:"surname"},{"𝛾_val":"0",probability:1-e-t,m:1,rule:"surname"},{"𝛾_val":"1",probability:n,m:0,rule:"surname"},{"𝛾_val":"0.5",probability:i,m:0,rule:"surname"},{"𝛾_val":"0",probability:1-n-i,m:0,rule:"surname"}];return a.markBar().data(r).encode(a.y().field("𝛾_val").type("nominal"),a.x().field("probability").type("quantitative"),a.column().fieldN("m").title(null),a.color().fieldN("m")).height(30).width(100).render()}function Za(e,t,n){return e(Ye||(Ye=(0,ft.Z)(["Given the parameter values you've selected, we can now compute the probability that we have a match for each record comparison, ",".\n\nWe can write the probabilities of observing "," given our parameters, and whether the record is a match:\n\n","\n\n","\n\n","\n\n","\n\n","\n\n","\n\n","\n\n\nThe probability of a given record being a match is then:\n\n",".\n"])),t(He||(He=(0,ft.Z)(["P(m)"]))),t(Qe||(Qe=(0,ft.Z)(["gamma_i"],["\\gamma_i"]))),t(Je||(Je=(0,ft.Z)(["p1 = lambda P(gamma_1|pi_{1,m=1})"],["p1 = \\lambda P(\\gamma_1|\\pi_{1,m=1})"]))),n(Ke||(Ke=(0,ft.Z)(["<br>"]))),t(Xe||(Xe=(0,ft.Z)(["p2 = lambda P(gamma_2|pi_{2,m=1}) "],["p2 = \\lambda P(\\gamma_2|\\pi_{2,m=1}) "]))),n($e||($e=(0,ft.Z)(["<br>"]))),t(et||(et=(0,ft.Z)(["n1 = (1-lambda) P(gamma_2|pi_{2,m=0}) "],["n1 = (1-\\lambda) P(\\gamma_2|\\pi_{2,m=0}) "]))),n(tt||(tt=(0,ft.Z)(["<br>"]))),t(nt||(nt=(0,ft.Z)(["n2 = (1-lambda) P(gamma_2|pi_{2,m=0}) "],["n2 = (1-\\lambda) P(\\gamma_2|\\pi_{2,m=0}) "]))),t(it||(it=(0,ft.Z)(["\frac{p1 p2}{p1 p2 + n1 n2} = \frac{1}{1 + \frac{n1 n2}{p1 p2}}"],["\\frac{p1 p2}{p1 p2 + n1 n2} = \\frac{1}{1 + \\frac{n1 n2}{p1 p2}}"]))))}function ja(e,t,n,i,a,r){var o=e.map((function(e){var r=t(e);return(e=n(e))["𝛾1"]=r["𝛾1"],e["𝛾2"]=r["𝛾2"],e.prob_match=i(a(e)),e}));return o.columns=Object.keys(o[0]),r(o)}function Aa(e){return e(at||(at=(0,ft.Z)(['## Annex: Code\n\nThis is the code I used to compute the log likelihood:\n\n```javascript\n{\n function log_probability_of_element_of_gamma(elem, pi) {\n    let prob =  lambda * pi["1"][elem] + (1-lambda) * pi["0"][elem]\n    return Math.log(prob)\n  }\n  \n  function log_probability_of_comparison(comparison_vector) {\n    let elem = comparison_vector["𝛾1"]\n    let ln_prob_1 = log_probability_of_element_of_gamma(elem, pi_mob)\n    \n    elem = comparison_vector["𝛾2"]\n    let ln_prob_2 = log_probability_of_element_of_gamma(elem, pi_surname)\n    \n    return ln_prob_1 + ln_prob_2\n  }\n  \n  let log_probs_of_rows = comparison_vectors.map(cv => log_probability_of_comparison(cv))\n  \n  return log_probs_of_rows.reduce((a,b) => a + b)\n}\n```\n\nand the code to compute the probability of a match:\n\n\n```javascript \nget_estimated_match_probability = function(comparison_vector) {\n  let gamma1 = comparison_vector["𝛾1"]\n  let gamma2 = comparison_vector["𝛾2"]\n  \n  let prob_match_1 = lambda * pi_mob["1"][gamma1]\n  let prob_no_match_1 = (1-lambda) * pi_mob["0"][gamma1]\n  let sum_1 = prob_match_1 + prob_no_match_1\n\n  \n  let prob_match_2 = lambda * pi_surname["1"][gamma1] \n  let prob_no_match_2 = (1-lambda) * pi_surname["0"][gamma1]\n  let sum_2 = prob_match_2 + prob_no_match_2\n  \n  // Is the following calculation correct?\n  let lr = (prob_match_1 * prob_match_2) / (prob_match_1*prob_match_2 + prob_no_match_1*prob_no_match_2)  \n  \n  return lr\n \n}\n```\n\n'],['## Annex: Code\n\nThis is the code I used to compute the log likelihood:\n\n\\`\\`\\`javascript\n{\n function log_probability_of_element_of_gamma(elem, pi) {\n    let prob =  lambda * pi["1"][elem] + (1-lambda) * pi["0"][elem]\n    return Math.log(prob)\n  }\n  \n  function log_probability_of_comparison(comparison_vector) {\n    let elem = comparison_vector["𝛾1"]\n    let ln_prob_1 = log_probability_of_element_of_gamma(elem, pi_mob)\n    \n    elem = comparison_vector["𝛾2"]\n    let ln_prob_2 = log_probability_of_element_of_gamma(elem, pi_surname)\n    \n    return ln_prob_1 + ln_prob_2\n  }\n  \n  let log_probs_of_rows = comparison_vectors.map(cv => log_probability_of_comparison(cv))\n  \n  return log_probs_of_rows.reduce((a,b) => a + b)\n}\n\\`\\`\\`\n\nand the code to compute the probability of a match:\n\n\n\\`\\`\\`javascript \nget_estimated_match_probability = function(comparison_vector) {\n  let gamma1 = comparison_vector["𝛾1"]\n  let gamma2 = comparison_vector["𝛾2"]\n  \n  let prob_match_1 = lambda * pi_mob["1"][gamma1]\n  let prob_no_match_1 = (1-lambda) * pi_mob["0"][gamma1]\n  let sum_1 = prob_match_1 + prob_no_match_1\n\n  \n  let prob_match_2 = lambda * pi_surname["1"][gamma1] \n  let prob_no_match_2 = (1-lambda) * pi_surname["0"][gamma1]\n  let sum_2 = prob_match_2 + prob_no_match_2\n  \n  // Is the following calculation correct?\n  let lr = (prob_match_1 * prob_match_2) / (prob_match_1*prob_match_2 + prob_no_match_1*prob_no_match_2)  \n  \n  return lr\n \n}\n\\`\\`\\`\n\n'])))}function Ma(){return"row_id_l,mob_l,surname_l\n1,10,Linacre\n2,7,Smith\n"}function Ca(){return"row_id_r,mob_r,surname_r\n1,10,Linacer\n2,8,Jones\n3,7,Smith\n"}function Ta(e,t,n){return e.value=[],t.csvParse(n)}function Da(e,t,n){return e.value=[],t.csvParse(n)}function Pa(){return"row_id_l,row_id_r,label\n1,1,1\n2,3,1\n"}function Ga(e,t,n){return e.value=[],t.csvParse(n)}function Sa(e,t,n){t("DROP TABLE if exists combinations");var i=t("select * from df_l\n  cross join df_r\n  left join matches as m\n  on df_l.row_id_l = m.row_id_l and df_r.row_id_r = m.row_id_r\n  ");return i=i.map((function(e){return e.label||(e.label="0"),e})),t("CREATE TABLE combinations"),t.tables.combinations.data=i,n("\n  select * from combinations\n\n")}function La(e){return e(rt||(rt=(0,ft.Z)(["### Annex 2:  Computation of comparison vectors"])))}function Ia(e,t){return function(n){return{"𝛾1":e(n),"𝛾2":t(n)}}}function za(){return function(e){return+(e.mob_l==e.mob_r)}}function Ea(e){return function(t){return t.surname_l==t.surname_r?1:e.get(t.surname_l,t.surname_r)<3?.5:0}}function qa(e,t){var n=e.map((function(e){return t(e)}));return n.columns=Object.keys(n[0]),n}function Na(e,t){return t("\n\nselect df_l.row_id_l, df_r.row_id_r \nfrom df_l\n  cross join df_r\n  left join matches as m\non df_l.row_id_l = m.row_id_l and df_r.row_id_r = m.row_id_r\nwhere m.label = '1'\n\n")}function Oa(e){return e.filter((function(e){return 1==e.match})).map((function(e){return delete e.match,e}))}function Va(e){return e(ot||(ot=(0,ft.Z)(["### Annex 3:  Likelihood and probability calculations"])))}function Ba(e,t){return t("\n select count(*) as count_match\nfrom combinations\n where label = '1' \n")/t("\nselect count(*) from combinations\n")}function Wa(e,t,n,i){return{1:{1:e,.5:t,0:1-e-t},0:{1:n,.5:i,0:1-n-i}}}function Fa(e,t){return{1:{1:e,0:1-e},0:{1:t,0:1-t}}}function Ua(e,t,n){return function(i){var a=i["𝛾1"],r=(i["𝛾2"],e*t[1][a]),o=(1-e)*t[0][a],l=e*n[1][a],s=(1-e)*n[0][a];return r*l/(r*l+o*s)}}function Ra(e,t,n,i){function a(t,n){var i=e*n[1][t]+(1-e)*n[0][t];return Math.log(i)}return i.map((function(e){return a((i=e)["𝛾1"],t)+a(i["𝛾2"],n);var i})).reduce((function(e,t){return e+t}))}function Ya(e){return e(lt||(lt=(0,ft.Z)(["### Annex 4: Other functions"])))}function Ha(){return[]}function Qa(e,t){e.push({log_likelihood:t})}function Ja(e,t,n,i){var a=e("DROP TABLE if exists df_l");return e("CREATE TABLE df_l"),e("DROP TABLE if exists df_r"),e("CREATE TABLE df_r"),e("DROP TABLE if exists matches"),e("CREATE TABLE matches"),e.tables.df_l.data=t,e.tables.df_r.data=n,e.tables.matches.data=i,a}function Ka(e){return e(st||(st=(0,ft.Z)(["### Generic utility libraries and functions"])))}function Xa(e){return function(t){var n=e(t);return n.columns=Object.keys(n[0]),n}}function $a(e){return function(t){return e(ut||(ut=(0,ft.Z)(["\n<table>\n<thead>\n<tr>\n","\n<tbody>\n","\n"])),t.columns.map((function(t){return e(ct||(ct=(0,ft.Z)(["<th>",""])),t)})),t.map((function(t){return e(dt||(dt=(0,ft.Z)(["<tr>\n  ","\n"])),Object.keys(t).map((function(n){return e(mt||(mt=(0,ft.Z)(["<td>",""])),t[n])})))})))}}function er(e){return e("alasql")}function tr(e){return function(t){var n=e(t);return(n=n[0])[Object.keys(n)[0]]}}function nr(e){return e("d3")}function ir(e){return e.format(",.3f")}function ar(e){return e("fast-levenshtein@2.0.6")}function rr(e){return e("@observablehq/vega-lite@0.2")}function or(){return function(e){return JSON.parse(JSON.stringify(e))}}function lr(e,t){var n=e.module();n.variable(t("title")).define("title",["md"],Hi),n.variable(t("out_1")).define("out_1",["md"],Qi),n.variable(t("out_2")).define("out_2",["md"],Ji),n.variable(t("out_3")).define("out_3",["md"],Ki),n.variable(t("viewof left_table_csv")).define("viewof left_table_csv",["textarea","data_left_template"],Xi),n.variable(t("left_table_csv")).define("left_table_csv",["Generators","viewof left_table_csv"],(function(e,t){return e.input(t)})),n.variable(t("out_4")).define("out_4",["md","table","data_left"],$i),n.variable(t("out_5")).define("out_5",["md"],ea),n.variable(t("viewof right_table_csv")).define("viewof right_table_csv",["textarea","data_right_template"],ta),n.variable(t("right_table_csv")).define("right_table_csv",["Generators","viewof right_table_csv"],(function(e,t){return e.input(t)})),n.variable(t("out_6")).define("out_6",["md","table","data_right"],na),n.variable(t("out_7")).define("out_7",["md"],ia),n.variable(t("viewof match_pairs_csv")).define("viewof match_pairs_csv",["textarea","match_pairs_template"],aa),n.variable(t("match_pairs_csv")).define("match_pairs_csv",["Generators","viewof match_pairs_csv"],(function(e,t){return e.input(t)})),n.variable(t("out_8")).define("out_8",["md","html","table","match_pairs","combinations"],ra),n.variable(t("out_9")).define("out_9",["md","num_fmt","true_lambda","tex"],oa),n.variable(t("out_10")).define("out_10",["md","table","comparison_vectors"],la),n.variable(t("out_11")).define("out_11",["md","tex"],sa),n.variable(t("out_12")).define("out_12",["md","tex"],ua),n.variable(t("viewof lambda")).define("viewof lambda",["slider"],ca),n.variable(t("lambda")).define("lambda",["Generators","viewof lambda"],(function(e,t){return e.input(t)})),n.variable(t("viewof pi1_1_m1")).define("viewof pi1_1_m1",["slider"],da),n.variable(t("pi1_1_m1")).define("pi1_1_m1",["Generators","viewof pi1_1_m1"],(function(e,t){return e.input(t)})),n.variable(t("viewof pi1_1_m0")).define("viewof pi1_1_m0",["slider"],ma),n.variable(t("pi1_1_m0")).define("pi1_1_m0",["Generators","viewof pi1_1_m0"],(function(e,t){return e.input(t)})),n.variable(t("viewof pi2_1_m1")).define("viewof pi2_1_m1",["slider"],fa),n.variable(t("pi2_1_m1")).define("pi2_1_m1",["Generators","viewof pi2_1_m1"],(function(e,t){return e.input(t)})),n.variable(t("viewof pi2_05_m1")).define("viewof pi2_05_m1",["slider"],pa),n.variable(t("pi2_05_m1")).define("pi2_05_m1",["Generators","viewof pi2_05_m1"],(function(e,t){return e.input(t)})),n.variable(t("viewof pi2_1_m0")).define("viewof pi2_1_m0",["slider"],va),n.variable(t("pi2_1_m0")).define("pi2_1_m0",["Generators","viewof pi2_1_m0"],(function(e,t){return e.input(t)})),n.variable(t("viewof pi2_05_m0")).define("viewof pi2_05_m0",["slider"],ba),n.variable(t("pi2_05_m0")).define("pi2_05_m0",["Generators","viewof pi2_05_m0"],(function(e,t){return e.input(t)})),n.variable(t("out_13")).define("out_13",["md","num_fmt","log_likelihood"],ha),n.variable(t("out_14")).define("out_14",["md"],_a),n.variable(t("ll_chart")).define("ll_chart",["log_likelihood","history_ll","vl"],ga),n.variable(t("out_15")).define("out_15",["md","tex"],wa),n.variable(t("pi_chart_1")).define("pi_chart_1",["pi1_1_m1","pi1_1_m0","vl"],ya),n.variable(t("out_16")).define("out_16",["md","tex"],xa),n.variable(t("pi_chart_2")).define("pi_chart_2",["pi2_1_m1","pi2_05_m1","pi2_1_m0","pi2_05_m0","vl"],ka),n.variable(t("out_17")).define("out_17",["md","tex","html"],Za),n.variable(t("out_18")).define("out_18",["combinations","get_comparison_vector","deepcopy","num_fmt","get_estimated_match_probability","table"],ja),n.variable(t("out_19")).define("out_19",["md"],Aa),n.variable(t("data_left_template")).define("data_left_template",Ma),n.variable(t("data_right_template")).define("data_right_template",Ca),n.variable(t("data_left")).define("data_left",["mutable history_ll","d3","left_table_csv"],Ta),n.variable(t("data_right")).define("data_right",["mutable history_ll","d3","right_table_csv"],Da),n.variable(t("match_pairs_template")).define("match_pairs_template",Pa),n.variable(t("matches")).define("matches",["mutable history_ll","d3","match_pairs_csv"],Ga),n.variable(t("combinations")).define("combinations",["db","alasql","sql_with_cols"],Sa),n.variable(t()).define(["md"],La),n.variable(t("get_comparison_vector")).define("get_comparison_vector",["month_of_birth","surname"],Ia),n.variable(t("month_of_birth")).define("month_of_birth",za),n.variable(t("surname")).define("surname",["levenshtein"],Ea),n.variable(t("comparison_vectors")).define("comparison_vectors",["combinations","get_comparison_vector"],qa),n.variable(t("match_pairs")).define("match_pairs",["db","sql_with_cols"],Na),n.variable(t("real_matches")).define("real_matches",["matches"],Oa),n.variable(t()).define(["md"],Va),n.variable(t("true_lambda")).define("true_lambda",["combinations","sql_return_scalar"],Ba),n.variable(t("pi_surname")).define("pi_surname",["pi2_1_m1","pi2_05_m1","pi2_1_m0","pi2_05_m0"],Wa),n.variable(t("pi_mob")).define("pi_mob",["pi1_1_m1","pi1_1_m0"],Fa),n.variable(t("get_estimated_match_probability")).define("get_estimated_match_probability",["lambda","pi_mob","pi_surname"],Ua),n.variable(t("log_likelihood")).define("log_likelihood",["lambda","pi_mob","pi_surname","comparison_vectors"],Ra),n.variable(t()).define(["md"],Ya),n.define("initial history_ll",Ha),n.variable(t("mutable history_ll")).define("mutable history_ll",["Mutable","initial history_ll"],(function(e,t){return new e(t)})),n.variable(t("history_ll")).define("history_ll",["mutable history_ll"],(function(e){return e.generator})),n.variable(t()).define(["history_ll","log_likelihood"],Qa),n.variable(t("db")).define("db",["alasql","data_left","data_right","matches"],Ja),n.variable(t()).define(["md"],Ka),n.variable(t("sql_with_cols")).define("sql_with_cols",["alasql"],Xa),n.variable(t("table")).define("table",["html"],$a),n.variable(t("alasql")).define("alasql",["require"],er),n.variable(t("sql_return_scalar")).define("sql_return_scalar",["alasql"],tr),n.variable(t("d3")).define("d3",["require"],nr),n.variable(t("num_fmt")).define("num_fmt",["d3"],ir),n.variable(t("levenshtein")).define("levenshtein",["require"],ar);var i=e.module(Si);n.import("slider",i),n.import("textarea",i);var a=e.module(Yi);return n.import("vl",a),n.variable(t("vegalite")).define("vegalite",["require"],rr),n.variable(t("deepcopy")).define("deepcopy",or),n}var sr=n(2263),ur=n(674),cr={title:"Unsupervised probabalistic data matching using the Expectation Maximisation algorithm",post_date:"2019-11-03",code_url:"https://observablehq.com/@robinl/unsupervised-probabalistic-data-matching-using-the-expec/",post_type:"obs",post_category:"data",description:""},dr=["title","out_1","out_2","out_3","viewof left_table_csv","out_4","out_5","viewof right_table_csv","out_6","out_7","viewof match_pairs_csv","out_8","out_9","out_10","out_11","out_12","viewof lambda","viewof pi1_1_m1","viewof pi1_1_m0","viewof pi2_1_m1","viewof pi2_05_m1","viewof pi2_1_m0","viewof pi2_05_m0","out_13","out_14","ll_chart","out_15","pi_chart_1","out_16","pi_chart_2","out_17","out_18","out_19"],mr=function(e){e.data;return(0,ur.tZ)(sr.Z,{define:lr,output_order:dr,post_frontmatter:cr})}}}]);
//# sourceMappingURL=component---src-pages-linkage-1-jsx-55d763c7212d3128c9d2.js.map